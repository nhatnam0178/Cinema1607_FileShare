(function($){$.extend($.fn,{validate:function(options){if(!this.length){if(options&&options.debug&&window.console){console.warn("Nothing selected, can't validate, returning nothing.")}return}var validator=$.data(this[0],"validator");if(validator){return validator}this.attr("novalidate","novalidate");validator=new $.validator(options,this[0]);$.data(this[0],"validator",validator);if(validator.settings.onsubmit){this.validateDelegate(":submit","click",function(event){if(validator.settings.submitHandler){validator.submitButton=event.target}if($(event.target).hasClass("cancel")){validator.cancelSubmit=true}if($(event.target).attr("formnovalidate")!==undefined){validator.cancelSubmit=true}});this.submit(function(event){if(validator.settings.debug){event.preventDefault()}function handle(){var hidden;if(validator.settings.submitHandler){if(validator.submitButton){hidden=$("<input type='hidden'/>").attr("name",validator.submitButton.name).val($(validator.submitButton).val()).appendTo(validator.currentForm)}validator.settings.submitHandler.call(validator,validator.currentForm,event);if(validator.submitButton){hidden.remove()}return false}return true}if(validator.cancelSubmit){validator.cancelSubmit=false;return handle()}if(validator.form()){if(validator.pendingRequest){validator.formSubmitted=true;return false}return handle()}else{validator.focusInvalid();return false}})}return validator},valid:function(){if($(this[0]).is("form")){return this.validate().form()}else{var valid=true;var validator=$(this[0].form).validate();this.each(function(){valid=valid&&validator.element(this)});return valid}},removeAttrs:function(attributes){var result={},$element=this;$.each(attributes.split(/\s/),function(index,value){result[value]=$element.attr(value);$element.removeAttr(value)});return result},rules:function(command,argument){var element=this[0];if(command){var settings=$.data(element.form,"validator").settings;var staticRules=settings.rules;var existingRules=$.validator.staticRules(element);switch(command){case"add":$.extend(existingRules,$.validator.normalizeRule(argument));delete existingRules.messages;staticRules[element.name]=existingRules;if(argument.messages){settings.messages[element.name]=$.extend(settings.messages[element.name],argument.messages)}break;case"remove":if(!argument){delete staticRules[element.name];return existingRules}var filtered={};$.each(argument.split(/\s/),function(index,method){filtered[method]=existingRules[method];delete existingRules[method]});return filtered}}var data=$.validator.normalizeRules($.extend({},$.validator.classRules(element),$.validator.attributeRules(element),$.validator.dataRules(element),$.validator.staticRules(element)),element);if(data.required){var param=data.required;delete data.required;data=$.extend({required:param},data)}return data}});$.extend($.expr[":"],{blank:function(a){return!$.trim(""+$(a).val())},filled:function(a){return!!$.trim(""+$(a).val())},unchecked:function(a){return!$(a).prop("checked")}});$.validator=function(options,form){this.settings=$.extend(true,{},$.validator.defaults,options);this.currentForm=form;this.init()};$.validator.format=function(source,params){if(arguments.length===1){return function(){var args=$.makeArray(arguments);args.unshift(source);return $.validator.format.apply(this,args)}}if(arguments.length>2&&params.constructor!==Array){params=$.makeArray(arguments).slice(1)}if(params.constructor!==Array){params=[params]}$.each(params,function(i,n){source=source.replace(new RegExp("\\{"+i+"\\}","g"),function(){return n})});return source};$.extend($.validator,{defaults:{messages:{},groups:{},rules:{},errorClass:"error",validClass:"valid",errorElement:"label",focusInvalid:true,errorContainer:$([]),errorLabelContainer:$([]),onsubmit:true,ignore:":hidden",ignoreTitle:false,onfocusin:function(element,event){this.lastActive=element;if(this.settings.focusCleanup&&!this.blockFocusCleanup){if(this.settings.unhighlight){this.settings.unhighlight.call(this,element,this.settings.errorClass,this.settings.validClass)}this.addWrapper(this.errorsFor(element)).hide()}},onfocusout:function(element,event){if(!this.checkable(element)&&(element.name in this.submitted||!this.optional(element))){this.element(element)}},onkeyup:function(element,event){if(event.which===9&&this.elementValue(element)===""){return}else if(element.name in this.submitted||element===this.lastElement){this.element(element)}},onclick:function(element,event){if(element.name in this.submitted){this.element(element)}else if(element.parentNode.name in this.submitted){this.element(element.parentNode)}},highlight:function(element,errorClass,validClass){if(element.type==="radio"){this.findByName(element.name).addClass(errorClass).removeClass(validClass)}else{$(element).addClass(errorClass).removeClass(validClass)}},unhighlight:function(element,errorClass,validClass){if(element.type==="radio"){this.findByName(element.name).removeClass(errorClass).addClass(validClass)}else{$(element).removeClass(errorClass).addClass(validClass)}}},setDefaults:function(settings){$.extend($.validator.defaults,settings)},messages:{required:"This field is required.",remote:"Please fix this field.",email:"Please enter a valid email address.",url:"Please enter a valid URL.",date:"Please enter a valid date.",dateISO:"Please enter a valid date (ISO).",number:"Please enter a valid number.",digits:"Please enter only digits.",creditcard:"Please enter a valid credit card number.",equalTo:"Please enter the same value again.",maxlength:$.validator.format("Please enter no more than {0} characters."),minlength:$.validator.format("Please enter at least {0} characters."),rangelength:$.validator.format("Please enter a value between {0} and {1} characters long."),range:$.validator.format("Please enter a value between {0} and {1}."),max:$.validator.format("Please enter a value less than or equal to {0}."),min:$.validator.format("Please enter a value greater than or equal to {0}.")},autoCreateRanges:false,prototype:{init:function(){this.labelContainer=$(this.settings.errorLabelContainer);this.errorContext=this.labelContainer.length&&this.labelContainer||$(this.currentForm);this.containers=$(this.settings.errorContainer).add(this.settings.errorLabelContainer);this.submitted={};this.valueCache={};this.pendingRequest=0;this.pending={};this.invalid={};this.reset();var groups=this.groups={};$.each(this.settings.groups,function(key,value){if(typeof value==="string"){value=value.split(/\s/)}$.each(value,function(index,name){groups[name]=key})});var rules=this.settings.rules;$.each(rules,function(key,value){rules[key]=$.validator.normalizeRule(value)});function delegate(event){var validator=$.data(this[0].form,"validator"),eventType="on"+event.type.replace(/^validate/,"");if(validator.settings[eventType]){validator.settings[eventType].call(validator,this[0],event)}}$(this.currentForm).validateDelegate(":text, [type='password'], [type='file'], select, textarea, "+"[type='number'], [type='search'] ,[type='tel'], [type='url'], "+"[type='email'], [type='datetime'], [type='date'], [type='month'], "+"[type='week'], [type='time'], [type='datetime-local'], "+"[type='range'], [type='color'] ","focusin focusout keyup",delegate).validateDelegate("[type='radio'], [type='checkbox'], select, option","click",delegate);if(this.settings.invalidHandler){$(this.currentForm).bind("invalid-form.validate",this.settings.invalidHandler)}},form:function(){this.checkForm();$.extend(this.submitted,this.errorMap);this.invalid=$.extend({},this.errorMap);if(!this.valid()){$(this.currentForm).triggerHandler("invalid-form",[this])}this.showErrors();return this.valid()},checkForm:function(){this.prepareForm();for(var i=0,elements=this.currentElements=this.elements();elements[i];i++){this.check(elements[i])}return this.valid()},element:function(element){element=this.validationTargetFor(this.clean(element));this.lastElement=element;this.prepareElement(element);this.currentElements=$(element);var result=this.check(element)!==false;if(result){delete this.invalid[element.name]}else{this.invalid[element.name]=true}if(!this.numberOfInvalids()){this.toHide=this.toHide.add(this.containers)}this.showErrors();return result},showErrors:function(errors){if(errors){$.extend(this.errorMap,errors);this.errorList=[];for(var name in errors){this.errorList.push({message:errors[name],element:this.findByName(name)[0]})}this.successList=$.grep(this.successList,function(element){return!(element.name in errors)})}if(this.settings.showErrors){this.settings.showErrors.call(this,this.errorMap,this.errorList)}else{this.defaultShowErrors()}},resetForm:function(){if($.fn.resetForm){$(this.currentForm).resetForm()}this.submitted={};this.lastElement=null;this.prepareForm();this.hideErrors();this.elements().removeClass(this.settings.errorClass).removeData("previousValue")},numberOfInvalids:function(){return this.objectLength(this.invalid)},objectLength:function(obj){var count=0;for(var i in obj){count++}return count},hideErrors:function(){this.addWrapper(this.toHide).hide()},valid:function(){return this.size()===0},size:function(){return this.errorList.length},focusInvalid:function(){if(this.settings.focusInvalid){try{$(this.findLastActive()||this.errorList.length&&this.errorList[0].element||[]).filter(":visible").focus().trigger("focusin")}catch(e){}}},findLastActive:function(){var lastActive=this.lastActive;return lastActive&&$.grep(this.errorList,function(n){return n.element.name===lastActive.name}).length===1&&lastActive},elements:function(){var validator=this,rulesCache={};return $(this.currentForm).find("input, select, textarea").not(":submit, :reset, :image, [disabled]").not(this.settings.ignore).filter(function(){if(!this.name&&validator.settings.debug&&window.console){console.error("%o has no name assigned",this)}if(this.name in rulesCache||!validator.objectLength($(this).rules())){return false}rulesCache[this.name]=true;return true})},clean:function(selector){return $(selector)[0]},errors:function(){var errorClass=this.settings.errorClass.replace(" ",".");return $(this.settings.errorElement+"."+errorClass,this.errorContext)},reset:function(){this.successList=[];this.errorList=[];this.errorMap={};this.toShow=$([]);this.toHide=$([]);this.currentElements=$([])},prepareForm:function(){this.reset();this.toHide=this.errors().add(this.containers)},prepareElement:function(element){this.reset();this.toHide=this.errorsFor(element)},elementValue:function(element){var type=$(element).attr("type"),val=$(element).val();if(type==="radio"||type==="checkbox"){return $("input[name='"+$(element).attr("name")+"']:checked").val()}if(typeof val==="string"){return val.replace(/\r/g,"")}return val},check:function(element){element=this.validationTargetFor(this.clean(element));var rules=$(element).rules();var dependencyMismatch=false;var val=this.elementValue(element);var result;for(var method in rules){var rule={method:method,parameters:rules[method]};try{result=$.validator.methods[method].call(this,val,element,rule.parameters);if(result==="dependency-mismatch"){dependencyMismatch=true;continue}dependencyMismatch=false;if(result==="pending"){this.toHide=this.toHide.not(this.errorsFor(element));return}if(!result){this.formatAndAdd(element,rule);return false}}catch(e){if(this.settings.debug&&window.console){console.log("Exception occurred when checking element "+element.id+", check the '"+rule.method+"' method.",e)}throw e}}if(dependencyMismatch){return}if(this.objectLength(rules)){this.successList.push(element)}return true},customDataMessage:function(element,method){return $(element).data("msg-"+method.toLowerCase())||element.attributes&&$(element).attr("data-msg-"+method.toLowerCase())},customMessage:function(name,method){var m=this.settings.messages[name];return m&&(m.constructor===String?m:m[method])},findDefined:function(){for(var i=0;i<arguments.length;i++){if(arguments[i]!==undefined){return arguments[i]}}return undefined},defaultMessage:function(element,method){return this.findDefined(this.customMessage(element.name,method),this.customDataMessage(element,method),!this.settings.ignoreTitle&&element.title||undefined,$.validator.messages[method],"<strong>Warning: No message defined for "+element.name+"</strong>")},formatAndAdd:function(element,rule){var message=this.defaultMessage(element,rule.method),theregex=/\$?\{(\d+)\}/g;if(typeof message==="function"){message=message.call(this,rule.parameters,element)}else if(theregex.test(message)){message=$.validator.format(message.replace(theregex,"{$1}"),rule.parameters)}this.errorList.push({message:message,element:element});this.errorMap[element.name]=message;this.submitted[element.name]=message},addWrapper:function(toToggle){if(this.settings.wrapper){toToggle=toToggle.add(toToggle.parent(this.settings.wrapper))}return toToggle},defaultShowErrors:function(){var i,elements;for(i=0;this.errorList[i];i++){var error=this.errorList[i];if(this.settings.highlight){this.settings.highlight.call(this,error.element,this.settings.errorClass,this.settings.validClass)}this.showLabel(error.element,error.message)}if(this.errorList.length){this.toShow=this.toShow.add(this.containers)}if(this.settings.success){for(i=0;this.successList[i];i++){this.showLabel(this.successList[i])}}if(this.settings.unhighlight){for(i=0,elements=this.validElements();elements[i];i++){this.settings.unhighlight.call(this,elements[i],this.settings.errorClass,this.settings.validClass)}}this.toHide=this.toHide.not(this.toShow);this.hideErrors();this.addWrapper(this.toShow).show()},validElements:function(){return this.currentElements.not(this.invalidElements())},invalidElements:function(){return $(this.errorList).map(function(){return this.element})},showLabel:function(element,message){var label=this.errorsFor(element);if(label.length){label.removeClass(this.settings.validClass).addClass(this.settings.errorClass);label.html(message)}else{label=$("<"+this.settings.errorElement+">").attr("for",this.idOrName(element)).addClass(this.settings.errorClass).html(message||"");if(this.settings.wrapper){label=label.hide().show().wrap("<"+this.settings.wrapper+"/>").parent()}if(!this.labelContainer.append(label).length){if(this.settings.errorPlacement){this.settings.errorPlacement(label,$(element))}else{label.insertAfter(element)}}}if(!message&&this.settings.success){label.text("");if(typeof this.settings.success==="string"){label.addClass(this.settings.success)}else{this.settings.success(label,element)}}this.toShow=this.toShow.add(label)},errorsFor:function(element){var name=this.idOrName(element);return this.errors().filter(function(){return $(this).attr("for")===name})},idOrName:function(element){return this.groups[element.name]||(this.checkable(element)?element.name:element.id||element.name)},validationTargetFor:function(element){if(this.checkable(element)){element=this.findByName(element.name).not(this.settings.ignore)[0]}return element},checkable:function(element){return/radio|checkbox/i.test(element.type)},findByName:function(name){return $(this.currentForm).find("[name='"+name+"']")},getLength:function(value,element){switch(element.nodeName.toLowerCase()){case"select":return $("option:selected",element).length;case"input":if(this.checkable(element)){return this.findByName(element.name).filter(":checked").length}}return value.length},depend:function(param,element){return this.dependTypes[typeof param]?this.dependTypes[typeof param](param,element):true},dependTypes:{boolean:function(param,element){return param},string:function(param,element){return!!$(param,element.form).length},function:function(param,element){return param(element)}},optional:function(element){var val=this.elementValue(element);return!$.validator.methods.required.call(this,val,element)&&"dependency-mismatch"},startRequest:function(element){if(!this.pending[element.name]){this.pendingRequest++;this.pending[element.name]=true}},stopRequest:function(element,valid){this.pendingRequest--;if(this.pendingRequest<0){this.pendingRequest=0}delete this.pending[element.name];if(valid&&this.pendingRequest===0&&this.formSubmitted&&this.form()){$(this.currentForm).submit();this.formSubmitted=false}else if(!valid&&this.pendingRequest===0&&this.formSubmitted){$(this.currentForm).triggerHandler("invalid-form",[this]);this.formSubmitted=false}},previousValue:function(element){return $.data(element,"previousValue")||$.data(element,"previousValue",{old:null,valid:true,message:this.defaultMessage(element,"remote")})}},classRuleSettings:{required:{required:true},email:{email:true},url:{url:true},date:{date:true},dateISO:{dateISO:true},number:{number:true},digits:{digits:true},creditcard:{creditcard:true}},addClassRules:function(className,rules){if(className.constructor===String){this.classRuleSettings[className]=rules}else{$.extend(this.classRuleSettings,className)}},classRules:function(element){var rules={};var classes=$(element).attr("class");if(classes){$.each(classes.split(" "),function(){if(this in $.validator.classRuleSettings){$.extend(rules,$.validator.classRuleSettings[this])}})}return rules},attributeRules:function(element){var rules={};var $element=$(element);var type=$element[0].getAttribute("type");for(var method in $.validator.methods){var value;if(method==="required"){value=$element.get(0).getAttribute(method);if(value===""){value=true}value=!!value}else{value=$element.attr(method)}if(/min|max/.test(method)&&(type===null||/number|range|text/.test(type))){value=Number(value)}if(value){rules[method]=value}else if(type===method&&type!=="range"){rules[method]=true}}if(rules.maxlength&&/-1|2147483647|524288/.test(rules.maxlength)){delete rules.maxlength}return rules},dataRules:function(element){var method,value,rules={},$element=$(element);for(method in $.validator.methods){value=$element.data("rule-"+method.toLowerCase());if(value!==undefined){rules[method]=value}}return rules},staticRules:function(element){var rules={};var validator=$.data(element.form,"validator");if(validator.settings.rules){rules=$.validator.normalizeRule(validator.settings.rules[element.name])||{}}return rules},normalizeRules:function(rules,element){$.each(rules,function(prop,val){if(val===false){delete rules[prop];return}if(val.param||val.depends){var keepRule=true;switch(typeof val.depends){case"string":keepRule=!!$(val.depends,element.form).length;break;case"function":keepRule=val.depends.call(element,element);break}if(keepRule){rules[prop]=val.param!==undefined?val.param:true}else{delete rules[prop]}}});$.each(rules,function(rule,parameter){rules[rule]=$.isFunction(parameter)?parameter(element):parameter});$.each(["minlength","maxlength"],function(){if(rules[this]){rules[this]=Number(rules[this])}});$.each(["rangelength","range"],function(){var parts;if(rules[this]){if($.isArray(rules[this])){rules[this]=[Number(rules[this][0]),Number(rules[this][1])]}else if(typeof rules[this]==="string"){parts=rules[this].split(/[\s,]+/);rules[this]=[Number(parts[0]),Number(parts[1])]}}});if($.validator.autoCreateRanges){if(rules.min&&rules.max){rules.range=[rules.min,rules.max];delete rules.min;delete rules.max}if(rules.minlength&&rules.maxlength){rules.rangelength=[rules.minlength,rules.maxlength];delete rules.minlength;delete rules.maxlength}}return rules},normalizeRule:function(data){if(typeof data==="string"){var transformed={};$.each(data.split(/\s/),function(){transformed[this]=true});data=transformed}return data},addMethod:function(name,method,message){$.validator.methods[name]=method;$.validator.messages[name]=message!==undefined?message:$.validator.messages[name];if(method.length<3){$.validator.addClassRules(name,$.validator.normalizeRule(name))}},methods:{required:function(value,element,param){if(!this.depend(param,element)){return"dependency-mismatch"}if(element.nodeName.toLowerCase()==="select"){var val=$(element).val();return val&&val.length>0}if(this.checkable(element)){return this.getLength(value,element)>0}return $.trim(value).length>0},email:function(value,element){return this.optional(element)||/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i.test(value)},url:function(value,element){return this.optional(element)||/^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(value)},date:function(value,element){return this.optional(element)||!/Invalid|NaN/.test(new Date(value).toString())},dateISO:function(value,element){return this.optional(element)||/^\d{4}[\/\-]\d{1,2}[\/\-]\d{1,2}$/.test(value)},number:function(value,element){return this.optional(element)||/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(value)},digits:function(value,element){return this.optional(element)||/^\d+$/.test(value)},creditcard:function(value,element){if(this.optional(element)){return"dependency-mismatch"}if(/[^0-9 \-]+/.test(value)){return false}var nCheck=0,nDigit=0,bEven=false;value=value.replace(/\D/g,"");for(var n=value.length-1;n>=0;n--){var cDigit=value.charAt(n);nDigit=parseInt(cDigit,10);if(bEven){if((nDigit*=2)>9){nDigit-=9}}nCheck+=nDigit;bEven=!bEven}return nCheck%10===0},minlength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength($.trim(value),element);return this.optional(element)||length>=param},maxlength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength($.trim(value),element);return this.optional(element)||length<=param},rangelength:function(value,element,param){var length=$.isArray(value)?value.length:this.getLength($.trim(value),element);return this.optional(element)||length>=param[0]&&length<=param[1]},min:function(value,element,param){return this.optional(element)||value>=param},max:function(value,element,param){return this.optional(element)||value<=param},range:function(value,element,param){return this.optional(element)||value>=param[0]&&value<=param[1]},equalTo:function(value,element,param){var target=$(param);if(this.settings.onfocusout){target.unbind(".validate-equalTo").bind("blur.validate-equalTo",function(){$(element).valid()})}return value===target.val()},remote:function(value,element,param){if(this.optional(element)){return"dependency-mismatch"}var previous=this.previousValue(element);if(!this.settings.messages[element.name]){this.settings.messages[element.name]={}}previous.originalMessage=this.settings.messages[element.name].remote;this.settings.messages[element.name].remote=previous.message;param=typeof param==="string"&&{url:param}||param;if(previous.old===value){return previous.valid}previous.old=value;var validator=this;this.startRequest(element);var data={};data[element.name]=value;$.ajax($.extend(true,{url:param,mode:"abort",port:"validate"+element.name,dataType:"json",data:data,success:function(response){validator.settings.messages[element.name].remote=previous.originalMessage;var valid=response===true||response==="true";if(valid){var submitted=validator.formSubmitted;validator.prepareElement(element);validator.formSubmitted=submitted;validator.successList.push(element);delete validator.invalid[element.name];validator.showErrors()}else{var errors={};var message=response||validator.defaultMessage(element,"remote");errors[element.name]=previous.message=$.isFunction(message)?message(value):message;validator.invalid[element.name]=true;validator.showErrors(errors)}previous.valid=valid;validator.stopRequest(element,valid)}},param));return"pending"}}});$.format=$.validator.format})(jQuery);(function($){var pendingRequests={};if($.ajaxPrefilter){$.ajaxPrefilter(function(settings,_,xhr){var port=settings.port;if(settings.mode==="abort"){if(pendingRequests[port]){pendingRequests[port].abort()}pendingRequests[port]=xhr}})}else{var ajax=$.ajax;$.ajax=function(settings){var mode=("mode"in settings?settings:$.ajaxSettings).mode,port=("port"in settings?settings:$.ajaxSettings).port;if(mode==="abort"){if(pendingRequests[port]){pendingRequests[port].abort()}pendingRequests[port]=ajax.apply(this,arguments);return pendingRequests[port]}return ajax.apply(this,arguments)}}})(jQuery);(function($){$.extend($.fn,{validateDelegate:function(delegate,type,handler){return this.bind(type,function(event){var target=$(event.target);if(target.is(delegate)){return handler.apply(target,arguments)}})}})})(jQuery);(function(window,undefined){"$:nomunge";var $=window.jQuery||window.Cowboy||(window.Cowboy={}),jq_throttle;$.throttle=jq_throttle=function(delay,no_trailing,callback,debounce_mode){var timeout_id,last_exec=0;if(typeof no_trailing!=="boolean"){debounce_mode=callback;callback=no_trailing;no_trailing=undefined}function wrapper(){var that=this,elapsed=+new Date-last_exec,args=arguments;function exec(){last_exec=+new Date;callback.apply(that,args)}function clear(){timeout_id=undefined}if(debounce_mode&&!timeout_id){exec()}timeout_id&&clearTimeout(timeout_id);if(debounce_mode===undefined&&elapsed>delay){exec()}else if(no_trailing!==true){timeout_id=setTimeout(debounce_mode?clear:exec,debounce_mode===undefined?delay-elapsed:delay)}}if($.guid){wrapper.guid=callback.guid=callback.guid||$.guid++}return wrapper};$.debounce=function(delay,at_begin,callback){return callback===undefined?jq_throttle(delay,at_begin,false):jq_throttle(delay,callback,at_begin!==false)}})(this);namespace("vimeo.ui");vimeo.ui.BaseCarousel=Object.subClass({base_options:{active_class:"carousel_slide_active",out_class:"carousel_slide_out",out_class_delay:1e3,autoplay_delay:1e4,infinite:true},current_direction:"next",init:function(container,options){var self=this;if(!container){throw new Error("Title cannot be null")}self.options=$.extend({},self.base_options,options);self.container=$(container);if(typeof container==="string"){self.container=$("#"+container)}self.current_index=0;self.slides=self.container.children();self.slides.eq(0).addClass(self.options.active_class);if(self.slides.length<=1){return}self.out_timer=null;self.slide_out_in_progress=false;self.autoplay_delay=self.options.autoplay_delay;self.play()},play:function(){var self=this;if(self.autoplay_delay>1){self.interval=setTimeout(self.autoNext.bind(self),self.autoplay_delay)}},pause:function(){clearTimeout(this.interval)},show:function(index){var self=this,slides=self.slides,last=slides.filter("."+self.options.active_class);self.pause();self.current_index=index;last.removeClass(self.options.active_class);if(self.options.out_class_delay>0){last.addClass(self.options.out_class);self.slide_out_in_progress=true;clearTimeout(self.out_timer);self.out_timer=setTimeout(function(){last.removeClass(self.options.out_class);self.slide_out_in_progress=false},self.options.out_class_delay)}slides.eq(index).addClass(self.options.active_class);self.container.trigger("slide_change",{index:self.current_index,slides:slides,direction:self.current_direction,previous:self.getPreviousIndex(),next:self.getNextIndex()})},previous:function(){var self=this;if(self.slide_out_in_progress){return}self.current_direction="previous";self.container.trigger("previous",{index:self.current_index,slides:self.slides,previous:self.getPreviousIndex(),next:self.getNextIndex()});self.show(self.getPreviousIndex());self.play()},next:function(){var self=this;if(self.slide_out_in_progress){return}self.current_direction="next";self.container.trigger("next",{index:self.current_index,slides:self.slides,previous:self.getPreviousIndex(),next:self.getNextIndex()});self.show(self.getNextIndex());self.play()},autoNext:function(){var self=this;self.next()},getCurrentIndex:function(){return this.current_index},getPreviousIndex:function(){var self=this,previous_index=self.current_index-1,total_slides=self.slides.length,max_index=total_slides-1,is_infinite=self.options.infinite;if(previous_index<0){previous_index=0;if(is_infinite){previous_index=max_index}}return previous_index},getNextIndex:function(){var self=this,next_index=self.current_index+1,total_slides=self.slides.length,max_index=total_slides-1,is_infinite=self.options.infinite;if(next_index>max_index){next_index=max_index;if(is_infinite){next_index=0}}return next_index}});namespace("vimeo.ui");vimeo.ui.PagedCarousel=vimeo.ui.BaseCarousel.subClass({default_options:{previous_button:null,next_button:null,secondary_nav_class:"",reverse_class:"carousel_reverse",pause_with_interaction:true,pause_on_hover:true,enable_swipe:true,enable_pan:false,next_previous_gesture:"click",onCarouselChange:function(){},onPrevious:function(){},onNext:function(){},onPan:function(){},onNavClick:function(){}},init:function(container,options){var self=this;options=$.extend(self.default_options,options);self._super(container,options);self.previous_button=$(self.options.previous_button);self.next_button=$(self.options.next_button);self.next_previous_gesture=self.options.next_previous_gesture;self.onChange=self.options.onCarouselChange;self.onPreviousChange=self.options.onPrevious;self.onNextChange=self.options.onNext;self.onPan=self.options.onPan;self.onNavClick=self.options.onNavClick;if(self.options.secondary_nav_class){self.createSecondaryNav()}self.attachEvents();return self.container},attachEvents:function(){var self=this,gesture=self.next_previous_gesture,hammer_options={touchAction:"pan-y"};self.bound={onPreviousClick:self.onPrevClick.bind(self),onNextClick:self.onNextClick.bind(self),onPan:self.onPan.bind(self)};self.container.on("previous",self.onPrevious.bind(self));self.container.on("next",self.onNext.bind(self));self.container.on("slide_change",self.onCarouselChange.bind(self));self.previous_button.on(gesture,self.bound.onPreviousClick);self.next_button.on(gesture,self.bound.onNextClick);if(self.options.pause_on_hover){self.container.on("mouseover",function onMouseOver(){self.pause()});self.container.on("mouseout",function onMouseOut(){self.play()})}if(typeof Hammer!=="undefined"&&self.options.enable_swipe){new Hammer(self.container[0],hammer_options).on("swiperight",self.bound.onPreviousClick);new Hammer(self.container[0],hammer_options).on("swipeleft",self.bound.onNextClick)}if(typeof Hammer!=="undefined"&&self.options.enable_pan){new Hammer(self.container[0],hammer_options).on("pan panstart",self.bound.onPan)}},createSecondaryNav:function(){
var self=this,cls="carousel_nav_container ",div=$('<div class="'+cls+self.options.secondary_nav_class+'">');self.slides.each(function(i){var button=self.createSecondaryNavButton(i);div.append(button)});self.secondary_nav=div;self.secondary_nav.on("click touchend","a",self.onSecondaryNavClick.bind(self));self.container.after(div)},createSecondaryNavButton:function(index){var dot=$('<a href="javascript:void(0)">');dot.attr("data-slide",index);if(index===0){dot.addClass("selected")}return dot},onCarouselChange:function(e,obj){var self=this,dots;self.onChange(e,obj);if(self.secondary_nav&&self.secondary_nav.length){dots=self.secondary_nav.find("a");dots.removeClass("selected");dots.eq(obj.index).addClass("selected")}},onNext:function(e,obj){var self=this;if(self.container.hasClass(self.options.reverse_class)){self.container.removeClass(self.options.reverse_class)}self.onNextChange(e,obj)},onPrevious:function(e,obj){var self=this;if(!self.container.hasClass(self.options.reverse_class)){self.container.addClass(self.options.reverse_class)}self.onPreviousChange(e,obj)},onSecondaryNavClick:function(e){var self=this,btn=$(e.target),slide=parseInt(btn.attr("data-slide"),10);self.onNavClick(e,slide);self.show(slide)},onPrevClick:function(e){var self=this;if(self.options.pause_with_interaction){self.autoplay_delay=0}self.previous()},onNextClick:function(e){var self=this;if(self.options.pause_with_interaction){self.autoplay_delay=0}self.next()}});(function(vimeo){"use strict";var CommentController={comments:{},replies:{}};CommentController.initialize=function(){var self=this;self._createElements();self._attachEvents();Signal.comments.loaded.dispatch()};CommentController._createElements=function(){var self=this;self._comment_elements=$(".js-comment");self._reply_elements=$(".js-comment_reply");self._comment_form=$(".js-new_comment_form");self._scroller_ceiling=$(".js-comment_scroller_ceiling");self._scroller_region=$(".js-comment_scroller_region");self._scroller_floor=$(".js-comment_scroller_floor");self._return_to_top=$(".js-return_to_top");self._comment_list=new vimeo.comment.List;self._comment_pager=new vimeo.comment.Pager;self._createComments();self._createReplies();self._return_to_top.detach().insertBefore(self._scroller_floor);if(self._comment_form.length){self._comment_creator=new vimeo.comment.Creator(self._comment_form)}};CommentController._attachEvents=function(){var self=this;self._bound_events={comments_reset:self._onCommentsReset.bind(self),comment_appended:self._onCommentAppended.bind(self),comment_deleted:self._onCommentDeleted.bind(self),comment_action_failed:self._onCommentActionFailed.bind(self),tool_opened:self._onToolOpened.bind(self),tool_closed:self._onToolClosed.bind(self),page_appended:self._onCommentPageAppended.bind(self)};Signal.comments.reset.add(self._bound_events.comments_reset);Signal.comments.appended.add(self._bound_events.comment_appended);Signal.comments.deleted.add(self._bound_events.comment_deleted);Signal.comments.action_failed.add(self._bound_events.comment_action_failed);Signal.comments.tool.opened.add(self._bound_events.tool_opened);Signal.comments.tool.closed.add(self._bound_events.tool_closed);Signal.comments.page_appended.add(self._bound_events.page_appended);if(self._return_to_top.length){self._scroller_floor.scrollSpy({throttle:100}).on("scrollSpy:enter",function(){self._return_to_top.addClass("with_floor")}).on("scrollSpy:exit",function(){self._return_to_top.removeClass("with_floor")});self._scroller_ceiling.scrollSpy({throttle:100}).on("scrollSpy:enter",function(){self._return_to_top.addClass("with_ceiling")}).on("scrollSpy:exit",function(){self._return_to_top.removeClass("with_ceiling")});self._scroller_region.scrollSpy({throttle:100}).on("scrollSpy:enter",function(){self._return_to_top.addClass("visible")}).on("scrollSpy:exit",function(){self._return_to_top.removeClass("visible")});self._return_to_top.on("click",self._onReturnToTop.bind(self))}};CommentController._createComments=function(){var self=this;self._comment_elements.each(function(){var comment=$(this);if(typeof ModComment!=="undefined"){self.comments[comment.attr("id")]=new vimeo.comment.ModComment(comment)}else{self.comments[comment.attr("id")]=new vimeo.comment.Comment(comment)}})};CommentController._createReplies=function(){var self=this;self._reply_elements.each(function(){var reply=$(this);self.replies[reply.attr("data-parent-id")]=new vimeo.comment.Reply(reply)})};CommentController._destroyComment=function(comment){var self=this,comment_key=comment.attr("id");if(self.comments[comment_key]){self.comments[comment_key].destroy()}};CommentController._destroyCollection=function(collection){var key;for(key in collection){if(collection.hasOwnProperty(key)){collection[key].destroy()}}};CommentController._closeCollection=function(collection,module){var key;for(key in collection){if(collection[key]!==module){collection[key].close()}}};CommentController._onCommentAppended=function(e){var self=this,new_comment=e.comment,new_comment_id=new_comment.attr("id"),new_reply=$('[data-parent-id="'+new_comment_id+'"]');self.comments[new_comment_id]=new vimeo.comment.Comment(new_comment);if(new_reply.length){self.replies[new_comment_id]=new vimeo.comment.Reply(new_reply)}};CommentController._onCommentDeleted=function(e){var self=this,comment=e.comment,comment_replies=$("."+comment.attr("id")),reply_module=self.replies[comment.attr("id")];if(reply_module){reply_module.destroy()}self._destroyComment(comment);comment_replies.each(function(){self._destroyComment($(this))})};CommentController._onCommentActionFailed=function(e){var self=this,response=JSON.parse(e.xhr.responseText),key,input;if(e.xhr.status===403){alert(Copy.dict.no_comments_for_you)}else{for(key in response){if(response.hasOwnProperty(key)){input=$(e.form).find(":input[name="+key+"]").first();if(input){input.addClass("validation-failed")}}}}};CommentController._onToolOpened=function(e){var self=this,module=e.module,key;if(self.comments){self._closeCollection(self.comments,module)}if(self.replies){self._closeCollection(self.replies,module)}if(self._comment_creator&&module!==self._comment_creator){self._comment_creator.close()}};CommentController._onToolClosed=function(){var self=this;if(self._comment_creator){self._comment_creator.open()}};CommentController._onCommentsReset=function(e){var self=this;self.refresh();Signal.comments.loaded.dispatch()};CommentController._onCommentPageAppended=function(){var self=this;self._destroyCollection(self.replies);self._destroyCollection(self.comments);self._comment_elements=$(".js-comment");self._reply_elements=$(".js-comment_reply");self._createComments();self._createReplies();Signal.comments.loaded.dispatch()};CommentController._onReturnToTop=function(){var el=$("#wrap")[0];if(typeof $.smoothScroll==="function"){$.smoothScroll({scrollTarget:el});return}$(window).scrollTop($(el).offset().top+"px")};CommentController.destroy=function(){var self=this;Signal.comments.reset.remove(self._bound_events.comments_reset);Signal.comments.appended.remove(self._bound_events.comment_appended);Signal.comments.deleted.remove(self._bound_events.comment_deleted);Signal.comments.action_failed.remove(self._bound_events.comment_action_failed);Signal.comments.tool.opened.remove(self._bound_events.tool_opened);Signal.comments.tool.closed.remove(self._bound_events.tool_closed);Signal.comments.page_appended.remove(self._bound_events.page_appended);self._comment_list.destroy();self._destroyCollection(self.comments);self._destroyCollection(self.replies);if(self._comment_creator){self._comment_creator.destroy()}};CommentController.refresh=function(){var self=this;self._comment_list.destroy();self._comment_creator.destroy();self._destroyCollection(self.replies);self._destroyCollection(self.comments);self._comment_elements=$(".js-comment");self._reply_elements=$(".js-comment_reply");self._comment_form=$(".js-new_comment_form");self._createComments();self._createReplies();self._comment_list=new vimeo.comment.List;self._comment_creator=new vimeo.comment.Creator(self._comment_form)};vimeo.comment=vimeo.comment||{};vimeo.comment.CommentController=CommentController})(vimeo);(function(vimeo){"use strict";var Comment=function(comment){var self=this;self._createElements(comment);self._attachEvents()};Comment.prototype._createElements=function(comment){var self=this,element_id=comment.attr("id");self._comment=comment;self._comment_id=element_id.replace("comment_","");self._comment_text=comment.find(".js-comment_text").first();self._replies=$("."+element_id);self._edit_trigger=comment.find(".js-edit_trigger").first();self._create_case_trigger=comment.find(".js-create_case_trigger").first();self._delete_trigger=comment.find(".js-delete_trigger").first();self._permalink_trigger=comment.find(".js-permalink_trigger").first();self._spam_trigger=comment.find(".js-spam_trigger").first();self._comment_forms=[];self._edit_container=comment.find(".js-edit_container").first();if(self._edit_container){self._edit_form=new vimeo.comment.Form({action:"edit",comment_id:self._comment_id,container:self._edit_container,is_sticky:self._comment.hasClass("sticky")?1:0});self._comment_forms.push(self._edit_form)}self._delete_container=comment.find(".js-delete_container").first();if(self._delete_container){self._delete_form=new vimeo.comment.Form({action:"delete",comment_id:self._comment_id,container:self._delete_container,is_sticky:self._comment.hasClass("sticky")?1:0});self._comment_forms.push(self._delete_form)}self._spam_container=comment.find(".js-spam_container").first();if(self._spam_container){self._spam_form=new vimeo.comment.Form({action:"spam",comment_id:self._comment_id,container:self._spam_container});self._comment_forms.push(self._spam_form)}};Comment.prototype._attachEvents=function(){var self=this;self._bound_events={edit_click:self._onTriggerClick.bind(self,self._edit_form),delete_click:self._onTriggerClick.bind(self,self._delete_form),spam_click:self._onTriggerClick.bind(self,self._spam_form),cancel_click:self._onCancelClick.bind(self),permalink_click:self._onPermalinkClick.bind(self)};self._edit_trigger.on("click",self._bound_events.edit_click);self._delete_trigger.on("click",self._bound_events.delete_click);self._permalink_trigger.on("click",self._bound_events.permalink_click);self._spam_trigger.on("click",self._bound_events.spam_click);self._comment.on("click",".cancel",self._bound_events.cancel_click);Signal.comments.form_submitted.add(self._onFormSubmitted.bind(self))};Comment.prototype._openTool=function(form){var self=this;form.open();Signal.comments.tool.opened.dispatch({module:self})};Comment.prototype._closeTool=function(form){var self=this;self._comment_text.show();form.close();Signal.comments.tool.closed.dispatch({})};Comment.prototype._onTriggerClick=function(form){var self=this;if(self._comment_text.is(":visible")){self._openTool(form)}else{self._closeTool(form)}};Comment.prototype._onCancelClick=function(e){this._comment_text.show();Signal.comments.tool.closed.dispatch({})};Comment.prototype._onPermalinkClick=function(e){var matches=window.location.hash.toString().match(/^#?\/?[0-9]+/);if(matches!==null){e.stop();if(Global&&Global.smoothScroll){Global.smoothScroll($(e.target).attr("href"),null,{set_hash:true,full_href:true})}}};Comment.prototype._onFormSubmitted=function(e){var self=this;if(e.comment_id!==self._comment_id){return}switch(e.action){case"edit":self._comment.html(e.elements);self.refresh();Signal.comments.tool.closed.dispatch({});break;case"delete":self.destroy();Signal.comments.deleted.dispatch({comment:self._comment});Signal.comments.tool.closed.dispatch({});break;case"spam":Signal.comments.spammed.dispatch({comment:self._comment});Signal.comments.tool.closed.dispatch({});self._spam_form.close();break}};Comment.prototype.destroy=function(){var self=this;if(self._edit_trigger.length>0){self._edit_trigger.off("click",self._bound_events.edit_click);self._edit_form.destroy()}if(self._create_case_trigger.length>0){self._create_case_trigger.off("click",self._bound_events.create_case_click);self._create_case_form.destroy()}if(self._delete_trigger.length>0){self._delete_trigger.off("click",self._bound_events.delete_click);self._delete_form.destroy()}if(self._permalink_trigger.length>0){self._permalink_trigger.off("click",self._bound_events.permalink_click)}if(self._spam_trigger.length>0){self._spam_trigger.off("click",self._bound_events.spam_click)}self._comment.off("click",".cancel",self._bound_events.cancel_click)};Comment.prototype.refresh=function(){var self=this;self.destroy();self._comment_forms=[];self._createElements(self._comment);self._attachEvents()};Comment.prototype.close=function(){var self=this;$.each(self._comment_forms,function(){this.close()});self._comment_text.show()};vimeo.comment=vimeo.comment||{};vimeo.comment.Comment=Comment})(vimeo);(function(vimeo){"use strict";var Creator=function(form){var self=this;self._createElements(form);self._attachEvents()};Creator.prototype._createElements=function(form){var self=this;self._form=form;self._comment_container=self._form.find(".js-form_container");self._comment_toggle=self._form.find(".js-comment_toggle");self._comment_guidelines_toggle=self._form.find(".js-guidelines_toggle");self._comment_guidelines=self._form.find(".js-guidelines");self._comment_macros=self._form.find(".js-forum_macro");self._comment_text=self._form.find("textarea")};Creator.prototype._attachEvents=function(){var self=this;self._bound_events={comment_toggle_click:self._onCommentToggleClick.bind(self),guideline_toggle_click:self._onCommentGuidelinesToggleClick.bind(self),comment_macros_change:self._onCommentMacrosChange.bind(self),comment_text_focus:self._onCommentTextFocus.bind(self)};self._comment_toggle.on("click",self._bound_events.comment_toggle_click);self._comment_guidelines_toggle.on("click",self._bound_events.guideline_toggle_click);self._comment_macros.on("change",self._bound_events.comment_macros_change);if(self._comment_text){self._comment_text.on("focus",self._bound_events.comment_text_focus)}if(self._form.length){self._form.validate({rules:{text:{required:true}},ignore:"",errorClass:"validation-failed",errorPlacement:function(error,element){},submitHandler:function(form,event){event.preventDefault();var submit_btns=self._form.find('input[type="submit"]'),group_id,context_type,form_data=self._form.serializeArray();if(vimeo.config&&vimeo.config.context){group_id=vimeo.config.context.split(":")[1];context_type=vimeo.config.context.split(":")[0]}form_data=form_data.concat([{name:"token",value:vimeo.xsrft},{name:"group_id",value:group_id},{name:"context_id",value:group_id},{name:"context_type",value:context_type}]);$.ajax({method:"post",url:self._form.attr("action"),data:form_data}).done(self._onAddCommentSuccess.bind(self)).fail(self._onAddCommentFailure.bind(self))}})}};Creator.prototype._initializeTribute=function(element){if(!element.hasAttribute("data-tribute")){var t=new Tribute({collection:[{values:window.vimeo.cur_user.following,menuItemTemplate:function(item){return'<div class="suggestion"><div class="list_item"><img class="portrait portrait_sm" src="'+item.original.img+'" srcset="'+item.original.retina+'"><div>'+item.original.key+"</div></div></div>"},selectClass:"selected"},{trigger:"#",values:window.vimeo.cur_user.tags,menuItemTemplate:function(item){return'<div class="suggestion"><div class="list_item"><div>'+item.original.key+"</div></div></div>"},selectTemplate:function(item){return"#"+item.original.value},selectClass:"selected"}]});t.attach(element)}};Creator.prototype._onAddCommentSuccess=function(html){var self=this,new_comment=$("<div>").html(html),is_sticky=new_comment.find(".sticky").length>0;Signal.comments.created.dispatch({comment:new_comment,is_sticky:is_sticky});if(self._form.length){self._form[0].reset()}};Creator.prototype._onAddCommentFailure=function(xhr){var self=this;Signal.comments.action_failed.dispatch({xhr:xhr,form:self._form})};Creator.prototype._onCommentToggleClick=function(e){var self=this;e.preventDefault();self.open();Signal.comments.tool.opened.dispatch({module:self})};Creator.prototype._onCommentGuidelinesToggleClick=function(e){e.preventDefault();this._comment_guidelines.toggle()};Creator.prototype._onCommentMacrosChange=function(e){var self=this,value=self._comment_macros.get("value"),comment_text=self._comment_text.get("value");if(comment_text&&value){comment_text+="\n\n"+value}else if(value){comment_text=value}self._comment_text.attr("value",comment_text)};Creator.prototype._onCommentTextFocus=function(e){var self=this;if(window.vimeo.cur_user.can_mention){if(window.vimeo.cur_user.following&&window.vimeo.cur_user.tags){return self._initializeTribute(e.target)}var xhr=new XMLHttpRequest,post_id=window.vimeo.config.content?window.vimeo.config.content.id:"";xhr.open("GET","/user"+window.vimeo.cur_user.id+"/following?action=get_following_for_mentions&type=blog&object_id="+post_id);xhr.send();xhr.addEventListener("load",function(){if(xhr.status===200){var response=JSON.parse(xhr.response);window.vimeo.cur_user.following=response.users;window.vimeo.cur_user.tags=response.tags;self._initializeTribute(e.target)}})}};Creator.prototype.close=function(){var self=this;self._comment_container.addClass("hide");self._comment_toggle.removeClass("hide")};Creator.prototype.open=function(){var self=this;self._comment_container.removeClass("hide");self._comment_toggle.addClass("hide")},Creator.prototype.destroy=function(){var self=this;self._comment_toggle.off("click",self._bound_events.comment_toggle_click);self._comment_guidelines_toggle.off("click",self._bound_events.guideline_toggle_click);self._comment_macros.off("change",self._bound_events.comment_macros_change)};vimeo.comment=vimeo.comment||{};vimeo.comment.Creator=Creator})(vimeo);(function(vimeo){"use strict";var defaults={action:null,comment_id:null,container:null,is_sticky:0,success_callback:null},Form;Form=function(options){var self=this;self.options=$.extend({},defaults,options);self._createElements();self._attachEvents()};Form.prototype._createElements=function(){var self=this;self._container=self.options.container;self._form=self._container.find("form")};Form.prototype._attachEvents=function(){var self=this;self._bound_events={cancel_click:self._onCancelClick.bind(self)};self._container.on("click",".cancel",self._bound_events.cancel_click);self._attachValidator()};Form.prototype._attachValidator=function(){var self=this;self._form.validate({rules:{text:{required:true}},ignore:"",errorClass:"validation-failed",errorPlacement:function(error,element){},submitHandler:function(form,event){event.preventDefault();var submit_btns=self._form.find('input[type="submit"]'),group_id,context_type,form_data=self._form.serializeArray();if(vimeo.config&&vimeo.config.context){group_id=vimeo.config.context.split(":")[1];context_type=vimeo.config.context.split(":")[0]}form_data=form_data.concat([{name:"token",value:vimeo.xsrft},{name:"group_id",value:group_id},{name:"context_id",value:group_id},{name:"context_type",value:context_type}]);$.ajax({method:"post",url:self._form.attr("action"),data:form_data}).done(self._onFormSubmitSuccess.bind(self)).fail(self._onFormSubmitFailure.bind(self))}})};Form.prototype._handleFormElements=function(){var self=this;self._comment_macros=self._container.find(".js-forum_macro");self._comment_text=self._container.find("textarea");self._bound_events.comment_macros_change=self._onCommentMacrosChange.bind(self);if(self._comment_macros){self._comment_macros.on("click",self._bound_events.comment_macros_change)}};Form.prototype._initializeTribute=function(element){if(!element.hasAttribute("data-tribute")){var t=new Tribute({collection:[{values:window.vimeo.cur_user.following,menuItemTemplate:function(item){return'<div class="suggestion"><div class="list_item"><img class="portrait portrait_sm" src="'+item.original.img+'" srcset="'+item.original.retina+'"><div>'+item.original.key+"</div></div></div>"},selectClass:"selected"},{trigger:"#",values:window.vimeo.cur_user.tags,menuItemTemplate:function(item){return'<div class="suggestion"><div class="list_item"><div>'+item.original.key+"</div></div></div>"},selectTemplate:function(item){return"#"+item.original.value},selectClass:"selected"}]});t.attach(element)}};Form.prototype._onGetFormSuccess=function(){var self=this;self._form=self._container.find("form");self._attachValidator();self._bound_events.comment_macros_change=self._onCommentMacrosChange.bind(self);self._form.on("change",".js-forum_macro",self._bound_events.comment_macros_change);self.open()};Form.prototype._onFormSubmitSuccess=function(response){var self=this,elements;if(self.options.success_callback){self.options.success_callback(response)}if(self._form.length){self._form[0].reset()}Signal.comments.form_submitted.dispatch({action:self.options.action,elements:response,comment_id:self.options.comment_id})};Form.prototype._onFormSubmitFailure=function(xhr){var self=this;Signal.comments.action_failed.dispatch({xhr:xhr,form:self._form})};Form.prototype._onCancelClick=function(){this.close()};Form.prototype._onCommentMacrosChange=function(e,element){var self=this,value=element.attr("value"),textarea=self._form.find("textarea"),comment_text=textarea.attr("value");if(comment_text&&value){comment_text+="\n\n"+value}else if(value){comment_text=value}textarea.set("value",comment_text)};Form.prototype.open=function(){var self=this,textarea;if(self._form.length===0){$.ajax({url:window.location,method:"get",data:{comment_id:self.options.comment_id,is_sticky:self.options.is_sticky,action:"comment_"+self.options.action+"_form"},success:function(html){self._container.html(html);self._onGetFormSuccess()}})}else{self._container.removeClass("hide");textarea=self._form.find("textarea");textarea.focus();if(window.vimeo.cur_user.can_mention){if(window.vimeo.cur_user.following&&window.vimeo.cur_user.tags){return self._initializeTribute(textarea[0])}var xhr=new XMLHttpRequest,post_id=window.vimeo.config.content?window.vimeo.config.content.id:"";xhr.open("GET","/user"+window.vimeo.cur_user.id+"/following?action=get_following_for_mentions&type=blog&object_id="+post_id);xhr.send();xhr.addEventListener("load",function(){if(xhr.status===200){var response=JSON.parse(xhr.response);window.vimeo.cur_user.following=response.users;window.vimeo.cur_user.tags=response.tags;self._initializeTribute(textarea[0])}})}}};Form.prototype.close=function(){this._container.addClass("hide")};Form.prototype.destroy=function(){var self=this;self._container.off("click",".cancel",self._bound_events.cancel_click);if(self._form){self._form.off("change",".js-forum_macro",self._bound_events.comment_macros_change)}};vimeo.comment=vimeo.comment||{};vimeo.comment.Form=Form})(vimeo);(function(vimeo){"use strict";var List=function(){var self=this;self._createElements();self._attachEvents()};List.prototype._createElements=function(){var self=this;self._comment_list=$(".js-comment_list");self._comment_form=$(".js-new_comment_form");self._comment_count=$(".js-comment_count");self._sticky_comments=$(".js-sticky_comments")};List.prototype._attachEvents=function(){var self=this;self._bound_events={comment_created:self._onCommentCreated.bind(self),comment_replied:self._onCommentReplied.bind(self),comment_deleted:self._onCommentDeleted.bind(self),comment_found:self._onCommentFound.bind(self),comment_spammed:self._onCommentSpammed.bind(self)};Signal.comments.created.add(self._bound_events.comment_created);Signal.comments.replied.add(self._bound_events.comment_replied);Signal.comments.deleted.add(self._bound_events.comment_deleted);Signal.comments.found.add(self._bound_events.comment_found);Signal.comments.spammed.add(self._bound_events.comment_spammed)};List.prototype._getTranslatedCountText=function(total){return Copy.translate("count_comments",total!==1,{COUNT:total})},List.prototype._destroyCommentElements=function(comment,replies){var self=this,article=comment;if(!comment.hasClass("reply")&&!comment.hasClass("sticky")){article=replies}article.remove()};List.prototype._updateCommentCount=function(value){var self=this,count;if(self._comment_count.length){count=self._comment_count.find(".js-counter");if(count.length===0){self._comment_count.html('<span id="count" class="js-counter">'+self._getTranslatedCountText(1)+"</span>")}else{count.text(self._getTranslatedCountText(parseInt(count.text(),10)+value))}}};List.prototype._injectComment=function(new_comment){var self=this,comment_elements=new_comment.find(".js-comment_element"),comment_id=comment_elements.attr("id");comment_elements.insertBefore(self._comment_form).fadeIn(250);return $("#"+comment_id)};List.prototype._injectStickyComment=function(comment){var self=this,comment_elements=comment.getElements(".js-comment_element"),comment_id=comment_elements.attr("id");comment_elements.insertAfter(self._comment_form).fadeIn(250);Global.scroll.toTop();self._sticky_comments.getParent().addClass("stickies_here");return $("#"+comment_id)};List.prototype._injectReply=function(reply,parent_id){var self=this,new_reply=$("<div>").html(reply).find(".js-comment_element"),parent_comment_id=new_reply.attr("data-parent-id"),last_reply=$("."+parent_id).last();last_reply.before(new_reply);new_reply.fadeIn(250);return $("#"+new_reply.attr("id"))};List.prototype._onCommentCreated=function(e){var self=this,is_sticky=e.is_sticky,comment;if(is_sticky){comment=self._injectStickyComment(e.comment)}else{comment=self._injectComment(e.comment)}self._updateCommentCount(1);Signal.comments.appended.dispatch({comment:comment})};List.prototype._onCommentReplied=function(e){var self=this,comment=self._injectReply(e.reply,e.parent_id);self._updateCommentCount(1);Signal.comments.appended.dispatch({comment:comment})};List.prototype._onCommentDeleted=function(e){var self=this,comment=e.comment,replies=$("."+comment.attr("id")),count_deleted=replies.length>0?-(replies.length-1):-1;self._updateCommentCount(count_deleted);self._destroyCommentElements(comment,replies)};List.prototype._onCommentSpammed=function(e){var self=this,comment=e.comment;comment.find(".js-spam_trigger").html("Marked as Spam").attr("disabled",true)};List.prototype._onCommentFound=function(e){Global.smoothScroll(e.comment)};List.prototype.destroy=function(){var self=this;Signal.comments.created.remove(self._bound_events.comment_created);Signal.comments.replied.remove(self._bound_events.comment_replied);Signal.comments.deleted.remove(self._bound_events.comment_deleted);Signal.comments.found.remove(self._bound_events.comment_found)};vimeo.comment=vimeo.comment||{};vimeo.comment.List=List})(vimeo);(function(vimeo){"use strict";var Reply=function(reply){var self=this;self._createElements(reply);self._attachEvents()};Reply.prototype._createElements=function(reply){var self=this;self._reply=reply;self._reply_toggle=self._reply.find(".reply");self._reply_form_container=self._reply.find(".js-form_container");self._parent_comment_id=self._reply.attr("data-parent-id").replace("comment_","");self._reply_form=new vimeo.comment.Form({action:"reply",comment_id:self._parent_comment_id,container:self._reply_form_container})};Reply.prototype._attachEvents=function(){var self=this;self._bound_events={reply_click:self._onReplyToggleClick.bind(self),form_submitted:self._onReplyFormSuccess.bind(self),cancel_click:self._onReplyCancelClick.bind(self)};if(self._reply_toggle){self._reply_toggle.on("click",self._bound_events.reply_click);self._reply_form_container.on("click",".cancel",self._bound_events.cancel_click)}Signal.comments.form_submitted.add(self._bound_events.form_submitted)};Reply.prototype._onReplyToggleClick=function(){var self=this;self._reply_form.open();Signal.comments.tool.opened.dispatch({module:self});self._reply_toggle.toggle()};Reply.prototype._onReplyCancelClick=function(e){Signal.comments.tool.closed.dispatch({});this._reply_toggle.toggle()};Reply.prototype._onReplyFormSuccess=function(e){var self=this;if(e.comment_id===self._parent_comment_id&&e.action==="reply"){Signal.comments.replied.dispatch({reply:e.elements,parent_id:self._reply.attr("data-parent-id")});self.close()}};Reply.prototype.destroy=function(){var self=this;if(self._reply_toggle.length){self._reply_toggle.off("click",self._onReplyToggleClick.bind(self));self._reply_form_container.off("click",".cancel",self._bound_events.cancel_click)}Signal.comments.form_submitted.remove(self._bound_events.form_submitted)};Reply.prototype.close=function(){this._reply_form.close();Signal.comments.tool.closed.dispatch({})};vimeo.comment=vimeo.comment||{};vimeo.comment.Reply=Reply})(vimeo);(function(vimeo){"use strict";var Pager=function(){var self=this;self._current_page=1;self._show_first_page=null;self._get_next_page=null;self._createElements();self._total_discussions=$("input.total_discussions").val();self._total_discussions_left=self._total_discussions-$(".js-comment.main").length;self._offset=parseInt($("input.offset").val(),10);self._page_size=parseInt($("input.page_size").val(),10);self._attachEvents()};Pager.prototype._createElements=function(){var self=this;self._comments=$(".js-comment_list");self._show_more_container=$(".js-show_more_container");self._show_more_title=self._show_more_container.find(".js-show_more_title");self._show_more_trigger=self._show_more_container.find(".js-show_more_trigger")};Pager.prototype._attachEvents=function(){var self=this;self._bound_events={show_more_trigger_click:self._onShowMoreClick.bind(self),get_next_page_click:self._onGetNextPageClick.bind(self),comment_page_appended:self._onCommentPageAppended.bind(self)};self._show_more_container.on("click",self._bound_events.show_more_trigger_click);self._comments.on("click",".js-get_next_page",self._bound_events.get_next_page_click);Signal.comments.page_appended.add(self._bound_events.comment_page_appended)},Pager.prototype._hideLoadingGif=function(){var self=this,loading=$(".js-loading"),get_next_page=self._comments.find(".js-get_next_page");if(loading){loading.hide()}if(get_next_page){get_next_page.show()}},Pager.prototype._showLoadingGif=function(){var self=this,loading=$(".js-loading"),get_next_page=self._comments.find(".js-get_next_page");if(loading){loading.show()}if(get_next_page){get_next_page.hide()}},Pager.prototype._getNextPage=function(page){var self=this,data={action:"comments"};if(page){data.page=page}else{data.offset=self._offset+self._page_size;data.page_size=Math.min(self._total_discussions_left,Math.max(self._offset,data.offset))}self._show_first_page=$.ajax({url:location.href,method:"get",data:data}).done(self._appendNext.bind(self))},Pager.prototype._appendNext=function(html){var self=this,doc=$(html),articles=doc.children("article"),page_size=parseInt(doc.find("input.page_size").val(),10),offset=parseInt(doc.find("input.offset").val(),10),more_text;self._offset=offset;self._page_size=page_size;if(self._show_more_container.length){self._show_more_container.before(articles)}else{$("#pagination").before(articles).remove()}self._total_discussions_left-=page_size;if(self._total_discussions_left>0){more_text=Copy.translate("additional_comment_count",self._total_discussions_left!==1,{COUNT:self._total_discussions_left});self._show_more_title.text(more_text)}else{self._show_more_container.hide()}Signal.comments.reset.dispatch({});self._onCommentPageAppended()};Pager.prototype._onShowMoreClick=function(e){var self=this;self._getNextPage();self._show_more_container.addClass("loading")},Pager.prototype._onGetNextPageClick=function(e){var self=this,$element=$(e.target),next_page=$element.data("page");self._showLoadingGif();self._getNextPage(next_page)},Pager.prototype._onCommentPageAppended=function(){var self=this,pagination_element=self._comments.find(".js-get_next_page");self._show_more_container.removeClass("loading");self._current_page++},Pager.prototype.getNextPage=function(){var self=this;if(self._next_page===null){return false}self._getNextPage();return true},Pager.prototype.destroy=function(){var self=this
;if(self._bound_events){if(self._show_first_page){self._show_first_page.abort()}if(self._get_next_page){self._get_next_page.abort()}self._show_more_container.off("click",self._bound_events.show_more_trigger_click);self._comments.off("click",".js-get_next_page",self._bound_events.get_next_page_click);Signal.comments.page_appended.remove(self._bound_events.comment_page_appended)}};vimeo.comment=vimeo.comment||{};vimeo.comment.Pager=Pager})(vimeo);"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}if(!Array.prototype.find){Array.prototype.find=function(predicate){if(this===null){throw new TypeError("Array.prototype.find called on null or undefined")}if(typeof predicate!=="function"){throw new TypeError("predicate must be a function")}var list=Object(this);var length=list.length>>>0;var thisArg=arguments[1];var value;for(var i=0;i<length;i++){value=list[i];if(predicate.call(thisArg,value,i,list)){return value}}return undefined}}(function(){if(typeof window.CustomEvent==="function")return false;function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent("CustomEvent");evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt}CustomEvent.prototype=window.Event.prototype;window.CustomEvent=CustomEvent})();{(function(){var Tribute=function(){function Tribute(_ref){var _this=this;var _ref$values=_ref.values;var values=_ref$values===undefined?null:_ref$values;var _ref$iframe=_ref.iframe;var iframe=_ref$iframe===undefined?null:_ref$iframe;var _ref$selectClass=_ref.selectClass;var selectClass=_ref$selectClass===undefined?"highlight":_ref$selectClass;var _ref$trigger=_ref.trigger;var trigger=_ref$trigger===undefined?"@":_ref$trigger;var _ref$selectTemplate=_ref.selectTemplate;var selectTemplate=_ref$selectTemplate===undefined?null:_ref$selectTemplate;var _ref$menuItemTemplate=_ref.menuItemTemplate;var menuItemTemplate=_ref$menuItemTemplate===undefined?null:_ref$menuItemTemplate;var _ref$lookup=_ref.lookup;var lookup=_ref$lookup===undefined?"key":_ref$lookup;var _ref$fillAttr=_ref.fillAttr;var fillAttr=_ref$fillAttr===undefined?"value":_ref$fillAttr;var _ref$collection=_ref.collection;var collection=_ref$collection===undefined?null:_ref$collection;var _ref$menuContainer=_ref.menuContainer;var menuContainer=_ref$menuContainer===undefined?null:_ref$menuContainer;_classCallCheck(this,Tribute);this.menuSelected=0;this.current={};this.inputEvent=false;this.isActive=false;this.menuContainer=menuContainer;if(values){this.collection=[{trigger:trigger,iframe:iframe,selectClass:selectClass,selectTemplate:(selectTemplate||Tribute.defaultSelectTemplate).bind(this),menuItemTemplate:(menuItemTemplate||Tribute.defaultMenuItemTemplate).bind(this),lookup:lookup,fillAttr:fillAttr,values:values}]}else if(collection){this.collection=collection.map(function(item){return{trigger:item.trigger||trigger,iframe:item.iframe||iframe,selectClass:item.selectClass||selectClass,selectTemplate:(item.selectTemplate||Tribute.defaultSelectTemplate).bind(_this),menuItemTemplate:(item.menuItemTemplate||Tribute.defaultMenuItemTemplate).bind(_this),lookup:item.lookup||lookup,fillAttr:item.fillAttr||fillAttr,values:item.values}})}else{throw new Error("[Tribute] No collection specified.")}new TributeRange(this);new TributeEvents(this);new TributeMenuEvents(this);new TributeSearch(this)}_createClass(Tribute,[{key:"triggers",value:function triggers(){return this.collection.map(function(config){return config.trigger})}},{key:"attach",value:function attach(el){if(!el){throw new Error("[Tribute] Must pass in a DOM node or NodeList.")}if(typeof jQuery!=="undefined"&&el instanceof jQuery){el=el.get()}if(el.constructor===NodeList||el.constructor===HTMLCollection||el.constructor===Array){var length=el.length;for(var i=0;i<length;++i){this._attach(el[i])}}else{this._attach(el)}}},{key:"_attach",value:function _attach(el){if(el.hasAttribute("data-tribute")){console.warn("Tribute was already bound to "+el.nodeName)}this.ensureEditable(el);this.events.bind(el);el.setAttribute("data-tribute",true)}},{key:"ensureEditable",value:function ensureEditable(element){if(Tribute.inputTypes().indexOf(element.nodeName)===-1){if(element.contentEditable){element.contentEditable=true}else{throw new Error("[Tribute] Cannot bind to "+element.nodeName)}}}},{key:"createMenu",value:function createMenu(){var wrapper=this.range.getDocument().createElement("div"),ul=this.range.getDocument().createElement("ul");wrapper.className="tribute-container";wrapper.appendChild(ul);if(this.menuContainer){return this.menuContainer.appendChild(wrapper)}return this.range.getDocument().body.appendChild(wrapper)}},{key:"showMenuFor",value:function showMenuFor(element,collectionItem){var _this2=this;var items=void 0;if(!this.menu){this.menu=this.createMenu();this.menuEvents.bind(this.menu)}this.isActive=true;this.menuSelected=0;if(!this.current.mentionText){this.current.mentionText=""}items=this.search.filter(this.current.mentionText,this.current.collection.values,{pre:"<span>",post:"</span>",extract:function extract(el){return el[_this2.current.collection.lookup]}});this.current.filteredItems=items;if(!items.length){this.hideMenu();return}var ul=this.menu.querySelector("ul");ul.innerHTML="";items.forEach(function(item,index){var li=_this2.range.getDocument().createElement("li");li.setAttribute("data-index",index);if(_this2.menuSelected===index){li.className=_this2.current.collection.selectClass}li.innerHTML=_this2.current.collection.menuItemTemplate(item);ul.appendChild(li)});this.range.positionMenuAtCaret()}},{key:"hideMenu",value:function hideMenu(){if(this.menu){this.menu.style.cssText="display: none;";this.isActive=false;this.menuSelected=0;this.current={}}}},{key:"selectItemAtIndex",value:function selectItemAtIndex(index){var item=this.current.filteredItems[index];var content=this.current.collection.selectTemplate(item);this.replaceText(content)}},{key:"replaceText",value:function replaceText(content){this.range.replaceTriggerText(content,true,true)}}],[{key:"defaultSelectTemplate",value:function defaultSelectTemplate(item){return"@"+item.original[this.current.collection.fillAttr]}},{key:"defaultMenuItemTemplate",value:function defaultMenuItemTemplate(matchItem){return matchItem.string}},{key:"inputTypes",value:function inputTypes(){return["TEXTAREA","INPUT"]}}]);return Tribute}();var TributeMenuEvents=function(){function TributeMenuEvents(tribute){_classCallCheck(this,TributeMenuEvents);this.tribute=tribute;this.tribute.menuEvents=this;this.menu=this.tribute.menu}_createClass(TributeMenuEvents,[{key:"bind",value:function bind(menu){var _this3=this;menu.addEventListener("keydown",this.tribute.events.keydown.bind(this.menu,this),false);this.tribute.range.getDocument().addEventListener("click",this.tribute.events.click.bind(null,this),false);window.addEventListener("resize",this.debounce(function(){if(_this3.tribute.isActive){_this3.tribute.showMenuFor(_this3.tribute.current.element)}},300,false))}},{key:"debounce",value:function debounce(func,wait,immediate){var _this4=this,_arguments=arguments;var timeout;return function(){var context=_this4,args=_arguments;var later=function later(){timeout=null;if(!immediate)func.apply(context,args)};var callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(later,wait);if(callNow)func.apply(context,args)}}}]);return TributeMenuEvents}();var TributeEvents=function(){function TributeEvents(tribute){_classCallCheck(this,TributeEvents);this.tribute=tribute;this.tribute.events=this}_createClass(TributeEvents,[{key:"bind",value:function bind(element){element.addEventListener("keydown",this.keydown.bind(element,this),false);element.addEventListener("keyup",this.keyup.bind(element,this),false);element.addEventListener("input",this.input.bind(element,this),false)}},{key:"keydown",value:function keydown(instance,event){if(instance.shouldDeactivate(event)){instance.tribute.isActive=false}var element=this;instance.commandEvent=false;TributeEvents.keys().forEach(function(o){if(o.key===event.keyCode){instance.commandEvent=true;instance.callbacks()[o.value.toLowerCase()](event,element)}})}},{key:"input",value:function input(instance,event){instance.inputEvent=true;instance.keyup.call(this,instance,event)}},{key:"click",value:function click(instance,event){var tribute=instance.tribute;if(tribute.menu&&tribute.menu.contains(event.target)){var li=event.target;while(li.nodeName.toLowerCase()!=="li"){li=li.parentNode;if(!li||li===tribute.menu){throw new Error("cannot find the <li> container for the click")}}tribute.selectItemAtIndex(li.getAttribute("data-index"));tribute.hideMenu()}else if(tribute.current.element){tribute.hideMenu()}}},{key:"keyup",value:function keyup(instance,event){var _this5=this;if(instance.inputEvent){instance.inputEvent=false}instance.updateSelection(this);if(event.keyCode===27)return;if(!instance.tribute.isActive){var _ret2=function(){var keyCode=instance.getKeyCode(instance,_this5,event);if(isNaN(keyCode))return{v:void 0};var trigger=instance.tribute.triggers().find(function(trigger){return trigger.charCodeAt(0)===keyCode});if(typeof trigger!=="undefined"){instance.callbacks().triggerChar(event,_this5,trigger)}}();if((typeof _ret2==="undefined"?"undefined":_typeof(_ret2))==="object")return _ret2.v}if(instance.tribute.current.trigger&&instance.commandEvent===false){instance.tribute.showMenuFor(this)}}},{key:"shouldDeactivate",value:function shouldDeactivate(event){if(!this.tribute.isActive)return false;if(this.tribute.current.mentionText.length===0){var eventKeyPressed=false;TributeEvents.keys().forEach(function(o){if(event.keyCode===o.key)eventKeyPressed=true});return!eventKeyPressed}return false}},{key:"getKeyCode",value:function getKeyCode(instance,el,event){var char=void 0;var tribute=instance.tribute;var info=tribute.range.getTriggerInfo(false,false,true);if(info){return info.mentionTriggerChar.charCodeAt(0)}else{return false}}},{key:"updateSelection",value:function updateSelection(el){this.tribute.current.element=el;var info=this.tribute.range.getTriggerInfo(false,false,true);if(info){this.tribute.current.selectedPath=info.mentionSelectedPath;this.tribute.current.mentionText=info.mentionText;this.tribute.current.selectedOffset=info.mentionSelectedOffset}}},{key:"callbacks",value:function callbacks(){var _this6=this;return{triggerChar:function triggerChar(e,el,trigger){var tribute=_this6.tribute;tribute.current.trigger=trigger;var collectionItem=tribute.collection.find(function(item){return item.trigger===trigger});tribute.current.collection=collectionItem;tribute.showMenuFor(el)},enter:function enter(e,el){if(_this6.tribute.isActive){e.preventDefault();setTimeout(function(){_this6.tribute.selectItemAtIndex(_this6.tribute.menuSelected);_this6.tribute.hideMenu()},0)}},escape:function escape(e,el){if(_this6.tribute.isActive){e.preventDefault();_this6.tribute.hideMenu()}},tab:function tab(e,el){_this6.callbacks().enter(e,el)},up:function up(e,el){if(_this6.tribute.isActive){e.preventDefault();var count=_this6.tribute.current.filteredItems.length,selected=_this6.tribute.menuSelected;if(count>selected&&selected>0){_this6.tribute.menuSelected--;_this6.setActiveLi()}}},down:function down(e,el){if(_this6.tribute.isActive){e.preventDefault();var count=_this6.tribute.current.filteredItems.length-1,selected=_this6.tribute.menuSelected;if(count>selected){_this6.tribute.menuSelected++;_this6.setActiveLi()}}}}}},{key:"setActiveLi",value:function setActiveLi(index){var lis=this.tribute.menu.querySelectorAll("li"),length=lis.length>>>0;for(var i=0;i<length;i++){var li=lis[i];if(i===this.tribute.menuSelected){li.className=this.tribute.current.collection.selectClass}else{li.className=""}}}}],[{key:"keys",value:function keys(){return[{key:9,value:"TAB"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}}]);return TributeEvents}();var TributeRange=function(){function TributeRange(tribute){_classCallCheck(this,TributeRange);this.tribute=tribute;this.tribute.range=this}_createClass(TributeRange,[{key:"getDocument",value:function getDocument(){var iframe=void 0;if(this.tribute.current.collection){iframe=this.tribute.current.collection.iframe}if(!iframe){return document}return iframe.contentWindow.document}},{key:"positionMenuAtCaret",value:function positionMenuAtCaret(){var _this7=this;var context=this.tribute.current,coordinates=void 0;var info=this.getTriggerInfo(false,false,true);if(info!==undefined){if(!this.isContentEditable(context.element)){coordinates=this.getTextAreaOrInputUnderlinePosition(this.getDocument().activeElement,info.mentionPosition)}else{coordinates=this.getContentEditableCaretPosition(info.mentionPosition)}this.tribute.menu.style.cssText="top: "+coordinates.top+"px;\n                                           left: "+coordinates.left+"px;\n                                           position: absolute;\n                                           zIndex: 10000;\n                                           display: block;";setTimeout(function(){_this7.scrollIntoView(_this7.getDocument().activeElement)},0)}else{this.tribute.menu.style.cssText="display: none"}}},{key:"selectElement",value:function selectElement(targetElement,path,offset){var range=void 0;var elem=targetElement;if(path){for(var i=0;i<path.length;i++){elem=elem.childNodes[path[i]];if(elem===undefined){return}while(elem.length<offset){offset-=elem.length;elem=elem.nextSibling}if(elem.childNodes.length===0&&!elem.length){elem=elem.previousSibling}}}var sel=this.getWindowSelection();range=this.getDocument().createRange();range.setStart(elem,offset);range.setEnd(elem,offset);range.collapse(true);try{sel.removeAllRanges()}catch(error){}sel.addRange(range);targetElement.focus()}},{key:"resetSelection",value:function resetSelection(targetElement,path,offset){if(!this.isContentEditable(targetElement)){if(targetElement!==this.getDocument().activeElement){targetElement.focus()}}else{this.selectElement(targetElement,path,offset)}}},{key:"replaceTriggerText",value:function replaceTriggerText(text,requireLeadingSpace,hasTrailingSpace){var context=this.tribute.current;this.resetSelection(context.element,context.selectedPath,context.selectedOffset);var info=this.getTriggerInfo(requireLeadingSpace,true,hasTrailingSpace);var replaceEvent=new CustomEvent("tribute-replaced",{detail:text});if(info!==undefined){if(!this.isContentEditable(context.element)){var myField=this.getDocument().activeElement;text+=" ";var startPos=info.mentionPosition;var endPos=info.mentionPosition+info.mentionText.length+1;myField.value=myField.value.substring(0,startPos)+text+myField.value.substring(endPos,myField.value.length);myField.selectionStart=startPos+text.length;myField.selectionEnd=startPos+text.length}else{text+=" ";this.pasteHtml(text,info.mentionPosition,info.mentionPosition+info.mentionText.length+1)}context.element.dispatchEvent(replaceEvent)}}},{key:"pasteHtml",value:function pasteHtml(html,startPos,endPos){var range=void 0,sel=void 0;sel=this.getWindowSelection();range=this.getDocument().createRange();range.setStart(sel.anchorNode,startPos);range.setEnd(sel.anchorNode,endPos);range.deleteContents();var el=this.getDocument().createElement("div");el.innerHTML=html;var frag=this.getDocument().createDocumentFragment(),node=void 0,lastNode=void 0;while(node=el.firstChild){lastNode=frag.appendChild(node)}range.insertNode(frag);if(lastNode){range=range.cloneRange();range.setStartAfter(lastNode);range.collapse(true);sel.removeAllRanges();sel.addRange(range)}}},{key:"getWindowSelection",value:function getWindowSelection(){if(this.tribute.collection.iframe){return this.tribute.collection.iframe.contentWindow.getSelection()}return window.getSelection()}},{key:"getNodePositionInParent",value:function getNodePositionInParent(element){if(element.parentNode===null){return 0}for(var i=0;i<element.parentNode.childNodes.length;i++){var node=element.parentNode.childNodes[i];if(node===element){return i}}}},{key:"getContentEditableSelectedPath",value:function getContentEditableSelectedPath(){var sel=this.getWindowSelection();var selected=sel.anchorNode;var path=[];var offset=void 0;if(selected!=null){var i=void 0;var ce=selected.contentEditable;while(selected!==null&&ce!=="true"){i=this.getNodePositionInParent(selected);path.push(i);selected=selected.parentNode;if(selected!==null){ce=selected.contentEditable}}path.reverse();offset=sel.getRangeAt(0).startOffset;return{selected:selected,path:path,offset:offset}}}},{key:"getTextPrecedingCurrentSelection",value:function getTextPrecedingCurrentSelection(){var context=this.tribute.current,text=void 0;if(!this.isContentEditable(context.element)){var textComponent=this.getDocument().activeElement;var startPos=textComponent.selectionStart;text=textComponent.value.substring(0,startPos)}else{var selectedElem=this.getWindowSelection().anchorNode;if(selectedElem!=null){var workingNodeContent=selectedElem.textContent;var selectStartOffset=this.getWindowSelection().getRangeAt(0).startOffset;if(selectStartOffset>=0){text=workingNodeContent.substring(0,selectStartOffset)}}}return text}},{key:"getTriggerInfo",value:function getTriggerInfo(menuAlreadyActive,hasTrailingSpace,requireLeadingSpace){var _this8=this;var ctx=this.tribute.current;var selected=void 0,path=void 0,offset=void 0;if(!this.isContentEditable(ctx.element)){selected=this.getDocument().activeElement}else{var selectionInfo=this.getContentEditableSelectedPath();if(selectionInfo){selected=selectionInfo.selected;path=selectionInfo.path;offset=selectionInfo.offset}}var effectiveRange=this.getTextPrecedingCurrentSelection();if(effectiveRange!==undefined&&effectiveRange!==null){var _ret3=function(){var mostRecentTriggerCharPos=-1;var triggerChar=void 0;_this8.tribute.triggers().forEach(function(c){var idx=effectiveRange.lastIndexOf(c);if(idx>mostRecentTriggerCharPos){mostRecentTriggerCharPos=idx;triggerChar=c}});if(mostRecentTriggerCharPos>=0&&(mostRecentTriggerCharPos===0||!requireLeadingSpace||/[\xA0\s]/g.test(effectiveRange.substring(mostRecentTriggerCharPos-1,mostRecentTriggerCharPos)))){var currentTriggerSnippet=effectiveRange.substring(mostRecentTriggerCharPos+1,effectiveRange.length);triggerChar=effectiveRange.substring(mostRecentTriggerCharPos,mostRecentTriggerCharPos+1);var firstSnippetChar=currentTriggerSnippet.substring(0,1);var leadingSpace=currentTriggerSnippet.length>0&&(firstSnippetChar===" "||firstSnippetChar===" ");if(hasTrailingSpace){currentTriggerSnippet=currentTriggerSnippet.trim()}if(!leadingSpace&&(menuAlreadyActive||!/[\xA0\s]/g.test(currentTriggerSnippet))){return{v:{mentionPosition:mostRecentTriggerCharPos,mentionText:currentTriggerSnippet,mentionSelectedElement:selected,mentionSelectedPath:path,mentionSelectedOffset:offset,mentionTriggerChar:triggerChar}}}}}();if((typeof _ret3==="undefined"?"undefined":_typeof(_ret3))==="object")return _ret3.v}}},{key:"isContentEditable",value:function isContentEditable(element){return element.nodeName!=="INPUT"&&element.nodeName!=="TEXTAREA"}},{key:"getTextAreaOrInputUnderlinePosition",value:function getTextAreaOrInputUnderlinePosition(element,position){var properties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"];var isFirefox=window.mozInnerScreenX!==null;var div=this.getDocument().createElement("div");div.id="input-textarea-caret-position-mirror-div";this.getDocument().body.appendChild(div);var style=div.style;var computed=window.getComputedStyle?getComputedStyle(element):element.currentStyle;style.whiteSpace="pre-wrap";if(element.nodeName!=="INPUT"){style.wordWrap="break-word"}style.position="absolute";style.visibility="hidden";properties.forEach(function(prop){style[prop]=computed[prop]});if(isFirefox){style.width=parseInt(computed.width)-2+"px";if(element.scrollHeight>parseInt(computed.height))style.overflowY="scroll"}else{style.overflow="hidden"}div.textContent=element.value.substring(0,position);if(element.nodeName==="INPUT"){div.textContent=div.textContent.replace(/\s/g," ")}var span=this.getDocument().createElement("span");span.textContent=element.value.substring(position)||".";div.appendChild(span);var rect=element.getBoundingClientRect();var doc=document.documentElement;var windowLeft=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0);var windowTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0);var coordinates={top:rect.top+windowTop+span.offsetTop+parseInt(computed.borderTopWidth)+parseInt(computed.fontSize),left:rect.left+windowLeft+span.offsetLeft+parseInt(computed.borderLeftWidth)};this.getDocument().body.removeChild(div);return coordinates}},{key:"getContentEditableCaretPosition",value:function getContentEditableCaretPosition(selectedNodePosition){var markerTextChar="\ufeff";var markerEl=void 0,markerId="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2);var range=void 0;var sel=this.getWindowSelection();var prevRange=sel.getRangeAt(0);range=this.getDocument().createRange();range.setStart(sel.anchorNode,selectedNodePosition);range.setEnd(sel.anchorNode,selectedNodePosition);range.collapse(false);markerEl=this.getDocument().createElement("span");markerEl.id=markerId;markerEl.appendChild(this.getDocument().createTextNode(markerTextChar));range.insertNode(markerEl);sel.removeAllRanges();sel.addRange(prevRange);var rect=markerEl.getBoundingClientRect();var coordinates={left:rect.left,top:rect.top+markerEl.offsetHeight};markerEl.parentNode.removeChild(markerEl);return coordinates}},{key:"scrollIntoView",value:function scrollIntoView(elem){var reasonableBuffer=20,clientRect=void 0;var maxScrollDisplacement=100;var e=elem;while(clientRect===undefined||clientRect.height===0){clientRect=e.getBoundingClientRect();if(clientRect.height===0){e=e.childNodes[0];if(e===undefined||!e.getBoundingClientRect){return}}}var elemTop=clientRect.top;var elemBottom=elemTop+clientRect.height;if(elemTop<0){window.scrollTo(0,window.pageYOffset+clientRect.top-reasonableBuffer)}else if(elemBottom>window.innerHeight){var maxY=window.pageYOffset+clientRect.top-reasonableBuffer;if(maxY-window.pageYOffset>maxScrollDisplacement){maxY=window.pageYOffset+maxScrollDisplacement}var targetY=window.pageYOffset-(window.innerHeight-elemBottom);if(targetY>maxY){targetY=maxY}window.scrollTo(0,targetY)}}}]);return TributeRange}();var TributeSearch=function(){function TributeSearch(tribute){_classCallCheck(this,TributeSearch);this.tribute=tribute;this.tribute.search=this}_createClass(TributeSearch,[{key:"simpleFilter",value:function simpleFilter(pattern,array){var _this9=this;return array.filter(function(string){return _this9.test(pattern,string)})}},{key:"test",value:function test(pattern,string){return this.match(pattern,string)!==null}},{key:"match",value:function match(pattern,string,opts){opts=opts||{};var patternIdx=0,result=[],len=string.length,totalScore=0,currScore=0,pre=opts.pre||"",post=opts.post||"",compareString=opts.caseSensitive&&string||string.toLowerCase(),ch=void 0,compareChar=void 0;pattern=opts.caseSensitive&&pattern||pattern.toLowerCase();var patternCache=this.traverse(compareString,pattern,0,0,[]);if(!patternCache){return null}return{rendered:this.render(string,patternCache.cache,pre,post),score:patternCache.score}}},{key:"traverse",value:function traverse(string,pattern,stringIndex,patternIndex,patternCache){if(pattern.length===patternIndex){return{score:this.calculateScore(patternCache),cache:patternCache.slice()}}if(string.length===stringIndex||pattern.length-patternIndex>string.length-stringIndex){return undefined}var c=pattern[patternIndex];var index=string.indexOf(c,stringIndex);var best=void 0,temp=void 0;while(index>-1){patternCache.push(index);temp=this.traverse(string,pattern,index+1,patternIndex+1,patternCache);patternCache.pop();if(!temp){return best}if(!best||best.score<temp.score){best=temp}index=string.indexOf(c,index+1)}return best}},{key:"calculateScore",value:function calculateScore(patternCache){var score=0;var temp=1;patternCache.forEach(function(index,i){if(i>0){if(patternCache[i-1]+1===index){temp+=temp+1}else{temp=1}}score+=temp});return score}},{key:"render",value:function render(string,indices,pre,post){var rendered=string.substring(0,indices[0]);indices.forEach(function(index,i){rendered+=pre+string[index]+post+string.substring(index+1,indices[i+1]?indices[i+1]:string.length)});return rendered}},{key:"filter",value:function filter(pattern,arr,opts){var _this10=this;opts=opts||{};return arr.reduce(function(prev,element,idx,arr){var str=element;if(opts.extract){str=opts.extract(element);if(!str){str=""}}var rendered=_this10.match(pattern,str,opts);if(rendered!=null){prev[prev.length]={string:rendered.rendered,score:rendered.score,index:idx,original:element}}return prev},[]).sort(function(a,b){var compare=b.score-a.score;if(compare)return compare;return a.index-b.index})}}]);return TributeSearch}();window.Tribute=Tribute})()}!function(t){function e(n){if(i[n])return i[n].exports;var s=i[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,e),s.l=!0,s.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=1)}([function(t,e){t.exports=jQuery},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(){N.each(function(t,e){var i=(0,k.default)("<br>"),n=(0,k.default)(e),s=parseInt(n.data("ellipsis"),10),r=n.data("ellipsis-text");r?n.text(r):(r=n.text().trim(),n.attr("data-ellipsis-text",r));var o=n.height();n.prepend(i);var a=n.height()-o;i.remove();var u=o/a;if(!(u<=s))for(;u>s;)r=r.replace(/(\s*\S+\s*)$/,"&hellip;"),n.html(r),u=n.height()/a})}function r(t){var e=(0,k.default)(t.currentTarget).attr("href"),i=window.screenLeft?window.screenLeft:window.screenX,n=i+window.innerWidth/2-335,s=window.innerHeight/3;t.preventDefault(),window.open(e,"popup","width=670,height=400,top="+s+",left="+n+",titlebar=no,toolbar=no,tab bar=no,fullscreen=no,menubar=no,status=no"),(0,k.default)(t.target).blur()}function o(t,e){e.items&&e.items.length&&t.find("a").each(function(t,i){var n=(0,k.default)(i),s=e.items[t];n.attr("href",s.link);var r=(0,k.default)("<img>");r.attr("alt",s.caption.text),n.parent().hasClass("instagram_tile_lg")?(r.attr("src",s.images.low_resolution.url),r.attr("srcset",s.images.standard_resolution.url+" 2x")):(r.attr("src",s.images.thumbnail.url),r.attr("srcset",s.images.low_resolution.url+" 2x")),n.append(r)})}function a(){(0,k.default)(".js-rail_instagram").each(function(t,e){var i=(0,k.default)(e);i.children().length;k.default.ajax({url:"/blog/instagram",dataType:"json"}).done(function(t){o(i,t)})})}function u(t){(0,k.default)(".js-social_count_comments").each(function(e,i){i.textContent=parseInt(i.textContent,10)+t})}function h(t){u(-1*(1+t.comment.find(".replies .js-comment").length))}function c(t){if(13===t.keyCode){(0,k.default)(t.target).parent("form").submit()}}function l(t){(0,k.default)(t.relatedTarget).hasClass("btn_nav_search")&&(0,k.default)(t.target.focus())}function d(t){(0,k.default)(t.target).closest("form").submit()}function f(t){var e=(0,k.default)(t.target).closest("form").find("input[type=text]")[0];document.activeElement!==e&&(t.preventDefault(),e.focus())}function p(t){var e=t.closest("form");setTimeout(function(){e.removeClass("subscribe_form_warning subscribe_form_error")},5e3),e.removeClass("alert_left alert_right");var i=e.find(".subscribe_email").first(),n=(0,k.default)(window).width(),s=i.offset().left+i.outerWidth()+t.outerWidth();return s<n?void e.addClass("alert_right"):(s=s-i.outerWidth()-2*t.outerWidth(),s>=0?void e.addClass("alert_left"):void 0)}function v(t){var e=(0,k.default)(".btn_subscribe").addClass("btn_processing").attr("disabled",!0),i=k.default.ajax({url:"/blog/subscribe",method:"POST",data:{email:t,token:C.default.xsrft}});i.done(function(t){var e=(0,k.default)(".js-subscribe_form:visible");e.removeClass("subscribe_form_error subscribe_form_warning"),t.success?(e.addClass("subscribe_form_success"),window._gtm.push({event:"blog_newsletter_subscribe_click"})):"duplicate"===t.error?(p(e.find(".subscribe_warning").first()),e.addClass("subscribe_form_warning")):(p(e.find(".subscribe_error").first()),e.addClass("subscribe_form_error"))}),i.fail(function(t){return(0,k.default)(".js-subscribe_form").addClass("subscribe_form_error")}),i.always(function(){return e.removeClass("btn_processing").removeAttr("disabled")})}function _(t){t.preventDefault();var e=(0,k.default)(t.target);e.removeClass("subscribe_form_error subscribe_form_warning");var i=/^(?:[a-z0-9!#$%&'*+\/=?\^_`{|}~-]\.?){0,63}[a-z0-9!#$%&'*+\/=?\^_`{|}~-]@(?:(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)*[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\])$/i,n=e.find(".js-subscribe_email").val().trim();n.length>0&&i.test(n)?v(n):(p(e.find(".subscribe_error").first()),e.addClass("subscribe_form_error"))}function m(){P.each(function(t,e){var i=(0,k.default)(e),n=i.parent().width();i.width(n).height(n*i.data("aspect-ratio"))})}function g(){P.each(function(t,e){var i=(0,k.default)(e);i.data("aspect-ratio",i.height()/i.width())}),m()}function y(t){var e=(0,k.default)(t.target),i=parseInt(e.data("next-page"),10),n=parseInt(e.data("year"),10);e.text("Loading..."),e.attr("disabled",!0),k.default.ajax({url:"/blog/archive",method:"GET",data:{page:i,year:n}}).done(function(t){e.remove();var i=(0,k.default)(t),n=i.find(".js-archive_month").first().text();if(n===(0,k.default)(".js-archive_month").last().text()){var s=i.find(".js-archive_month_container_"+n).first();s.remove();var r=s.find(".js-archive_item");s=(0,k.default)(".js-archive_month_container_"+n),s.find(".js-archive_month_list").first().append(r)}(0,k.default)(".js-archive_container").append(i)})}function b(t){var e=(0,k.default)(t.target),i=e.closest("form"),n=e.val();i.attr("action",i.attr("action")+n),i.submit()}function w(){m(),setTimeout(s,250)}function T(){var t=k.default.debounce(250,w);(0,k.default)(window).resize(t),(0,k.default)(document).on("click",".js-archive_load_more",y),(0,k.default)(".js-archive_year_select").change(b),(0,k.default)(".js-search_form").submit(f),(0,k.default)(".js-search_field").keydown(c),(0,k.default)(".js-search_field").blur(l),(0,k.default)(".js-search_sort_select").change(d),(0,k.default)(".js-social_share").click(r),(0,k.default)(".js-subscribe_form").submit(_),(0,k.default)(".preview_thumbnail_link").hover(function(t){return(0,k.default)(t.currentTarget).siblings(".preview_title").toggleClass("preview_title_hover")}),(0,k.default)(".js-blog_nav_toggle").click(function(){
return(0,k.default)(".js-blog_nav").toggleClass("blog_nav_open")}),(0,k.default)(".js-hero_container").click(function(t){"A"!==t.target.nodeName&&(window.location=(0,k.default)(t.currentTarget).data("href"))}),$.default.comments.appended.add(u.bind(window,1)),$.default.comments.deleted.add(h,window,$.default.comments.deleted.getNumListeners())}var x=i(2),C=n(x),E=i(0),k=n(E),I=i(3),$=n(I),z=i(4),A=n(z),N=void 0,P=void 0;window._gtm=window._gtm||[],function(){C.default.comment.CommentController.initialize(),(0,k.default)(".js-carousel").each(function(t,e){new A.default(e,{autoplay_delay:0,show_secondary_nav:!0,enable_responsive:!0,responsive_breakpoints:{770:"static"}})}),N=(0,k.default)("[data-ellipsis]"),P=(0,k.default)('iframe[src*="player.vimeo.com"]'),a(),g(),s(),T()}()},function(t,e){t.exports=vimeo},function(t,e){t.exports=Signal},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),o=i(0),a=n(o),u=i(5),h=n(u),c={autoplay_delay:1e4,start_slide:0,infinite:!0,previous_button:null,next_button:null,show_secondary_nav:!1,stop_with_interaction:!0,pause_on_hover:!0,enable_responsive:!0,responsive_breakpoints:{},transition_easing:"ease",transition_time:250,pan_distance_threshold:.25,container_class:"carousel",slide_class:"carousel_slide",slide_clone_class:"carousel_slide--clone",slide_active_class:"carousel_slide--active",secondary_nav_class:"carousel_nav",nav_item_class:"carousel_nav_item",nav_item_active_class:"carousel_nav_item--active",onChange:function(){},onPrevious:function(){},onNext:function(){}},l=function(){function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(s(this,t),!e)throw new Error("Carousel initialized with a null container");if(this._is_new=!0,this._uid="carousel"+Date.now(),this._initial_options=a.default.extend({},c,n),this._breakpoint=null,this._processBreakpointOptions(),this.$container=(0,a.default)(e),this.$container.addClass(this.options.container_class),this.$slides=this.$container.children(),this.$slides.each(function(t,e){return(0,a.default)(e).addClass(i.options.slide_class)}),this.$slides.length<2)throw new Error("Carousel initialized with less than 2 slides");this.options.enable_responsive&&(0,a.default)(window).off("."+this._uid).on("resize."+this._uid,function(t){i._resize_throttle&&clearTimeout(i._resize_throttle),i._resize_throttle=window.setTimeout(function(){i._onWindowResize(t)},200)}),this.init()}return r(t,[{key:"init",value:function(){if(this._is_new||this.destroy(),!this._static){if(this.options.pan_distance_threshold<0||this.options.pan_distance_threshold>1)throw new Error("Carousel pan threshold must be between 0 and 1, "+this.options.pan_distance_threshold+" given");if(this._current_index=this.options.start_slide,this.options.infinite){var t=this.$slides.first().clone();t.addClass(this.options.slide_clone_class),this.$container.append(t),t=this.$slides.last().clone(),t.addClass(this.options.slide_clone_class),this.$container.prepend(t),this._current_index++}var e=100/this.$container.children().length+"%";this.$container.children().each(function(t,i){return(0,a.default)(i).css("width",e)}),this.options.show_secondary_nav&&this._createSecondaryNav(),this._attachEvents(),this.resize(),this.play(),this.$container[0].offsetHeight,this._enableTransitions(),this._is_new=!1}}},{key:"destroy",value:function(){var t=this;this.stop(),this.$container.css({transform:"",transition:"",width:""}),this.$container.off(".carousel"),this.$container.children().each(function(e,i){var n=(0,a.default)(i);n.hasClass(t.options.slide_clone_class)?n.remove():n.css("width","").removeClass(t.options.slide_active_class)}),(0,a.default)(this.options.previous_button).off(".carousel"),(0,a.default)(this.options.next_button).off(".carousel"),this.$secondary_nav&&(this.$secondary_nav.off(".carousel"),this.$secondary_nav.remove(),this.$secondary_nav=null),this._hammer&&(this._hammer.destroy(),this._hammer=null),this._is_new=!0}},{key:"play",value:function(){this.playing=!0,this._continue()}},{key:"pause",value:function(){clearTimeout(this._interval),this._interval=null}},{key:"stop",value:function(){this.playing=!1,this.pause()}},{key:"show",value:function(t){if(t<0||t>this.$slides.length-1)throw new Error("Slide index out of bounds: "+t);var e=t;if(this.options.infinite&&(e=t+1),this.pause(),this._current_index=e,this.$slides.removeClass(this.options.slide_active_class),this.$slides.eq(t).addClass(this.options.slide_active_class),this._moveContainerTo(e),this.$secondary_nav&&this.$secondary_nav.length){var i=this.$secondary_nav.find("."+this.options.nav_item_class);i.removeClass(this.options.nav_item_active_class),i.eq(t).addClass(this.options.nav_item_active_class)}this._continue(),this.$container.trigger("slide_change",{index:t,slides:this.$slides,previous:this._getPreviousIndex(),next:this._getNextIndex()})}},{key:"previous",value:function(){var t=this._getPreviousIndex();this.$container.trigger("previous",{index:this.getCurrentIndex(),slides:this.$slides,previous:t,next:this._getNextIndex()}),this._isPreviousClone()?this._showClone(!1):this.show(t)}},{key:"next",value:function(){var t=this._getNextIndex();this.$container.trigger("next",{index:this.getCurrentIndex(),slides:this.$slides,previous:t,next:this._getPreviousIndex()}),this._isNextClone()?this._showClone():this.show(t)}},{key:"getCurrentIndex",value:function(){return this.options.infinite?this._current_index-1:this._current_index}},{key:"resize",value:function(){var t=this.$container.parent().innerWidth();this._container_width!==t&&(this._container_width=t,this.$container.css("width",this._container_width*this.$container.children().length),this._moveContainerTo(this._current_index))}},{key:"_processBreakpointOptions",value:function(){var t=!1,e=-1;for(var i in this._initial_options.responsive_breakpoints)(i=parseInt(i,10))<=window.innerWidth&&i>e&&(e=i);this._breakpoint!==e&&(this._breakpoint=e,t=!0);var n=this._initial_options.responsive_breakpoints[this._breakpoint]||{};return"static"===n?(this._static=!0,this.options=this._initial_options):(this._static=!1,this.options=a.default.extend({},this._initial_options,n)),t}},{key:"_continue",value:function(){this.options.autoplay_delay>1&&this.playing&&(this._interval=window.setTimeout(this.next.bind(this),this.options.autoplay_delay))}},{key:"_showClone",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],i=0;e&&(i=this.$container.children().length-1),this._moveContainerTo(i),window.setTimeout(function(){t._disableTransitions(),t.show(e?0:t.$slides.length-1),t.$container[0].offsetHeight,t._enableTransitions()},this.options.transition_time)}},{key:"_isNextClone",value:function(){return!!this.options.infinite&&this._current_index+1===this.$container.children().length-1}},{key:"_isPreviousClone",value:function(){return!!this.options.infinite&&this._current_index-1==0}},{key:"_moveContainerTo",value:function(t){var e=-1*t*this._container_width;this.$container.css("transform","translate3d("+e+"px, 0, 0)")}},{key:"_enableTransitions",value:function(){var t=this.options.transition_time/1e3;this.$container.css({"-webkit-transition":"-webkit-transform "+this.options.transition_easing+" "+t+"s",transition:"transform "+this.options.transition_easing+" "+t+"s"})}},{key:"_disableTransitions",value:function(){this.$container.css({"webkit-transition":"",transition:""})}},{key:"_getPreviousIndex",value:function(){var t=this.getCurrentIndex()-1;return t<0&&(t=this.options.infinite?this.$slides.length-1:0),t}},{key:"_getNextIndex",value:function(){var t=this.getCurrentIndex()+1;return t>this.$slides.length-1&&(t=this.options.infinite?0:this.$slides.length-1),t}},{key:"_createSecondaryNav",value:function(){var t=this,e=(0,a.default)('<div class="'+this.options.secondary_nav_class+'">');this.$slides.each(function(i,n){(0,a.default)(n).hasClass(t.options.slide_clone_class)||e.append(t._createSecondaryNavButton(i))}),this.$secondary_nav=e,this.$container.after(e)}},{key:"_createSecondaryNavButton",value:function(t){var e=(0,a.default)('<button type="button">');return e.addClass(this.options.nav_item_class),e.attr("data-slide",t),0===t&&e.addClass(this.options.nav_item_active_class),e}},{key:"_attachEvents",value:function(){var t=this;this.$container.on("previous.carousel",this.options.onPrevious),this.$container.on("next.carousel",this.options.onNext),this.$container.on("slide_change.carousel",this.options.onChange),(0,a.default)(this.options.previous_button).on("click.carousel",this._onPrevClick.bind(this)),(0,a.default)(this.options.next_button).on("click.carousel",this._onNextClick.bind(this)),this.options.pause_on_hover&&(this.$container.on("mouseover.carousel",function(){t.pause()}),this.$container.on("mouseout.carousel",function(){t._continue()})),this.$secondary_nav&&this.$secondary_nav.on("click.carousel","button",this._onSecondaryNavClick.bind(this)),this._hammer=new h.default(this.$container[0],{touchAction:"pan-y"}),this._hammer.on("pan panstart",this._onPan.bind(this))}},{key:"_onWindowResize",value:function(t){if(this._resize_throttle=null,this._processBreakpointOptions())return this.destroy(),void this.init();this._static||this.resize()}},{key:"_onSecondaryNavClick",value:function(t){this.options.stop_with_interaction&&this.stop();var e=parseInt((0,a.default)(t.target).attr("data-slide"),10);this.show(e)}},{key:"_onPrevClick",value:function(t){this.options.stop_with_interaction&&this.stop(),this.previous()}},{key:"_onNextClick",value:function(t){this.options.stop_with_interaction&&this.stop(),this.next()}},{key:"_onPan",value:function(t){if("panstart"===t.type&&(this._disableTransitions(),this.options.stop_with_interaction&&this.stop()),t.isFinal)this._enableTransitions(),Math.abs(t.deltaX)>this._container_width*this.options.pan_distance_threshold?t.deltaX>0?this.previous():this.next():this.show(this._current_index);else{var e=-1*this._current_index*this._container_width+t.deltaX;this.$container.css("transform","translate3d("+e+"px, 0, 0)")}}}]),t}();e.default=l,t.exports=e.default},function(t,e,i){var n;!function(s,r,o,a){"use strict";function u(t,e,i){return setTimeout(p(t,i),e)}function h(t,e,i){return!!Array.isArray(t)&&(c(t,i[e],i),!0)}function c(t,e,i){var n;if(t)if(t.forEach)t.forEach(e,i);else if(t.length!==a)for(n=0;n<t.length;)e.call(i,t[n],n,t),n++;else for(n in t)t.hasOwnProperty(n)&&e.call(i,t[n],n,t)}function l(t,e,i){for(var n=Object.keys(e),s=0;s<n.length;)(!i||i&&t[n[s]]===a)&&(t[n[s]]=e[n[s]]),s++;return t}function d(t,e){return l(t,e,!0)}function f(t,e,i){var n,s=e.prototype;n=t.prototype=Object.create(s),n.constructor=t,n._super=s,i&&l(n,i)}function p(t,e){return function(){return t.apply(e,arguments)}}function v(t,e){return typeof t==pt?t.apply(e?e[0]||a:a,e):t}function _(t,e){return t===a?e:t}function m(t,e,i){c(w(e),function(e){t.addEventListener(e,i,!1)})}function g(t,e,i){c(w(e),function(e){t.removeEventListener(e,i,!1)})}function y(t,e){for(;t;){if(t==e)return!0;t=t.parentNode}return!1}function b(t,e){return t.indexOf(e)>-1}function w(t){return t.trim().split(/\s+/g)}function T(t,e,i){if(t.indexOf&&!i)return t.indexOf(e);for(var n=0;n<t.length;){if(i&&t[n][i]==e||!i&&t[n]===e)return n;n++}return-1}function x(t){return Array.prototype.slice.call(t,0)}function C(t,e,i){for(var n=[],s=[],r=0;r<t.length;){var o=e?t[r][e]:t[r];T(s,o)<0&&n.push(t[r]),s[r]=o,r++}return i&&(n=e?n.sort(function(t,i){return t[e]>i[e]}):n.sort()),n}function E(t,e){for(var i,n,s=e[0].toUpperCase()+e.slice(1),r=0;r<dt.length;){if(i=dt[r],(n=i?i+s:e)in t)return n;r++}return a}function k(){return gt++}function I(t){var e=t.ownerDocument;return e.defaultView||e.parentWindow}function $(t,e){var i=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){v(t.options.enable,[t])&&i.handler(e)},this.init()}function z(t){var e=t.options.inputClass;return new(e||(wt?q:Tt?B:bt?G:Y))(t,A)}function A(t,e,i){var n=i.pointers.length,s=i.changedPointers.length,r=e&Ct&&n-s==0,o=e&(kt|It)&&n-s==0;i.isFirst=!!r,i.isFinal=!!o,r&&(t.session={}),i.eventType=e,N(t,i),t.emit("hammer.input",i),t.recognize(i),t.session.prevInput=i}function N(t,e){var i=t.session,n=e.pointers,s=n.length;i.firstInput||(i.firstInput=j(e)),s>1&&!i.firstMultiple?i.firstMultiple=j(e):1===s&&(i.firstMultiple=!1);var r=i.firstInput,o=i.firstMultiple,a=o?o.center:r.center,u=e.center=D(n);e.timeStamp=mt(),e.deltaTime=e.timeStamp-r.timeStamp,e.angle=W(a,u),e.distance=M(a,u),P(i,e),e.offsetDirection=R(e.deltaX,e.deltaY),e.scale=o?F(o.pointers,n):1,e.rotation=o?X(o.pointers,n):0,S(i,e);var h=t.element;y(e.srcEvent.target,h)&&(h=e.srcEvent.target),e.target=h}function P(t,e){var i=e.center,n=t.offsetDelta||{},s=t.prevDelta||{},r=t.prevInput||{};e.eventType!==Ct&&r.eventType!==kt||(s=t.prevDelta={x:r.deltaX||0,y:r.deltaY||0},n=t.offsetDelta={x:i.x,y:i.y}),e.deltaX=s.x+(i.x-n.x),e.deltaY=s.y+(i.y-n.y)}function S(t,e){var i,n,s,r,o=t.lastInterval||e,u=e.timeStamp-o.timeStamp;if(e.eventType!=It&&(u>xt||o.velocity===a)){var h=o.deltaX-e.deltaX,c=o.deltaY-e.deltaY,l=O(u,h,c);n=l.x,s=l.y,i=_t(l.x)>_t(l.y)?l.x:l.y,r=R(h,c),t.lastInterval=e}else i=o.velocity,n=o.velocityX,s=o.velocityY,r=o.direction;e.velocity=i,e.velocityX=n,e.velocityY=s,e.direction=r}function j(t){for(var e=[],i=0;i<t.pointers.length;)e[i]={clientX:vt(t.pointers[i].clientX),clientY:vt(t.pointers[i].clientY)},i++;return{timeStamp:mt(),pointers:e,center:D(e),deltaX:t.deltaX,deltaY:t.deltaY}}function D(t){var e=t.length;if(1===e)return{x:vt(t[0].clientX),y:vt(t[0].clientY)};for(var i=0,n=0,s=0;s<e;)i+=t[s].clientX,n+=t[s].clientY,s++;return{x:vt(i/e),y:vt(n/e)}}function O(t,e,i){return{x:e/t||0,y:i/t||0}}function R(t,e){return t===e?$t:_t(t)>=_t(e)?t>0?zt:At:e>0?Nt:Pt}function M(t,e,i){i||(i=Ot);var n=e[i[0]]-t[i[0]],s=e[i[1]]-t[i[1]];return Math.sqrt(n*n+s*s)}function W(t,e,i){i||(i=Ot);var n=e[i[0]]-t[i[0]],s=e[i[1]]-t[i[1]];return 180*Math.atan2(s,n)/Math.PI}function X(t,e){return W(e[1],e[0],Rt)-W(t[1],t[0],Rt)}function F(t,e){return M(e[0],e[1],Rt)/M(t[0],t[1],Rt)}function Y(){this.evEl=Wt,this.evWin=Xt,this.allow=!0,this.pressed=!1,$.apply(this,arguments)}function q(){this.evEl=qt,this.evWin=Lt,$.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}function L(){this.evTarget=Bt,this.evWin=Ut,this.started=!1,$.apply(this,arguments)}function H(t,e){var i=x(t.touches),n=x(t.changedTouches);return e&(kt|It)&&(i=C(i.concat(n),"identifier",!0)),[i,n]}function B(){this.evTarget=Vt,this.targetIds={},$.apply(this,arguments)}function U(t,e){var i=x(t.touches),n=this.targetIds;if(e&(Ct|Et)&&1===i.length)return n[i[0].identifier]=!0,[i,i];var s,r,o=x(t.changedTouches),a=[],u=this.target;if(r=i.filter(function(t){return y(t.target,u)}),e===Ct)for(s=0;s<r.length;)n[r[s].identifier]=!0,s++;for(s=0;s<o.length;)n[o[s].identifier]&&a.push(o[s]),e&(kt|It)&&delete n[o[s].identifier],s++;return a.length?[C(r.concat(a),"identifier",!0),a]:void 0}function G(){$.apply(this,arguments);var t=p(this.handler,this);this.touch=new B(this.manager,t),this.mouse=new Y(this.manager,t)}function V(t,e){this.manager=t,this.set(e)}function Z(t){if(b(t,te))return te;var e=b(t,ee),i=b(t,ie);return e&&i?ee+" "+ie:e||i?e?ee:ie:b(t,Kt)?Kt:Jt}function Q(t){this.id=k(),this.manager=null,this.options=d(t||{},this.defaults),this.options.enable=_(this.options.enable,!0),this.state=ne,this.simultaneous={},this.requireFail=[]}function J(t){return t&ue?"cancel":t&oe?"end":t&re?"move":t&se?"start":""}function K(t){return t==Pt?"down":t==Nt?"up":t==zt?"left":t==At?"right":""}function tt(t,e){var i=e.manager;return i?i.get(t):t}function et(){Q.apply(this,arguments)}function it(){et.apply(this,arguments),this.pX=null,this.pY=null}function nt(){et.apply(this,arguments)}function st(){Q.apply(this,arguments),this._timer=null,this._input=null}function rt(){et.apply(this,arguments)}function ot(){et.apply(this,arguments)}function at(){Q.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function ut(t,e){return e=e||{},e.recognizers=_(e.recognizers,ut.defaults.preset),new ht(t,e)}function ht(t,e){e=e||{},this.options=d(e,ut.defaults),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.element=t,this.input=z(this),this.touchAction=new V(this,this.options.touchAction),ct(this,!0),c(e.recognizers,function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])},this)}function ct(t,e){var i=t.element;c(t.options.cssProps,function(t,n){i.style[E(i.style,n)]=e?t:""})}function lt(t,e){var i=r.createEvent("Event");i.initEvent(t,!0,!0),i.gesture=e,e.target.dispatchEvent(i)}var dt=["","webkit","moz","MS","ms","o"],ft=r.createElement("div"),pt="function",vt=Math.round,_t=Math.abs,mt=Date.now,gt=1,yt=/mobile|tablet|ip(ad|hone|od)|android/i,bt="ontouchstart"in s,wt=E(s,"PointerEvent")!==a,Tt=bt&&yt.test(navigator.userAgent),xt=25,Ct=1,Et=2,kt=4,It=8,$t=1,zt=2,At=4,Nt=8,Pt=16,St=zt|At,jt=Nt|Pt,Dt=St|jt,Ot=["x","y"],Rt=["clientX","clientY"];$.prototype={handler:function(){},init:function(){this.evEl&&m(this.element,this.evEl,this.domHandler),this.evTarget&&m(this.target,this.evTarget,this.domHandler),this.evWin&&m(I(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&g(this.element,this.evEl,this.domHandler),this.evTarget&&g(this.target,this.evTarget,this.domHandler),this.evWin&&g(I(this.element),this.evWin,this.domHandler)}};var Mt={mousedown:Ct,mousemove:Et,mouseup:kt},Wt="mousedown",Xt="mousemove mouseup";f(Y,$,{handler:function(t){var e=Mt[t.type];e&Ct&&0===t.button&&(this.pressed=!0),e&Et&&1!==t.which&&(e=kt),this.pressed&&this.allow&&(e&kt&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:"mouse",srcEvent:t}))}});var Ft={pointerdown:Ct,pointermove:Et,pointerup:kt,pointercancel:It,pointerout:It},Yt={2:"touch",3:"pen",4:"mouse",5:"kinect"},qt="pointerdown",Lt="pointermove pointerup pointercancel";s.MSPointerEvent&&(qt="MSPointerDown",Lt="MSPointerMove MSPointerUp MSPointerCancel"),f(q,$,{handler:function(t){var e=this.store,i=!1,n=t.type.toLowerCase().replace("ms",""),s=Ft[n],r=Yt[t.pointerType]||t.pointerType,o="touch"==r,a=T(e,t.pointerId,"pointerId");s&Ct&&(0===t.button||o)?a<0&&(e.push(t),a=e.length-1):s&(kt|It)&&(i=!0),a<0||(e[a]=t,this.callback(this.manager,s,{pointers:e,changedPointers:[t],pointerType:r,srcEvent:t}),i&&e.splice(a,1))}});var Ht={touchstart:Ct,touchmove:Et,touchend:kt,touchcancel:It},Bt="touchstart",Ut="touchstart touchmove touchend touchcancel";f(L,$,{handler:function(t){var e=Ht[t.type];if(e===Ct&&(this.started=!0),this.started){var i=H.call(this,t,e);e&(kt|It)&&i[0].length-i[1].length==0&&(this.started=!1),this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}});var Gt={touchstart:Ct,touchmove:Et,touchend:kt,touchcancel:It},Vt="touchstart touchmove touchend touchcancel";f(B,$,{handler:function(t){var e=Gt[t.type],i=U.call(this,t,e);i&&this.callback(this.manager,e,{pointers:i[0],changedPointers:i[1],pointerType:"touch",srcEvent:t})}}),f(G,$,{handler:function(t,e,i){var n="touch"==i.pointerType,s="mouse"==i.pointerType;if(n)this.mouse.allow=!1;else if(s&&!this.mouse.allow)return;e&(kt|It)&&(this.mouse.allow=!0),this.callback(t,e,i)},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Zt=E(ft.style,"touchAction"),Qt=Zt!==a,Jt="auto",Kt="manipulation",te="none",ee="pan-x",ie="pan-y";V.prototype={set:function(t){"compute"==t&&(t=this.compute()),Qt&&(this.manager.element.style[Zt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return c(this.manager.recognizers,function(e){v(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))}),Z(t.join(" "))},preventDefaults:function(t){if(!Qt){var e=t.srcEvent,i=t.offsetDirection;if(this.manager.session.prevented)return void e.preventDefault();var n=this.actions,s=b(n,te),r=b(n,ie),o=b(n,ee);return s||r&&i&St||o&&i&jt?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var ne=1,se=2,re=4,oe=8,ae=oe,ue=16;Q.prototype={defaults:{},set:function(t){return l(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(h(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=tt(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return h(t,"dropRecognizeWith",this)?this:(t=tt(t,this),delete this.simultaneous[t.id],this)},requireFailure:function(t){if(h(t,"requireFailure",this))return this;var e=this.requireFail;return t=tt(t,this),-1===T(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(h(t,"dropRequireFailure",this))return this;t=tt(t,this);var e=T(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){function e(e){i.manager.emit(i.options.event+(e?J(n):""),t)}var i=this,n=this.state;n<oe&&e(!0),e(),n>=oe&&e(!0)},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=32},canEmit:function(){for(var t=0;t<this.requireFail.length;){if(!(this.requireFail[t].state&(32|ne)))return!1;t++}return!0},recognize:function(t){var e=l({},t);if(!v(this.options.enable,[this,e]))return this.reset(),void(this.state=32);this.state&(ae|ue|32)&&(this.state=ne),this.state=this.process(e),this.state&(se|re|oe|ue)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},f(et,Q,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,i=t.eventType,n=e&(se|re),s=this.attrTest(t);return n&&(i&It||!s)?e|ue:n||s?i&kt?e|oe:e&se?e|re:se:32}}),f(it,et,{defaults:{event:"pan",threshold:10,pointers:1,direction:Dt},getTouchAction:function(){var t=this.options.direction,e=[];return t&St&&e.push(ie),t&jt&&e.push(ee),e},directionTest:function(t){var e=this.options,i=!0,n=t.distance,s=t.direction,r=t.deltaX,o=t.deltaY;return s&e.direction||(e.direction&St?(s=0===r?$t:r<0?zt:At,i=r!=this.pX,n=Math.abs(t.deltaX)):(s=0===o?$t:o<0?Nt:Pt,i=o!=this.pY,n=Math.abs(t.deltaY))),t.direction=s,i&&n>e.threshold&&s&e.direction},attrTest:function(t){return et.prototype.attrTest.call(this,t)&&(this.state&se||!(this.state&se)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=K(t.direction);e&&this.manager.emit(this.options.event+e,t),this._super.emit.call(this,t)}}),f(nt,et,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[te]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&se)},emit:function(t){if(this._super.emit.call(this,t),1!==t.scale){var e=t.scale<1?"in":"out";this.manager.emit(this.options.event+e,t)}}}),f(st,Q,{defaults:{event:"press",pointers:1,time:500,threshold:5},getTouchAction:function(){return[Jt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime>e.time;if(this._input=t,!n||!i||t.eventType&(kt|It)&&!s)this.reset();else if(t.eventType&Ct)this.reset(),this._timer=u(function(){this.state=ae,this.tryEmit()},e.time,this);else if(t.eventType&kt)return ae;return 32},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===ae&&(t&&t.eventType&kt?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=mt(),this.manager.emit(this.options.event,this._input)))}}),f(rt,et,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[te]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&se)}}),f(ot,et,{defaults:{event:"swipe",threshold:10,velocity:.65,direction:St|jt,pointers:1},getTouchAction:function(){return it.prototype.getTouchAction.call(this)},attrTest:function(t){var e,i=this.options.direction;return i&(St|jt)?e=t.velocity:i&St?e=t.velocityX:i&jt&&(e=t.velocityY),this._super.attrTest.call(this,t)&&i&t.direction&&t.distance>this.options.threshold&&_t(e)>this.options.velocity&&t.eventType&kt},emit:function(t){var e=K(t.direction);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),f(at,Q,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:2,posThreshold:10},getTouchAction:function(){return[Kt]},process:function(t){var e=this.options,i=t.pointers.length===e.pointers,n=t.distance<e.threshold,s=t.deltaTime<e.time;if(this.reset(),t.eventType&Ct&&0===this.count)return this.failTimeout();if(n&&s&&i){if(t.eventType!=kt)return this.failTimeout();var r=!this.pTime||t.timeStamp-this.pTime<e.interval,o=!this.pCenter||M(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,o&&r?this.count+=1:this.count=1,this._input=t;if(0===this.count%e.taps)return this.hasRequireFailures()?(this._timer=u(function(){this.state=ae,this.tryEmit()},e.interval,this),se):ae}return 32},failTimeout:function(){return this._timer=u(function(){this.state=32},this.options.interval,this),32},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==ae&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),ut.VERSION="2.0.4",ut.defaults={domEvents:!1,touchAction:"compute",enable:!0,inputTarget:null,inputClass:null,preset:[[rt,{enable:!1}],[nt,{enable:!1},["rotate"]],[ot,{direction:St}],[it,{direction:St},["swipe"]],[at],[at,{event:"doubletap",taps:2},["tap"]],[st]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};ht.prototype={set:function(t){return l(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?2:1},recognize:function(t){var e=this.session;if(!e.stopped){this.touchAction.preventDefaults(t);var i,n=this.recognizers,s=e.curRecognizer;(!s||s&&s.state&ae)&&(s=e.curRecognizer=null);for(var r=0;r<n.length;)i=n[r],2===e.stopped||s&&i!=s&&!i.canRecognizeWith(s)?i.reset():i.recognize(t),!s&&i.state&(se|re|oe)&&(s=e.curRecognizer=i),r++}},get:function(t){if(t instanceof Q)return t;for(var e=this.recognizers,i=0;i<e.length;i++)if(e[i].options.event==t)return e[i];return null},add:function(t){if(h(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(h(t,"remove",this))return this;var e=this.recognizers;return t=this.get(t),e.splice(T(e,t),1),this.touchAction.update(),this},on:function(t,e){var i=this.handlers;return c(w(t),function(t){i[t]=i[t]||[],i[t].push(e)}),this},off:function(t,e){var i=this.handlers;return c(w(t),function(t){e?i[t].splice(T(i[t],e),1):delete i[t]}),this},emit:function(t,e){this.options.domEvents&&lt(t,e);var i=this.handlers[t]&&this.handlers[t].slice();if(i&&i.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};for(var n=0;n<i.length;)i[n](e),n++}},destroy:function(){this.element&&ct(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(ut,{INPUT_START:Ct,INPUT_MOVE:Et,INPUT_END:kt,INPUT_CANCEL:It,STATE_POSSIBLE:ne,STATE_BEGAN:se,STATE_CHANGED:re,STATE_ENDED:oe,STATE_RECOGNIZED:ae,STATE_CANCELLED:ue,STATE_FAILED:32,DIRECTION_NONE:$t,DIRECTION_LEFT:zt,DIRECTION_RIGHT:At,DIRECTION_UP:Nt,DIRECTION_DOWN:Pt,DIRECTION_HORIZONTAL:St,DIRECTION_VERTICAL:jt,DIRECTION_ALL:Dt,Manager:ht,Input:$,TouchAction:V,TouchInput:B,MouseInput:Y,PointerEventInput:q,TouchMouseInput:G,SingleTouchInput:L,Recognizer:Q,AttrRecognizer:et,Tap:at,Pan:it,Swipe:ot,Pinch:nt,Rotate:rt,Press:st,on:m,off:g,each:c,merge:d,extend:l,inherit:f,bindFn:p,prefixed:E}),"function"==pt&&i(6)?(n=function(){return ut}.call(e,i,e,t))!==a&&(t.exports=n):void 0!==t&&t.exports?t.exports=ut:s.Hammer=ut}(window,document)},function(t,e){(function(e){t.exports=e}).call(e,{})}]);