var VimeoUploader=function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.loaded=true;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module,exports,__webpack_require__){module.exports=__webpack_require__(1)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ERROR_CODES=exports.SERVICES=exports.ERRORS=exports.TYPES=exports.EVENTS=exports.STATES=undefined;var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _config=__webpack_require__(2);var _config2=_interopRequireDefault(_config);var _states=__webpack_require__(3);var _states2=_interopRequireDefault(_states);var _events=__webpack_require__(5);var _events2=_interopRequireDefault(_events);var _types=__webpack_require__(6);var _types2=_interopRequireDefault(_types);var _services=__webpack_require__(7);var _services2=_interopRequireDefault(_services);var _SiteClient=__webpack_require__(8);var _SiteClient2=_interopRequireDefault(_SiteClient);var _ApiClient=__webpack_require__(28);var _ApiClient2=_interopRequireDefault(_ApiClient);var _LeatherbackClient=__webpack_require__(30);var _LeatherbackClient2=_interopRequireDefault(_LeatherbackClient);var _AttemptAborter=__webpack_require__(31);var _AttemptAborter2=_interopRequireDefault(_AttemptAborter);var _Lighthouse=__webpack_require__(32);var _Lighthouse2=_interopRequireDefault(_Lighthouse);var _Fresnel=__webpack_require__(33);var _Fresnel2=_interopRequireDefault(_Fresnel);var _errors=__webpack_require__(16);var _api_apps=__webpack_require__(34);var _package=__webpack_require__(35);var _ravenJs=__webpack_require__(17);var _ravenJs2=_interopRequireDefault(_ravenJs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}_ravenJs2.default.config("https://6d4011d34f5c4544b09f1875c7e0a6b7@sentry.cloud.vimeo.com/5",{release:_package.version,autoBreadcrumbs:true}).install();var VimeoUploader=function(){function VimeoUploader(options){_classCallCheck(this,VimeoUploader);this.config=_extends({},_config2.default,options);this.uploads=new Map;this._aborter=new _AttemptAborter2.default(this.config);this.config.lighthouse=new _Lighthouse2.default(this.config.lighthouse.url);this.fresnel=new _Fresnel2.default("upload-stats");this._setSessionId();this._setUserId();this._onUploadStateChange=this._onUploadStateChange.bind(this);_ravenJs2.default.setUserContext({"Vimeo User ID":this._user_id,"Session ID":this._session_id})}_createClass(VimeoUploader,[{key:"_onUploadStateChange",value:function _onUploadStateChange(event){var state=event.state,upload=event.upload,is_resume=event.is_resume,is_restart=event.is_restart;if(is_resume||is_restart){return}var config=this.config,fresnel=this.fresnel,uploads=this.uploads,product=this.product,session_id=this.session_id,user_id=this.user_id;switch(state){case _states2.default.COMPLETED:case _states2.default.CANCELED:case _states2.default.FAILED:this.startQueue();break}this._aborter.uploads=uploads;var file=upload.file,upload_type=upload.upload_type,api_app=upload.api_app;var concurrent_uploads=0;uploads.forEach(function(up){if(up.active){concurrent_uploads++}});var upload_id=upload.uid?upload.uid:"";var bucket="";var parallel_requests=0;if(config.service===_services2.default.UPLOAD_SERVICE_LEATHERBACK){if(upload.uploaders&&upload.uploaders.length){bucket=upload.uploaders[0].bucket}parallel_requests=upload.signed_urls?Object.keys(upload.signed_urls).length:parallel_requests}else if(config.service===_services2.default.UPLOAD_SERVICE_SITE){bucket=upload.uploader?upload.uploader.bucket:bucket}var data={name:"STATE_CHANGE",session_id:session_id,user_id:user_id,upload_id:upload_id,state:state,bucket:bucket,concurrent_uploads:concurrent_uploads,parallel_requests:parallel_requests,upload_type:upload_type,product:product,api_app:api_app,size:file.size,location:window.location.pathname,uploader_version:config.version,service:config.service,user_account_type:config.user.account_type};if(state===_states2.default.COMPLETED){data.duration=upload.duration;data.speed_mbps=upload.speed_mbps}if(state===_states2.default.FAILED){data.error=upload.error.toString()}fresnel.log(data)}},{key:"_setSessionId",value:function _setSessionId(){var _this=this;if(typeof this._session_id!=="undefined"){return}var __setSessionId=function __setSessionId(){if(typeof window.__fa_session!=="undefined"){_this._session_id=window.__fa_session;return}if(typeof window.vimeo!=="undefined"&&_typeof(window.vimeo.cur_user)==="object"){_this._session_id=window.vimeo.cur_user.id+"."+Date.now();return}_this._session_id="undefined."+Date.now()};setTimeout(__setSessionId,0)}},{key:"_setUserId",value:function _setUserId(){if(typeof this._user_id!=="undefined"){return}if(typeof window.vimeo!=="undefined"&&_typeof(window.vimeo.cur_user)==="object"){this._user_id=window.vimeo.cur_user.id;return}this._user_id=0}},{key:"_create",value:function _create(file,upload_type,api_app,clip_id){var config=this.config;var upload=null;switch(upload_type){case _types2.default.CLIP:case _types2.default.CLIP_REPLACE:case _types2.default.DRM_CLIP:case _types2.default.DRM_CLIP_REPLACE:if(api_app===_api_apps.PARALLEL_UPLOADER_APP){upload=new _LeatherbackClient2.default(config,upload_type,api_app,file,clip_id)}else{upload=new _SiteClient2.default(config,upload_type,api_app,file,clip_id)}break;case _types2.default.API_PULL_CLIP:case _types2.default.API_PULL_CLIP_REPLACE:upload=new _ApiClient2.default(config,upload_type,api_app,file,clip_id);break;default:throw new Error(upload_type+" upload not implemented yet")}this.uploads.set(upload.id,upload);_ravenJs2.default.setExtraContext({"Upload ID":upload.uid,clip_id:clip_id,"API App":api_app,"Upload Type":upload_type});_ravenJs2.default.setTagsContext({"Upload Type":upload_type,"API App":api_app});return upload}},{key:"_start",value:function _start(upload){if(upload.state!==_states2.default.QUEUED){return upload}var max_simultaneous_uploads=this.config.max_simultaneous_uploads;if(this.summary.in_progress_count>=max_simultaneous_uploads){console.log("Max simultaneous uploads "+max_simultaneous_uploads+", leaving in queue");return upload}upload.on(_events2.default.STATE_CHANGE,this._onUploadStateChange);upload.start();return upload}},{key:"queue",value:function queue(files){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_types2.default.CLIP;var _this2=this;var api_app=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_api_apps.GCS_RESUMABLE_UPLOADER_APP;var clip_id=arguments[3];if(files instanceof FileList){files=Array.from(files)}if(!Array.isArray(files)){return this._create(files,type,api_app,clip_id)}return files.map(function(file){return _this2._create(file,type,api_app,clip_id)})}},{key:"startQueue",value:function startQueue(){var _this3=this;var new_uploads=[];this.uploads.forEach(function(upload){var new_upload=_this3._start(upload);new_uploads.push(new_upload)});return new_uploads}},{key:"upload",value:function upload(files){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:_types2.default.CLIP;var api_app=arguments.length>2&&arguments[2]!==undefined?arguments[2]:_api_apps.GCS_RESUMABLE_UPLOADER_APP;var clip_id=arguments[3];var new_uploads=this.queue(files,type,api_app,clip_id);this.startQueue();if(new_uploads.length===1){return new_uploads[0]}return new_uploads}},{key:"pauseAll",value:function pauseAll(){this.uploads.forEach(function(upload){if(upload.state!==_states2.default.UPLOADING){return}upload.pause()})}},{key:"resumeAll",value:function resumeAll(){this.uploads.forEach(function(upload){if(upload.state!==_states2.default.PAUSED){return}upload.resume()})}},{key:"cancelAll",value:function cancelAll(){this.uploads.forEach(function(upload){if(upload.state===_states2.default.CANCELED){return}upload.cancel()})}},{key:"clearAll",value:function clearAll(){var _this4=this;this.uploads.forEach(function(upload){if(upload.state!==_states2.default.CANCELED){upload.cancel()}_this4.uploads.delete(upload.id)})}},{key:"version",get:function get(){return this.config.version}},{key:"session_id",get:function get(){return this._session_id}},{key:"user_id",get:function get(){return this._user_id}},{key:"log_to_console",get:function get(){return this.config.log_to_console},set:function set(is_enabled){this.config.log_to_console=is_enabled===true}},{key:"summary",get:function get(){var _summary={total_bytes:0,bytes_uploaded:0,eta:0,active_count:0,complete_count:0,queued_count:0,in_progress_count:0,total_count:0};var all_states=[];this.uploads.forEach(function(upload){all_states.push(upload.state);if(upload.state===_states2.default.CANCELED||upload.state===_states2.default.FAILED){return}_summary.total_bytes+=upload.file.size;_summary.bytes_uploaded+=upload.bytes_uploaded;_summary.eta+=upload.eta||0;_summary.total_count++;if(upload.state===_states2.default.QUEUED){_summary.queued_count++}if(upload.state!==_states2.default.COMPLETED){_summary.active_count++}else{_summary.complete_count++}_summary.in_progress_count=_summary.active_count-_summary.queued_count});_summary.is_paused=all_states.every(function(state){return state===_states2.default.PAUSED||state===_states2.default.COMPLETED});_summary.is_canceled=all_states.every(function(state){return state===_states2.default.CANCELED});_summary.is_complete=all_states.every(function(state){return state===_states2.default.COMPLETED});return _summary}},{key:"uploading_clip_ids",get:function get(){var _clip_ids=[];this.uploads.forEach(function(upload){if(!upload.clip_id||upload.state===_states2.default.COMPLETE){return}_clip_ids.push(upload.clip_id)});return _clip_ids}},{key:"product",get:function get(){if("vimeo"in window&&vimeo.is_mobile){return"mobile"}if(window.location.pathname.indexOf("ondemand")!==-1){return"ondemand"}return"creator"}}]);return VimeoUploader}();exports.STATES=_states2.default;exports.EVENTS=_events2.default;exports.TYPES=_types2.default;exports.ERRORS=_errors.ERRORS;exports.SERVICES=_services2.default;exports.ERROR_CODES=_errors.ERROR_CODES;exports.default=VimeoUploader},function(module,exports){module.exports={name:"vimeo-uploader",version:"2.12.0",log_to_console:false,tomdawg:{url:"https://devu.cloud.vimeo.com"},lighthouse:{url:"https://lighthouse.vimeocdn.com"},leatherback:{url:"https://leatherback.vimeo-prod.appspot.com"},user:{id:1,account_type:"basic",is_mod:true,use_leatherback:false}}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keymirror=__webpack_require__(4);var _keymirror2=_interopRequireDefault(_keymirror);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var STATES=(0,_keymirror2.default)({QUEUED:null,STARTING:null,VALIDATING:null,ATTACHING:null,UPLOADING:null,PAUSED:null,RESUMING:null,CANCELED:null,COMPLETED:null,FAILED:null,REROUTING:null});exports.default=STATES},function(module,exports){"use strict";var keyMirror=function(obj){var ret={};var key;if(!(obj instanceof Object&&!Array.isArray(obj))){throw new Error("keyMirror(...): Argument must be an object.")}for(key in obj){if(!obj.hasOwnProperty(key)){continue}ret[key]=key}return ret};module.exports=keyMirror},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _keymirror=__webpack_require__(4);var _keymirror2=_interopRequireDefault(_keymirror);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var EVENTS=(0,_keymirror2.default)({PROGRESS:null,STATE_CHANGE:null,FILE_SIZE_CHANGED:null});exports.default=EVENTS},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var TYPES={CLIP:"clip",CLIP_REPLACE:"replace_clip",API_PULL_CLIP:"api_pull_clip",API_PULL_CLIP_REPLACE:"api_pull_clip_replace",DRM_CLIP:"drm_clip",DRM_CLIP_REPLACE:"drm_clip_replace"};var REGIONLESS_TYPES=exports.REGIONLESS_TYPES=[TYPES.API_PULL_CLIP,TYPES.API_PULL_CLIP_REPLACE];exports.default=TYPES},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var SERVICES={UPLOAD_SERVICE_SITE:"UPLOAD_SERVICE_SITE",UPLOAD_SERVICE_LEATHERBACK:"UPLOAD_SERVICE_LEATHERBACK"};exports.default=SERVICES},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _states=__webpack_require__(3);var _states2=_interopRequireDefault(_states);var _events=__webpack_require__(5);var _events2=_interopRequireDefault(_events);var _types=__webpack_require__(6);var _types2=_interopRequireDefault(_types);var _BaseClient2=__webpack_require__(9);var _BaseClient3=_interopRequireDefault(_BaseClient2);var _GCSUploader=__webpack_require__(24);var _GCSUploader2=_interopRequireDefault(_GCSUploader);var _VideoValidator=__webpack_require__(26);var _VideoValidator2=_interopRequireDefault(_VideoValidator);var _Utilities=__webpack_require__(15);var _VimeoApp=__webpack_require__(27);var _VimeoApp2=_interopRequireDefault(_VimeoApp);var _errors=__webpack_require__(16);var _ravenJs=__webpack_require__(17);var _ravenJs2=_interopRequireDefault(_ravenJs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var SiteClient=function(_BaseClient){_inherits(SiteClient,_BaseClient);function SiteClient(config,upload_type,api_app,file,clip_id){_classCallCheck(this,SiteClient);var _this=_possibleConstructorReturn(this,(SiteClient.__proto__||Object.getPrototypeOf(SiteClient)).call(this,config,upload_type,api_app,file,clip_id));if(!config.tomdawg){throw new Error("[SiteClient] tomdawg data not in the config")}if(upload_type===_types2.default.CLIP_REPLACE&&!clip_id){throw new Error("[SiteClient] Clip replacement upload must provide a clip_id")}_this.server_url=config.tomdawg.url;_this.clip_id=clip_id;_this.vimeo_app=new _VimeoApp2.default(config,_this.logger);_this._setFileSizeChangeListener();return _this}_createClass(SiteClient,[{key:"_onUploaderComplete",value:function _onUploaderComplete(){var _this2=this;var file=this.file,upload_type=this.upload_type,attempt_id=this.attempt_id,video_file_id=this.video_file_id,vimeo_app=this.vimeo_app,logger=this.logger,signature=this.signature;var extension=(0,_Utilities.pluckExtension)(file.name);vimeo_app.complete(attempt_id,video_file_id,upload_type,file,extension,signature).then(function(response){return _get(SiteClient.prototype.__proto__||Object.getPrototypeOf(SiteClient.prototype),"_onUploaderComplete",_this2).call(_this2)}).catch(function(error){logger.warn("[SiteClient] _onUploaderComplete failed",error.toString());return _this2._onUploaderFail(_errors.ERRORS.COMPLETE_CALL_FAILED)})}},{key:"_onUploaderFail",value:function _onUploaderFail(error){var attempt_id=this.attempt_id;_get(SiteClient.prototype.__proto__||Object.getPrototypeOf(SiteClient.prototype),"_onUploaderFail",this).call(this,error);if(!attempt_id){return}var vimeo_app=this.vimeo_app,upload_type=this.upload_type,signature=this.signature;if(error in _errors.ERROR_CODES&&attempt_id){vimeo_app.saveError(attempt_id,_errors.ERROR_CODES[error])}vimeo_app.fail(attempt_id,upload_type,signature)}},{key:"_onAttachReject",value:function _onAttachReject(error){var logger=this.logger;if(error&&(typeof error==="undefined"?"undefined":_typeof(error))==="object"&&"target"in error&&error.target instanceof XMLHttpRequest){logger.warn("[SiteClient] _onUploaderFail: "+error.target.status+" - "+error.target.responseText);_ravenJs2.default.captureMessage("[SiteClient] _onUploaderFail: "+error.target.status+" - "+error.target.responseText,{level:"warning"})}else{logger.error("[SiteClient] _onUploaderFail: "+error.toString());_ravenJs2.default.captureMessage("[SiteClient] _onUploaderFail: "+error.toString(),{level:"error"})}return Promise.reject(_errors.ERRORS.ATTACH_FAILED)}},{key:"_bindMethods",value:function _bindMethods(){this._onAttachReject=this._onAttachReject.bind(this);this._validate=this._validate.bind(this);this._createAttempt=this._createAttempt.bind(this);this._beginUploading=this._beginUploading.bind(this);this._setFileSizeChangeListener=this._setFileSizeChangeListener.bind(this);_get(SiteClient.prototype.__proto__||Object.getPrototypeOf(SiteClient.prototype),"_bindMethods",this).call(this)}},{key:"_validate",value:function _validate(fastest_region){this.fastest_region=fastest_region;var id=this.id,file=this.file,server_url=this.server_url,logger=this.logger,_onValidateReject=this._onValidateReject;this.state=_states2.default.VALIDATING;var validator=new _VideoValidator2.default(server_url+"/probe/"+id,logger);return validator.validateFile(file).catch(_onValidateReject)}},{key:"_createAttempt",value:function _createAttempt(content_type){var file=this.file,fastest_region=this.fastest_region,vimeo_app=this.vimeo_app,upload_type=this.upload_type,api_app=this.api_app,clip_id=this.clip_id,_onAttachReject=this._onAttachReject;this.state=_states2.default.ATTACHING;return vimeo_app.attach(file.name,file.size,upload_type,fastest_region.Region,api_app,content_type,clip_id).catch(_onAttachReject)}},{key:"_beginUploading",value:function _beginUploading(response){var logger=this.logger,file=this.file,config=this.config,_onUploaderProgress=this._onUploaderProgress,_onUploaderStateChange=this._onUploaderStateChange;var clip_id=response.clip_id,video_file_id=response.video_file_id,attempt_id=response.attempt_id,upload_id=response.upload_id,upload_endpoint=response.upload_endpoint,clip_url=response.clip_url,signature=response.signature;this.clip_id=clip_id;this.clip_url=clip_url;this.attempt_id=attempt_id;this.uid=upload_id;this.video_file_id=video_file_id;this.signature=signature;logger.addLabel("clip_id",clip_id);logger.addLabel("attempt_id",attempt_id);logger.addLabel("video_file_id",video_file_id);_ravenJs2.default.setExtraContext({"Clip ID":clip_id,"Attempt ID":attempt_id,"Video File ID":video_file_id});this.uploader=new _GCSUploader2.default(config,upload_endpoint,file,file.type,logger);this.uploader.attempt_id=attempt_id;this.uploader.on(_events2.default.PROGRESS,_onUploaderProgress);this.uploader.on(_events2.default.STATE_CHANGE,_onUploaderStateChange);this.uploader.upload()}},{key:"_setFileSizeChangeListener",value:function _setFileSizeChangeListener(){var _this3=this;this.on(_events2.default.FILE_SIZE_CHANGED,function(err){_this3.fail(err)})}},{key:"start",value:function start(){_get(SiteClient.prototype.__proto__||Object.getPrototypeOf(SiteClient.prototype),"start",this).call(this);var lighthouse=this.config.lighthouse;var _validate=this._validate,_createAttempt=this._createAttempt,_beginUploading=this._beginUploading,_onUploaderFail=this._onUploaderFail;lighthouse.getFastestRegion().then(_validate).then(_createAttempt).then(_beginUploading).catch(_onUploaderFail)}},{key:"pause",value:function pause(){_get(SiteClient.prototype.__proto__||Object.getPrototypeOf(SiteClient.prototype),"pause",this).call(this);var vimeo_app=this.vimeo_app,attempt_id=this.attempt_id,upload_type=this.upload_type,signature=this.signature,logger=this.logger,uploader=this.uploader;if(uploader){uploader.pause()}vimeo_app.pause(attempt_id,upload_type,signature).catch(function(error){logger.warn("[SiteClient] pause "+error.toString())})}},{key:"resume",value:function resume(){_get(SiteClient.prototype.__proto__||Object.getPrototypeOf(SiteClient.prototype),"resume",this).call(this);var vimeo_app=this.vimeo_app,attempt_id=this.attempt_id,upload_type=this.upload_type,signature=this.signature,logger=this.logger,uploader=this.uploader;if(uploader){uploader.resume()}vimeo_app.resume(attempt_id,upload_type,signature).catch(function(error){logger.warn("[SiteClient] resume "+error.toString())})}},{key:"fail",value:function fail(error){this.uploader.fail(error)}},{key:"cancel",value:function cancel(){_get(SiteClient.prototype.__proto__||Object.getPrototypeOf(SiteClient.prototype),"cancel",this).call(this);var vimeo_app=this.vimeo_app,attempt_id=this.attempt_id,upload_type=this.upload_type,signature=this.signature,logger=this.logger,uploader=this.uploader;if(uploader){uploader.cancel()}vimeo_app.cancel(attempt_id,upload_type,signature).catch(function(error){logger.warn("[SiteClient] cancel "+error.toString())})}}]);return SiteClient}(_BaseClient3.default);exports.default=SiteClient},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _v=__webpack_require__(10);var _v2=_interopRequireDefault(_v);var _events=__webpack_require__(13);var _events2=_interopRequireDefault(_events);var _states=__webpack_require__(3);var _states2=_interopRequireDefault(_states);var _events3=__webpack_require__(5);var _events4=_interopRequireDefault(_events3);var _Logger=__webpack_require__(14);var _Logger2=_interopRequireDefault(_Logger);var _Utilities=__webpack_require__(15);var _errors=__webpack_require__(16);var _types=__webpack_require__(6);var _ravenJs=__webpack_require__(17);var _ravenJs2=_interopRequireDefault(_ravenJs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var BaseClient=function(_EventEmitter){_inherits(BaseClient,_EventEmitter);function BaseClient(config,upload_type,api_app,file,clip_id){_classCallCheck(this,BaseClient);var _this=_possibleConstructorReturn(this,(BaseClient.__proto__||Object.getPrototypeOf(BaseClient)).call(this));_this.upload_type=upload_type;_this.file=file;_this.initial_size=file.size;_this.id=_this._generateId();_this.state=_states2.default.QUEUED;_this.bytes_uploaded=0;_this.api_app=api_app;_this.config=config;_this.logger=new _Logger2.default(config);_this.logger.addLabel("upload_type",upload_type);_this.logger.addLabel("api_app",api_app);if(clip_id){_this.logger.addLabel("clip_id",clip_id)}_this.error=null;_this.uploader=null;_this.clip_id=clip_id||null;_this.clip_url=null;_this.attempt_id=null;_this.fastest_region=null;_this.ip=null;_this.start_timestamp=0;_this.end_timestamp=0;_this.pause_duration=0;_this.slice_method=(0,_Utilities.getSliceMethod)();_this._bindMethods();return _this}_createClass(BaseClient,[{key:"_onUploaderProgress",value:function _onUploaderProgress(event){var file=this.file,_hasFileSizeChanged=this._hasFileSizeChanged;_hasFileSizeChanged();var loaded=event.loaded;this.bytes_uploaded=loaded;var speed_mbps=this.speed_mbps,eta=this.eta;return this.emit(_events4.default.PROGRESS,{bytes_uploaded:loaded,total_bytes:file.size,eta:eta,speed_mbps:speed_mbps})}},{key:"_onUploaderComplete",value:function _onUploaderComplete(){var file=this.file,config=this.config,upload_type=this.upload_type,logger=this.logger;this.end_timestamp=(new Date).getTime();this.bytes_uploaded=this.file.size;this._onUploaderProgress({loaded:file.size,total:file.size});this.state=_states2.default.COMPLETED;this.removeAllListeners();if(_types.REGIONLESS_TYPES.indexOf(upload_type)>=0){return logger.save()}if(!config.send_learning_data_to_leartherback){return logger.save()}this._saveLearningData();return logger.save()}},{key:"_onUploaderFail",value:function _onUploaderFail(error){var logger=this.logger;if(error&&(typeof error==="undefined"?"undefined":_typeof(error))==="object"&&"target"in error&&error.target instanceof XMLHttpRequest){logger.warn("[BaseClient] _onUploaderFail: Status: "+error.target.status+" "+error.target.statusText+" - Response text: "+error.target.responseText);_ravenJs2.default.captureMessage("[BaseClient] _onUploaderFail: "+error.target.status+" "+error.target.statusText+" - Response text: "+error.target.responseText,{level:"warning"})}else{logger.error("[BaseClient] _onUploaderFail: "+error.toString());_ravenJs2.default.captureMessage("[BaseClient] _onUploaderFail: "+error.toString(),{level:"error"})}if(error.stack){logger.error(error.stack);_ravenJs2.default.captureMessage(error.stack,{level:"error"})}this.end_timestamp=(new Date).getTime();this.error=error;this.state=_states2.default.FAILED;this.removeAllListeners();if(_errors.IGNORABLE_ERRORS.indexOf(error)>-1){return null}return logger.save()}},{key:"_onValidateReject",value:function _onValidateReject(error){var logger=this.logger,file=this.file;if(error===_errors.ERRORS.VALIDATOR_CALL_ERROR){logger.warn("[BaseClient] _onValidateReject: VALIDATOR_CALL_ERROR, passing through");_ravenJs2.default.captureMessage("[BaseClient] _onValidateReject: VALIDATOR_CALL_ERROR, passing through",{level:"warning"});return Promise.resolve(file.type)}if(error&&(typeof error==="undefined"?"undefined":_typeof(error))==="object"&&"target"in error&&error.target instanceof XMLHttpRequest){logger.warn("[BaseClient] _onValidateReject: "+error.target.status+" - "+error.target.responseText);_ravenJs2.default.captureMessage("[BaseClient] _onValidateReject: "+error.target.status+" - "+error.target.responseText,{level:"error"});return Promise.resolve(file.type)}logger.warn("[BaseClient] _onValidateReject: "+error.toString());_ravenJs2.default.captureMessage("[BaseClient] _onValidateReject: "+error.toString(),{level:"warning"});return Promise.reject(error)}},{key:"_onUploaderStateChange",value:function _onUploaderStateChange(){var uploader=this.uploader;switch(uploader.state){case _states2.default.COMPLETED:this._onUploaderComplete();break;case _states2.default.FAILED:this._onUploaderFail(uploader.error);break;default:this.state=uploader.state}}},{key:"_bindMethods",value:function _bindMethods(){this._onUploaderProgress=this._onUploaderProgress.bind(this);this._onUploaderComplete=this._onUploaderComplete.bind(this);this._onUploaderFail=this._onUploaderFail.bind(this);this._onValidateReject=this._onValidateReject.bind(this);this._onUploaderStateChange=this._onUploaderStateChange.bind(this);this._saveLearningData=this._saveLearningData.bind(this);this._hasFileSizeChanged=this._hasFileSizeChanged.bind(this)}},{key:"_generateId",value:function _generateId(){return(0,_v2.default)()}},{key:"_saveLearningData",value:function _saveLearningData(){var chunk_size=this.chunk_size,config=this.config,duration=this.duration,file=this.file,id=this.id,fastest_region=this.fastest_region,speed_mbps=this.speed_mbps,uid=this.uid,uploaders=this.uploaders,ip=this.ip;var payload={file_uid:uid?uid:config.service+"_"+id,chunk_size:chunk_size?chunk_size:file.size,parallel_requests:uploaders?uploaders.length:1,user_agent:window.navigator.userAgent,region:fastest_region.Region,upload_duration:duration,upload_speed_mbps:speed_mbps,file_size:file.size,ip_address:ip};var options={method:"POST",headers:{Authorization:"Bearer "+config.leatherback.token,"Content-Type":"application/json"},body:JSON.stringify(payload)};return(0,_Utilities.requestWithRetry)(config.leatherback.url+"/learning",options).catch(console.warn)}},{key:"_hasFileSizeChanged",value:function _hasFileSizeChanged(){var file=this.file,initial_size=this.initial_size;if(file.size!==initial_size){var err=file.size===0?_errors.ERRORS.VIDEO_FILE_REMOVED:_errors.ERRORS.VIDEO_FILE_SIZE_CHANGED;this.emit(_events4.default.FILE_SIZE_CHANGED,err)}}},{key:"start",value:function start(){this.state=_states2.default.STARTING}},{key:"pause",value:function pause(){var logger=this.logger,state=this.state
;if(state!==_states2.default.UPLOADING){logger.warn("Can only pause while uploading ("+state+")");return}this.pause_start=(new Date).getTime();this.state=_states2.default.PAUSED}},{key:"resume",value:function resume(){var logger=this.logger,state=this.state;if(state!==_states2.default.PAUSED){logger.warn("Can only resume while paused ("+state+")");return}this.pause_duration+=(new Date).getTime()-this.pause_start;this.state=_states2.default.RESUMING}},{key:"fail",value:function fail(error){console.warn("[BaseClient.fail] Should only be called by subclass")}},{key:"cancel",value:function cancel(){this.state=_states2.default.CANCELED;this.removeAllListeners()}},{key:"state",get:function get(){return this._state},set:function set(state){if(state===undefined||this._state===state){return}if(Object.keys(_states2.default).indexOf(state)===-1){throw new Error("Invalid state set for Upload: "+state)}var is_resume=this._state===_states2.default.RESUMING;var is_restart=this._state===_states2.default.REROUTING;this._state=state;this._hasFileSizeChanged();this.emit(_events4.default.STATE_CHANGE,{state:state,is_resume:is_resume,upload:this});if(state===_states2.default.UPLOADING&&!is_resume&&!is_restart){this.start_timestamp=(new Date).getTime()}}},{key:"inactive",get:function get(){if(this._state===_states2.default.CANCELED||this._state===_states2.default.COMPLETED||this._state===_states2.default.FAILED){return true}return false}},{key:"active",get:function get(){if(this._state===_states2.default.STARTING||this._state===_states2.default.VALIDATING||this._state===_states2.default.ATTACHING||this._state===_states2.default.UPLOADING||this._state===_states2.default.RESUMING||this._state===_states2.default.REROUTING){return true}return false}},{key:"speed_mbps",get:function get(){var bytes_uploaded=this.bytes_uploaded,duration=this.duration;if(duration===0){return 0}var size_in_bits=bytes_uploaded*8;return Math.round(size_in_bits/1024/1024/duration)}},{key:"duration",get:function get(){var start_timestamp=this.start_timestamp,pause_duration=this.pause_duration,end_timestamp=this.end_timestamp;var start_time=start_timestamp-pause_duration;var end_time=end_timestamp>0?end_timestamp:(new Date).getTime();return Math.round((end_time-start_time)/1e3)}},{key:"eta",get:function get(){var bytes_uploaded=this.bytes_uploaded,duration=this.duration,file=this.file;if(bytes_uploaded===0||bytes_uploaded===file.size){return 0}var remaining_bytes=file.size-bytes_uploaded;var raw_speed=bytes_uploaded/duration;return Math.round(remaining_bytes/raw_speed)}}]);return BaseClient}(_events2.default);exports.default=BaseClient},function(module,exports,__webpack_require__){var rng=__webpack_require__(11);var bytesToUuid=__webpack_require__(12);function v4(options,buf,offset){var i=buf&&offset||0;if(typeof options=="string"){buf=options==="binary"?new Array(16):null;options=null}options=options||{};var rnds=options.random||(options.rng||rng)();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){for(var ii=0;ii<16;++ii){buf[i+ii]=rnds[ii]}}return buf||bytesToUuid(rnds)}module.exports=v4},function(module,exports){var getRandomValues=typeof crypto!="undefined"&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&msCrypto.getRandomValues.bind(msCrypto);if(getRandomValues){var rnds8=new Uint8Array(16);module.exports=function whatwgRNG(){getRandomValues(rnds8);return rnds8}}else{var rnds=new Array(16);module.exports=function mathRNG(){for(var i=0,r;i<16;i++){if((i&3)===0)r=Math.random()*4294967296;rnds[i]=r>>>((i&3)<<3)&255}return rnds}}},function(module,exports){var byteToHex=[];for(var i=0;i<256;++i){byteToHex[i]=(i+256).toString(16).substr(1)}function bytesToUuid(buf,offset){var i=offset||0;var bth=byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}module.exports=bytesToUuid},function(module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error('Uncaught, unspecified "error" event. ('+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++)listeners[i].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Utilities=__webpack_require__(15);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var console_methods=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","trace","warn"];var STACKDRIVE_SEVERITY_MAP={log:"DEFAULT",info:"INFO",debug:"NOTICE",warn:"WARNING",error:"ERROR"};var consoleDelegate=function consoleDelegate(){var console_obj={};var limit=console_methods.length;for(var i=0;i<limit;i++){console_obj[console_methods[i]]=function(){}}return console_obj};var Logger=function(){function Logger(config){_classCallCheck(this,Logger);this.limit=console_methods.length;this._logs=[];this._log_strings=[];this._console=(typeof console==="undefined"?"undefined":_typeof(console))==="object"?console:consoleDelegate();this.config=config;this.output_to_console=config.log_to_console||config.user.is_mod;this.labels={version:config.version,user_id:""+config.user.id,user_account_type:config.user.account_type,user_agent:window.navigator.userAgent}}_createClass(Logger,[{key:"_normalizeLog",value:function _normalizeLog(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}var arguments_length=args.length;var log_string="";if(arguments_length===0){return null}for(var i=0;i<arguments_length;i++){var argument=args[i];var argument_type=typeof argument==="undefined"?"undefined":_typeof(argument);if(argument_type==="string"||argument_type==="number"||argument_type==="boolean"){log_string+=argument}else{log_string+="[Object object]"}if(i<arguments_length-1){log_string+=", "}}return log_string}},{key:"_addLogEntry",value:function _addLogEntry(method){var labels=this.labels;for(var _len2=arguments.length,args=Array(_len2>1?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2]}for(var i=0;i<args.length;i++){var severity=STACKDRIVE_SEVERITY_MAP[method];var log={severity:severity,labels:labels,timestamp:(new Date).toISOString()};var argument=args[i];var argument_type=typeof argument==="undefined"?"undefined":_typeof(argument);if(argument_type==="object"&&!Array.isArray(argument_type)){log.jsonPayload=argument}else{log.textPayload=argument}this._logs.push(log)}var log_string=this._normalizeLog.apply(this,args);this._log_strings.push(log_string);if(!this.output_to_console){return}this._console[method](log_string)}},{key:"addLabel",value:function addLabel(key,value){if(!key||!value){this._addLogEntry("warn","Incorrect logger label: {"+key+": "+value+"}");return}this.labels[""+key]=""+value;this._logs=this._logs.map(function(log){log.labels[""+key]=""+value;return log})}},{key:"log",value:function log(){for(var _len3=arguments.length,args=Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3]}if(args.length===0){return}this._addLogEntry.apply(this,["log"].concat(args))}},{key:"info",value:function info(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4]}if(args.length===0){return}this._addLogEntry.apply(this,["info"].concat(args))}},{key:"debug",value:function debug(){for(var _len5=arguments.length,args=Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5]}if(args.length===0){return}this._addLogEntry.apply(this,["debug"].concat(args))}},{key:"warn",value:function warn(){for(var _len6=arguments.length,args=Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6]}if(args.length===0){return}this._addLogEntry.apply(this,["warn"].concat(args))}},{key:"error",value:function error(){for(var _len7=arguments.length,args=Array(_len7),_key7=0;_key7<_len7;_key7++){args[_key7]=arguments[_key7]}if(args.length===0){return}this._addLogEntry.apply(this,["error"].concat(args))}},{key:"save",value:function save(){var _this=this;var config=this.config,_logs=this._logs;var headers={Authorization:"Bearer "+config.leatherback.token,"Content-Type":"application/json"};var payload={entries:_logs};var params={method:"POST",headers:headers,body:JSON.stringify(payload)};return(0,_Utilities.requestWithRetry)(config.leatherback.url+"/log",params).then(function(){_this.clear()})}},{key:"clear",value:function clear(){this._logs=[];this._log_strings=[]}},{key:"logs",get:function get(){return this._log_strings}}]);return Logger}();exports.default=Logger},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var pluckExtension=exports.pluckExtension=function pluckExtension(file_name){var extension=void 0;if(file_name.match(/\.([^.]*)$/i)){extension=file_name.split(".").pop().toLowerCase()}return extension};var serialize=exports.serialize=function serialize(object,base){var query_string=[];var result=void 0;for(var key in object){if(object.hasOwnProperty(key)){var value=object[key];if(base){key=base+"["+key+"]"}switch(Object.prototype.toString.call(value)){case"[object Object]":result=serialize(value,key);break;case"[object Array]":var temp_qs={};if(value.length===0){value=null}else{for(var i=0,limit=value.length;i<limit;i++){temp_qs[i]=value[i]}result=serialize(temp_qs,key)}break;default:result=key+"="+encodeURIComponent(value)}if(value!==null){query_string.push(result)}}}return query_string.join("&")};var getSliceMethod=exports.getSliceMethod=function getSliceMethod(){if(!("Blob"in window)){return false}var blob=void 0;try{blob=new Blob}catch(error){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(!window.BlobBuilder){return false}if(error.name==="TypeError"&&window.BlobBuilder){var bb=new window.BlobBuilder;blob=bb.getBlob()}}if("slice"in blob){return"slice"}if("mozSlice"in blob){return"mozSlice"}if("webkitSlice"in blob){return"webkitSlice"}return false};var returnIntegerOrSelf=exports.returnIntegerOrSelf=function returnIntegerOrSelf(item){return isNaN(item)?item:parseInt(item,10)};var getChunkRange=exports.getChunkRange=function getChunkRange(file_size,chunk_size,index,total_parts){var last_index=index-1;var uploaded=chunk_size*last_index;var start_byte=uploaded+last_index;var end_byte=start_byte+chunk_size+1;if(end_byte>file_size||index>=total_parts){end_byte=file_size}return[start_byte,end_byte]};var retryFunctionOnReject=exports.retryFunctionOnReject=function retryFunctionOnReject(fn){var maxRetries=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;var retryCount=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return new Promise(function(resolve,reject){fn.apply(undefined,args).then(resolve).catch(function(error){var count=retryCount+1;if(count>maxRetries){return reject(error)}var delay=Math.pow(2,count)*1e3+Math.round(Math.random()*1e3);var nextFn=retryFunctionOnReject(fn,maxRetries,count);return setTimeout(function(){nextFn.apply(undefined,args).then(resolve).catch(reject)},delay)})})}};var request=exports.request=function request(url,options){var DEFAULT_OPTIONS={method:"GET",headers:{},body:null,withCredentials:false,successCode:200};options=_extends({},DEFAULT_OPTIONS,options);return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open(options.method,url);Object.keys(options.headers).forEach(function(key){xhr.setRequestHeader(key,options.headers[key])});xhr.addEventListener("load",function(event){if(event.target.status!==options.successCode){return reject(event)}return resolve(event)});xhr.addEventListener("error",reject);xhr.addEventListener("timeout",reject);xhr.send(options.body)})};var requestWithRetry=exports.requestWithRetry=retryFunctionOnReject(request,4)},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.ERROR_CODES=exports.API_ERROR_CODES=exports.FATAL_ERRORS=exports.IGNORABLE_ERRORS=exports.ERRORS=undefined;var _keymirror=__webpack_require__(4);var _keymirror2=_interopRequireDefault(_keymirror);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var ERRORS=exports.ERRORS=(0,_keymirror2.default)({NO_MACHINE_ID:null,VERIFICATION_FAILED:null,DNS_ERROR:null,COMPLETE_CALL_FAILED:null,RETRY_FAILED:null,ATTACH_FAILED:null,PROGRESS_CALL_ERROR:null,METADATA_CALL_ERROR:null,PROGRESS_STATE_MISMATCH:null,VIDEO_FILE_INVALID:null,QUOTA_EXCEEDED:null,NETWORK_ERROR:null,VIDEO_FILE_REMOVED:null,VIDEO_FILE_SIZE_CHANGED:null,FILE_TOO_SMALL:null,INVALID_DROPBOX_URL:null,INVALID_UPLOAD_ENDPOINT:null,RANGE_FAILED:null,PULL_FAILED:null,VALIDATOR_CALL_ERROR:null,LIGHTHOUSE_LOAD_ERROR:null,LIGHTHOUSE_RACE_ERROR:null,RANGE_RESUME_FAILED:null,TOTAL_CAP_EXCEEDED:null});var IGNORABLE_ERRORS=exports.IGNORABLE_ERRORS=[ERRORS.VIDEO_FILE_INVALID,ERRORS.VIDEO_FILE_SIZE_CHANGED,ERRORS.VIDEO_FILE_REMOVED];var FATAL_ERRORS=exports.FATAL_ERRORS=[ERRORS.VIDEO_FILE_REMOVED,ERRORS.VIDEO_FILE_SIZE_CHANGED];var API_ERROR_CODES=exports.API_ERROR_CODES={INVALID_FILE:2204};var ERROR_CODES=exports.ERROR_CODES={NO_MACHINE_ID:901,VERIFICATION_FAILED:902,DNS_ERROR:903,COMPLETE_CALL_FAILED:904,RETRY_FAILED:905,ATTACH_FAILED:906,PROGRESS_CALL_ERROR:907,METADATA_CALL_ERROR:908,PROGRESS_STATE_MISMATCH:909,VIDEO_FILE_INVALID:910,QUOTA_EXCEEDED:911,NETWORK_ERROR:912,VIDEO_FILE_REMOVED:913,VIDEO_FILE_SIZE_CHANGED:914,FILE_TOO_SMALL:915,INVALID_DROPBOX_URL:916,INVALID_UPLOAD_ENDPOINT:917,RANGE_FAILED:918,PULL_FAILED:919,VALIDATOR_CALL_ERROR:920,LIGHTHOUSE_LOAD_ERROR:921,LIGHTHOUSE_RACE_ERROR:922,RANGE_RESUME_FAILED:923,TOTAL_CAP_EXCEEDED:924}},function(module,exports,__webpack_require__){(function(global){"use strict";var RavenConstructor=__webpack_require__(18);var _window=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var _Raven=_window.Raven;var Raven=new RavenConstructor;Raven.noConflict=function(){_window.Raven=_Raven;return Raven};Raven.afterLoad();module.exports=Raven}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){(function(global){"use strict";var TraceKit=__webpack_require__(19);var stringify=__webpack_require__(21);var RavenConfigError=__webpack_require__(22);var utils=__webpack_require__(20);var isError=utils.isError,isObject=utils.isObject;var wrapConsoleMethod=__webpack_require__(23).wrapMethod;var dsnKeys="source protocol user pass host port path".split(" "),dsnPattern=/^(?:(\w+):)?\/\/(?:(\w+)(:\w+)?@)?([\w\.-]+)(?::(\d+))?(\/.*)/;function now(){return+new Date}var _window=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var _document=_window.document;var _navigator=_window.navigator;function keepOriginalCallback(original,callback){return isFunction(callback)?function(data){return callback(data,original)}:callback}function Raven(){this._hasJSON=!!(typeof JSON==="object"&&JSON.stringify);this._hasDocument=!isUndefined(_document);this._hasNavigator=!isUndefined(_navigator);this._lastCapturedException=null;this._lastData=null;this._lastEventId=null;this._globalServer=null;this._globalKey=null;this._globalProject=null;this._globalContext={};this._globalOptions={logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],crossOrigin:"anonymous",collectWindowErrors:true,maxMessageLength:0,maxUrlLength:250,stackTraceLimit:50,autoBreadcrumbs:true,instrument:true,sampleRate:1};this._ignoreOnError=0;this._isRavenInstalled=false;this._originalErrorStackTraceLimit=Error.stackTraceLimit;this._originalConsole=_window.console||{};this._originalConsoleMethods={};this._plugins=[];this._startTime=now();this._wrappedBuiltIns=[];this._breadcrumbs=[];this._lastCapturedEvent=null;this._keypressTimeout;this._location=_window.location;this._lastHref=this._location&&this._location.href;this._resetBackoff();for(var method in this._originalConsole){this._originalConsoleMethods[method]=this._originalConsole[method]}}Raven.prototype={VERSION:"3.16.0",debug:false,TraceKit:TraceKit,config:function(dsn,options){var self=this;if(self._globalServer){this._logDebug("error","Error: Raven has already been configured");return self}if(!dsn)return self;var globalOptions=self._globalOptions;if(options){each(options,function(key,value){if(key==="tags"||key==="extra"||key==="user"){self._globalContext[key]=value}else{globalOptions[key]=value}})}self.setDSN(dsn);globalOptions.ignoreErrors.push(/^Script error\.?$/);globalOptions.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/);globalOptions.ignoreErrors=joinRegExp(globalOptions.ignoreErrors);globalOptions.ignoreUrls=globalOptions.ignoreUrls.length?joinRegExp(globalOptions.ignoreUrls):false;globalOptions.whitelistUrls=globalOptions.whitelistUrls.length?joinRegExp(globalOptions.whitelistUrls):false;globalOptions.includePaths=joinRegExp(globalOptions.includePaths);globalOptions.maxBreadcrumbs=Math.max(0,Math.min(globalOptions.maxBreadcrumbs||100,100));var autoBreadcrumbDefaults={xhr:true,console:true,dom:true,location:true};var autoBreadcrumbs=globalOptions.autoBreadcrumbs;if({}.toString.call(autoBreadcrumbs)==="[object Object]"){autoBreadcrumbs=objectMerge(autoBreadcrumbDefaults,autoBreadcrumbs)}else if(autoBreadcrumbs!==false){autoBreadcrumbs=autoBreadcrumbDefaults}globalOptions.autoBreadcrumbs=autoBreadcrumbs;var instrumentDefaults={tryCatch:true};var instrument=globalOptions.instrument;if({}.toString.call(instrument)==="[object Object]"){instrument=objectMerge(instrumentDefaults,instrument)}else if(instrument!==false){instrument=instrumentDefaults}globalOptions.instrument=instrument;TraceKit.collectWindowErrors=!!globalOptions.collectWindowErrors;return self},install:function(){var self=this;if(self.isSetup()&&!self._isRavenInstalled){TraceKit.report.subscribe(function(){self._handleOnErrorStackInfo.apply(self,arguments)});if(self._globalOptions.instrument&&self._globalOptions.instrument.tryCatch){self._instrumentTryCatch()}if(self._globalOptions.autoBreadcrumbs)self._instrumentBreadcrumbs();self._drainPlugins();self._isRavenInstalled=true}Error.stackTraceLimit=self._globalOptions.stackTraceLimit;return this},setDSN:function(dsn){var self=this,uri=self._parseDSN(dsn),lastSlash=uri.path.lastIndexOf("/"),path=uri.path.substr(1,lastSlash);self._dsn=dsn;self._globalKey=uri.user;self._globalSecret=uri.pass&&uri.pass.substr(1);self._globalProject=uri.path.substr(lastSlash+1);self._globalServer=self._getGlobalServer(uri);self._globalEndpoint=self._globalServer+"/"+path+"api/"+self._globalProject+"/store/";this._resetBackoff()},context:function(options,func,args){if(isFunction(options)){args=func||[];func=options;options=undefined}return this.wrap(options,func).apply(this,args)},wrap:function(options,func,_before){var self=this;if(isUndefined(func)&&!isFunction(options)){return options}if(isFunction(options)){func=options;options=undefined}if(!isFunction(func)){return func}try{if(func.__raven__){return func}if(func.__raven_wrapper__){return func.__raven_wrapper__}}catch(e){return func}function wrapped(){var args=[],i=arguments.length,deep=!options||options&&options.deep!==false;if(_before&&isFunction(_before)){_before.apply(this,arguments)}while(i--)args[i]=deep?self.wrap(options,arguments[i]):arguments[i];try{return func.apply(this,args)}catch(e){self._ignoreNextOnError();self.captureException(e,options);throw e}}for(var property in func){if(hasKey(func,property)){wrapped[property]=func[property]}}wrapped.prototype=func.prototype;func.__raven_wrapper__=wrapped;wrapped.__raven__=true;wrapped.__inner__=func;return wrapped},uninstall:function(){TraceKit.report.uninstall();this._restoreBuiltIns();Error.stackTraceLimit=this._originalErrorStackTraceLimit;this._isRavenInstalled=false;return this},captureException:function(ex,options){if(!isError(ex)){return this.captureMessage(ex,objectMerge({trimHeadFrames:1,stacktrace:true},options))}this._lastCapturedException=ex;try{var stack=TraceKit.computeStackTrace(ex);this._handleStackInfo(stack,options)}catch(ex1){if(ex!==ex1){throw ex1}}return this},captureMessage:function(msg,options){if(!!this._globalOptions.ignoreErrors.test&&this._globalOptions.ignoreErrors.test(msg)){return}options=options||{};var data=objectMerge({message:msg+""},options);if(this._globalOptions.stacktrace||options&&options.stacktrace){var ex;try{throw new Error(msg)}catch(ex1){ex=ex1}ex.name=null;options=objectMerge({fingerprint:msg,trimHeadFrames:(options.trimHeadFrames||0)+1},options);var stack=TraceKit.computeStackTrace(ex);var frames=this._prepareFrames(stack,options);data.stacktrace={frames:frames.reverse()}}this._send(data);return this},captureBreadcrumb:function(obj){var crumb=objectMerge({timestamp:now()/1e3},obj);if(isFunction(this._globalOptions.breadcrumbCallback)){var result=this._globalOptions.breadcrumbCallback(crumb);if(isObject(result)&&!isEmptyObject(result)){crumb=result}else if(result===false){return this}}this._breadcrumbs.push(crumb);if(this._breadcrumbs.length>this._globalOptions.maxBreadcrumbs){this._breadcrumbs.shift()}return this},addPlugin:function(plugin){var pluginArgs=[].slice.call(arguments,1);this._plugins.push([plugin,pluginArgs]);if(this._isRavenInstalled){this._drainPlugins()}return this},setUserContext:function(user){this._globalContext.user=user;return this},setExtraContext:function(extra){this._mergeContext("extra",extra);return this},setTagsContext:function(tags){this._mergeContext("tags",tags);return this},clearContext:function(){this._globalContext={};return this},getContext:function(){return JSON.parse(stringify(this._globalContext))},setEnvironment:function(environment){this._globalOptions.environment=environment;return this},setRelease:function(release){this._globalOptions.release=release;return this},setDataCallback:function(callback){var original=this._globalOptions.dataCallback;this._globalOptions.dataCallback=keepOriginalCallback(original,callback);return this},setBreadcrumbCallback:function(callback){var original=this._globalOptions.breadcrumbCallback;this._globalOptions.breadcrumbCallback=keepOriginalCallback(original,callback);return this},setShouldSendCallback:function(callback){var original=this._globalOptions.shouldSendCallback;this._globalOptions.shouldSendCallback=keepOriginalCallback(original,callback);return this},setTransport:function(transport){this._globalOptions.transport=transport;return this},lastException:function(){return this._lastCapturedException},lastEventId:function(){return this._lastEventId},isSetup:function(){if(!this._hasJSON)return false;if(!this._globalServer){if(!this.ravenNotConfiguredError){this.ravenNotConfiguredError=true;this._logDebug("error","Error: Raven has not been configured.")}return false}return true},afterLoad:function(){var RavenConfig=_window.RavenConfig;if(RavenConfig){this.config(RavenConfig.dsn,RavenConfig.config).install()}},showReportDialog:function(options){if(!_document)return;options=options||{};var lastEventId=options.eventId||this.lastEventId();if(!lastEventId){throw new RavenConfigError("Missing eventId")}var dsn=options.dsn||this._dsn;if(!dsn){throw new RavenConfigError("Missing DSN")}var encode=encodeURIComponent;var qs="";qs+="?eventId="+encode(lastEventId);qs+="&dsn="+encode(dsn);var user=options.user||this._globalContext.user;if(user){if(user.name)qs+="&name="+encode(user.name);if(user.email)qs+="&email="+encode(user.email)}var globalServer=this._getGlobalServer(this._parseDSN(dsn));var script=_document.createElement("script");script.async=true;script.src=globalServer+"/api/embed/error-page/"+qs;(_document.head||_document.body).appendChild(script)},_ignoreNextOnError:function(){var self=this;this._ignoreOnError+=1;setTimeout(function(){self._ignoreOnError-=1})},_triggerEvent:function(eventType,options){var evt,key;if(!this._hasDocument)return;options=options||{};eventType="raven"+eventType.substr(0,1).toUpperCase()+eventType.substr(1);if(_document.createEvent){evt=_document.createEvent("HTMLEvents");evt.initEvent(eventType,true,true)}else{evt=_document.createEventObject();evt.eventType=eventType}for(key in options)if(hasKey(options,key)){evt[key]=options[key]}if(_document.createEvent){_document.dispatchEvent(evt)}else{try{_document.fireEvent("on"+evt.eventType.toLowerCase(),evt)}catch(e){}}},_breadcrumbEventHandler:function(evtName){var self=this;return function(evt){self._keypressTimeout=null;if(self._lastCapturedEvent===evt)return;self._lastCapturedEvent=evt;var target;try{target=htmlTreeAsString(evt.target)}catch(e){target="<unknown>"}self.captureBreadcrumb({category:"ui."+evtName,message:target})}},_keypressEventHandler:function(){var self=this,debounceDuration=1e3;return function(evt){var target;try{target=evt.target}catch(e){return}var tagName=target&&target.tagName;if(!tagName||tagName!=="INPUT"&&tagName!=="TEXTAREA"&&!target.isContentEditable)return;var timeout=self._keypressTimeout;if(!timeout){self._breadcrumbEventHandler("input")(evt)}clearTimeout(timeout);self._keypressTimeout=setTimeout(function(){self._keypressTimeout=null},debounceDuration)}},_captureUrlChange:function(from,to){var parsedLoc=parseUrl(this._location.href);var parsedTo=parseUrl(to);var parsedFrom=parseUrl(from);this._lastHref=to;if(parsedLoc.protocol===parsedTo.protocol&&parsedLoc.host===parsedTo.host)to=parsedTo.relative;if(parsedLoc.protocol===parsedFrom.protocol&&parsedLoc.host===parsedFrom.host)from=parsedFrom.relative;this.captureBreadcrumb({category:"navigation",data:{to:to,from:from}})},_instrumentTryCatch:function(){var self=this;var wrappedBuiltIns=self._wrappedBuiltIns;function wrapTimeFn(orig){return function(fn,t){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}var originalCallback=args[0];if(isFunction(originalCallback)){args[0]=self.wrap(originalCallback)}if(orig.apply){return orig.apply(this,args)}else{return orig(args[0],args[1])}}}var autoBreadcrumbs=this._globalOptions.autoBreadcrumbs;function wrapEventTarget(global){var proto=_window[global]&&_window[global].prototype
;if(proto&&proto.hasOwnProperty&&proto.hasOwnProperty("addEventListener")){fill(proto,"addEventListener",function(orig){return function(evtName,fn,capture,secure){try{if(fn&&fn.handleEvent){fn.handleEvent=self.wrap(fn.handleEvent)}}catch(err){}var before,clickHandler,keypressHandler;if(autoBreadcrumbs&&autoBreadcrumbs.dom&&(global==="EventTarget"||global==="Node")){clickHandler=self._breadcrumbEventHandler("click");keypressHandler=self._keypressEventHandler();before=function(evt){if(!evt)return;var eventType;try{eventType=evt.type}catch(e){return}if(eventType==="click")return clickHandler(evt);else if(eventType==="keypress")return keypressHandler(evt)}}return orig.call(this,evtName,self.wrap(fn,undefined,before),capture,secure)}},wrappedBuiltIns);fill(proto,"removeEventListener",function(orig){return function(evt,fn,capture,secure){try{fn=fn&&(fn.__raven_wrapper__?fn.__raven_wrapper__:fn)}catch(e){}return orig.call(this,evt,fn,capture,secure)}},wrappedBuiltIns)}}fill(_window,"setTimeout",wrapTimeFn,wrappedBuiltIns);fill(_window,"setInterval",wrapTimeFn,wrappedBuiltIns);if(_window.requestAnimationFrame){fill(_window,"requestAnimationFrame",function(orig){return function(cb){return orig(self.wrap(cb))}},wrappedBuiltIns)}var eventTargets=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"];for(var i=0;i<eventTargets.length;i++){wrapEventTarget(eventTargets[i])}},_instrumentBreadcrumbs:function(){var self=this;var autoBreadcrumbs=this._globalOptions.autoBreadcrumbs;var wrappedBuiltIns=self._wrappedBuiltIns;function wrapProp(prop,xhr){if(prop in xhr&&isFunction(xhr[prop])){fill(xhr,prop,function(orig){return self.wrap(orig)})}}if(autoBreadcrumbs.xhr&&"XMLHttpRequest"in _window){var xhrproto=XMLHttpRequest.prototype;fill(xhrproto,"open",function(origOpen){return function(method,url){if(isString(url)&&url.indexOf(self._globalKey)===-1){this.__raven_xhr={method:method,url:url,status_code:null}}return origOpen.apply(this,arguments)}},wrappedBuiltIns);fill(xhrproto,"send",function(origSend){return function(data){var xhr=this;function onreadystatechangeHandler(){if(xhr.__raven_xhr&&(xhr.readyState===1||xhr.readyState===4)){try{xhr.__raven_xhr.status_code=xhr.status}catch(e){}self.captureBreadcrumb({type:"http",category:"xhr",data:xhr.__raven_xhr})}}var props=["onload","onerror","onprogress"];for(var j=0;j<props.length;j++){wrapProp(props[j],xhr)}if("onreadystatechange"in xhr&&isFunction(xhr.onreadystatechange)){fill(xhr,"onreadystatechange",function(orig){return self.wrap(orig,undefined,onreadystatechangeHandler)})}else{xhr.onreadystatechange=onreadystatechangeHandler}return origSend.apply(this,arguments)}},wrappedBuiltIns)}if(autoBreadcrumbs.xhr&&"fetch"in _window){fill(_window,"fetch",function(origFetch){return function(fn,t){var args=new Array(arguments.length);for(var i=0;i<args.length;++i){args[i]=arguments[i]}var fetchInput=args[0];var method="GET";var url;if(typeof fetchInput==="string"){url=fetchInput}else{url=fetchInput.url;if(fetchInput.method){method=fetchInput.method}}if(args[1]&&args[1].method){method=args[1].method}var fetchData={method:method,url:url,status_code:null};self.captureBreadcrumb({type:"http",category:"fetch",data:fetchData});return origFetch.apply(this,args).then(function(response){fetchData.status_code=response.status;return response})}},wrappedBuiltIns)}if(autoBreadcrumbs.dom&&this._hasDocument){if(_document.addEventListener){_document.addEventListener("click",self._breadcrumbEventHandler("click"),false);_document.addEventListener("keypress",self._keypressEventHandler(),false)}else{_document.attachEvent("onclick",self._breadcrumbEventHandler("click"));_document.attachEvent("onkeypress",self._keypressEventHandler())}}var chrome=_window.chrome;var isChromePackagedApp=chrome&&chrome.app&&chrome.app.runtime;var hasPushState=!isChromePackagedApp&&_window.history&&history.pushState;if(autoBreadcrumbs.location&&hasPushState){var oldOnPopState=_window.onpopstate;_window.onpopstate=function(){var currentHref=self._location.href;self._captureUrlChange(self._lastHref,currentHref);if(oldOnPopState){return oldOnPopState.apply(this,arguments)}};fill(history,"pushState",function(origPushState){return function(){var url=arguments.length>2?arguments[2]:undefined;if(url){self._captureUrlChange(self._lastHref,url+"")}return origPushState.apply(this,arguments)}},wrappedBuiltIns)}if(autoBreadcrumbs.console&&"console"in _window&&console.log){var consoleMethodCallback=function(msg,data){self.captureBreadcrumb({message:msg,level:data.level,category:"console"})};each(["debug","info","warn","error","log"],function(_,level){wrapConsoleMethod(console,level,consoleMethodCallback)})}},_restoreBuiltIns:function(){var builtin;while(this._wrappedBuiltIns.length){builtin=this._wrappedBuiltIns.shift();var obj=builtin[0],name=builtin[1],orig=builtin[2];obj[name]=orig}},_drainPlugins:function(){var self=this;each(this._plugins,function(_,plugin){var installer=plugin[0];var args=plugin[1];installer.apply(self,[self].concat(args))})},_parseDSN:function(str){var m=dsnPattern.exec(str),dsn={},i=7;try{while(i--)dsn[dsnKeys[i]]=m[i]||""}catch(e){throw new RavenConfigError("Invalid DSN: "+str)}if(dsn.pass&&!this._globalOptions.allowSecretKey){throw new RavenConfigError("Do not specify your secret key in the DSN. See: http://bit.ly/raven-secret-key")}return dsn},_getGlobalServer:function(uri){var globalServer="//"+uri.host+(uri.port?":"+uri.port:"");if(uri.protocol){globalServer=uri.protocol+":"+globalServer}return globalServer},_handleOnErrorStackInfo:function(){if(!this._ignoreOnError){this._handleStackInfo.apply(this,arguments)}},_handleStackInfo:function(stackInfo,options){var frames=this._prepareFrames(stackInfo,options);this._triggerEvent("handle",{stackInfo:stackInfo,options:options});this._processException(stackInfo.name,stackInfo.message,stackInfo.url,stackInfo.lineno,frames,options)},_prepareFrames:function(stackInfo,options){var self=this;var frames=[];if(stackInfo.stack&&stackInfo.stack.length){each(stackInfo.stack,function(i,stack){var frame=self._normalizeFrame(stack);if(frame){frames.push(frame)}});if(options&&options.trimHeadFrames){for(var j=0;j<options.trimHeadFrames&&j<frames.length;j++){frames[j].in_app=false}}}frames=frames.slice(0,this._globalOptions.stackTraceLimit);return frames},_normalizeFrame:function(frame){if(!frame.url)return;var normalized={filename:frame.url,lineno:frame.line,colno:frame.column,function:frame.func||"?"};normalized.in_app=!(!!this._globalOptions.includePaths.test&&!this._globalOptions.includePaths.test(normalized.filename)||/(Raven|TraceKit)\./.test(normalized["function"])||/raven\.(min\.)?js$/.test(normalized.filename));return normalized},_processException:function(type,message,fileurl,lineno,frames,options){var stacktrace;if(!!this._globalOptions.ignoreErrors.test&&this._globalOptions.ignoreErrors.test(message))return;message+="";if(frames&&frames.length){fileurl=frames[0].filename||fileurl;frames.reverse();stacktrace={frames:frames}}else if(fileurl){stacktrace={frames:[{filename:fileurl,lineno:lineno,in_app:true}]}}if(!!this._globalOptions.ignoreUrls.test&&this._globalOptions.ignoreUrls.test(fileurl))return;if(!!this._globalOptions.whitelistUrls.test&&!this._globalOptions.whitelistUrls.test(fileurl))return;var data=objectMerge({exception:{values:[{type:type,value:message,stacktrace:stacktrace}]},culprit:fileurl},options);this._send(data)},_trimPacket:function(data){var max=this._globalOptions.maxMessageLength;if(data.message){data.message=truncate(data.message,max)}if(data.exception){var exception=data.exception.values[0];exception.value=truncate(exception.value,max)}var request=data.request;if(request){if(request.url){request.url=truncate(request.url,this._globalOptions.maxUrlLength)}if(request.Referer){request.Referer=truncate(request.Referer,this._globalOptions.maxUrlLength)}}if(data.breadcrumbs&&data.breadcrumbs.values)this._trimBreadcrumbs(data.breadcrumbs);return data},_trimBreadcrumbs:function(breadcrumbs){var urlProps=["to","from","url"],urlProp,crumb,data;for(var i=0;i<breadcrumbs.values.length;++i){crumb=breadcrumbs.values[i];if(!crumb.hasOwnProperty("data")||!isObject(crumb.data)||objectFrozen(crumb.data))continue;data=objectMerge({},crumb.data);for(var j=0;j<urlProps.length;++j){urlProp=urlProps[j];if(data.hasOwnProperty(urlProp)){data[urlProp]=truncate(data[urlProp],this._globalOptions.maxUrlLength)}}breadcrumbs.values[i].data=data}},_getHttpData:function(){if(!this._hasNavigator&&!this._hasDocument)return;var httpData={};if(this._hasNavigator&&_navigator.userAgent){httpData.headers={"User-Agent":navigator.userAgent}}if(this._hasDocument){if(_document.location&&_document.location.href){httpData.url=_document.location.href}if(_document.referrer){if(!httpData.headers)httpData.headers={};httpData.headers.Referer=_document.referrer}}return httpData},_resetBackoff:function(){this._backoffDuration=0;this._backoffStart=null},_shouldBackoff:function(){return this._backoffDuration&&now()-this._backoffStart<this._backoffDuration},_isRepeatData:function(current){var last=this._lastData;if(!last||current.message!==last.message||current.culprit!==last.culprit)return false;if(current.stacktrace||last.stacktrace){return isSameStacktrace(current.stacktrace,last.stacktrace)}else if(current.exception||last.exception){return isSameException(current.exception,last.exception)}return true},_setBackoffState:function(request){if(this._shouldBackoff()){return}var status=request.status;if(!(status===400||status===401||status===429))return;var retry;try{retry=request.getResponseHeader("Retry-After");retry=parseInt(retry,10)*1e3}catch(e){}this._backoffDuration=retry?retry:this._backoffDuration*2||1e3;this._backoffStart=now()},_send:function(data){var globalOptions=this._globalOptions;var baseData={project:this._globalProject,logger:globalOptions.logger,platform:"javascript"},httpData=this._getHttpData();if(httpData){baseData.request=httpData}if(data.trimHeadFrames)delete data.trimHeadFrames;data=objectMerge(baseData,data);data.tags=objectMerge(objectMerge({},this._globalContext.tags),data.tags);data.extra=objectMerge(objectMerge({},this._globalContext.extra),data.extra);data.extra["session:duration"]=now()-this._startTime;if(this._breadcrumbs&&this._breadcrumbs.length>0){data.breadcrumbs={values:[].slice.call(this._breadcrumbs,0)}}if(isEmptyObject(data.tags))delete data.tags;if(this._globalContext.user){data.user=this._globalContext.user}if(globalOptions.environment)data.environment=globalOptions.environment;if(globalOptions.release)data.release=globalOptions.release;if(globalOptions.serverName)data.server_name=globalOptions.serverName;if(isFunction(globalOptions.dataCallback)){data=globalOptions.dataCallback(data)||data}if(!data||isEmptyObject(data)){return}if(isFunction(globalOptions.shouldSendCallback)&&!globalOptions.shouldSendCallback(data)){return}if(this._shouldBackoff()){this._logDebug("warn","Raven dropped error due to backoff: ",data);return}if(typeof globalOptions.sampleRate==="number"){if(Math.random()<globalOptions.sampleRate){this._sendProcessedPayload(data)}}else{this._sendProcessedPayload(data)}},_getUuid:function(){return uuid4()},_sendProcessedPayload:function(data,callback){var self=this;var globalOptions=this._globalOptions;if(!this.isSetup())return;this._lastEventId=data.event_id||(data.event_id=this._getUuid());data=this._trimPacket(data);if(!this._globalOptions.allowDuplicates&&this._isRepeatData(data)){this._logDebug("warn","Raven dropped repeat event: ",data);return}this._lastData=data;this._logDebug("debug","Raven about to send:",data);var auth={sentry_version:"7",sentry_client:"raven-js/"+this.VERSION,sentry_key:this._globalKey};if(this._globalSecret){auth.sentry_secret=this._globalSecret}var exception=data.exception&&data.exception.values[0];this.captureBreadcrumb({category:"sentry",message:exception?(exception.type?exception.type+": ":"")+exception.value:data.message,event_id:data.event_id,level:data.level||"error"});var url=this._globalEndpoint;(globalOptions.transport||this._makeRequest).call(this,{url:url,auth:auth,data:data,options:globalOptions,onSuccess:function success(){self._resetBackoff();self._triggerEvent("success",{data:data,src:url});callback&&callback()},onError:function failure(error){self._logDebug("error","Raven transport failed to send: ",error);if(error.request){self._setBackoffState(error.request)}self._triggerEvent("failure",{data:data,src:url});error=error||new Error("Raven send failed (no additional details provided)");callback&&callback(error)}})},_makeRequest:function(opts){var request=new XMLHttpRequest;var hasCORS="withCredentials"in request||typeof XDomainRequest!=="undefined";if(!hasCORS)return;var url=opts.url;if("withCredentials"in request){request.onreadystatechange=function(){if(request.readyState!==4){return}else if(request.status===200){opts.onSuccess&&opts.onSuccess()}else if(opts.onError){var err=new Error("Sentry error code: "+request.status);err.request=request;opts.onError(err)}}}else{request=new XDomainRequest;url=url.replace(/^https?:/,"");if(opts.onSuccess){request.onload=opts.onSuccess}if(opts.onError){request.onerror=function(){var err=new Error("Sentry error code: XDomainRequest");err.request=request;opts.onError(err)}}}request.open("POST",url+"?"+urlencode(opts.auth));request.send(stringify(opts.data))},_logDebug:function(level){if(this._originalConsoleMethods[level]&&this.debug){Function.prototype.apply.call(this._originalConsoleMethods[level],this._originalConsole,[].slice.call(arguments,1))}},_mergeContext:function(key,context){if(isUndefined(context)){delete this._globalContext[key]}else{this._globalContext[key]=objectMerge(this._globalContext[key]||{},context)}}};var objectPrototype=Object.prototype;function isUndefined(what){return what===void 0}function isFunction(what){return typeof what==="function"}function isString(what){return objectPrototype.toString.call(what)==="[object String]"}function isEmptyObject(what){for(var _ in what)return false;return true}function each(obj,callback){var i,j;if(isUndefined(obj.length)){for(i in obj){if(hasKey(obj,i)){callback.call(null,i,obj[i])}}}else{j=obj.length;if(j){for(i=0;i<j;i++){callback.call(null,i,obj[i])}}}}function objectMerge(obj1,obj2){if(!obj2){return obj1}each(obj2,function(key,value){obj1[key]=value});return obj1}function objectFrozen(obj){if(!Object.isFrozen){return false}return Object.isFrozen(obj)}function truncate(str,max){return!max||str.length<=max?str:str.substr(0,max)+"…"}function hasKey(object,key){return objectPrototype.hasOwnProperty.call(object,key)}function joinRegExp(patterns){var sources=[],i=0,len=patterns.length,pattern;for(;i<len;i++){pattern=patterns[i];if(isString(pattern)){sources.push(pattern.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"))}else if(pattern&&pattern.source){sources.push(pattern.source)}}return new RegExp(sources.join("|"),"i")}function urlencode(o){var pairs=[];each(o,function(key,value){pairs.push(encodeURIComponent(key)+"="+encodeURIComponent(value))});return pairs.join("&")}function parseUrl(url){var match=url.match(/^(([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!match)return{};var query=match[6]||"";var fragment=match[8]||"";return{protocol:match[2],host:match[4],path:match[5],relative:match[5]+query+fragment}}function uuid4(){var crypto=_window.crypto||_window.msCrypto;if(!isUndefined(crypto)&&crypto.getRandomValues){var arr=new Uint16Array(8);crypto.getRandomValues(arr);arr[3]=arr[3]&4095|16384;arr[4]=arr[4]&16383|32768;var pad=function(num){var v=num.toString(16);while(v.length<4){v="0"+v}return v};return pad(arr[0])+pad(arr[1])+pad(arr[2])+pad(arr[3])+pad(arr[4])+pad(arr[5])+pad(arr[6])+pad(arr[7])}else{return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0,v=c==="x"?r:r&3|8;return v.toString(16)})}}function htmlTreeAsString(elem){var MAX_TRAVERSE_HEIGHT=5,MAX_OUTPUT_LEN=80,out=[],height=0,len=0,separator=" > ",sepLength=separator.length,nextStr;while(elem&&height++<MAX_TRAVERSE_HEIGHT){nextStr=htmlElementAsString(elem);if(nextStr==="html"||height>1&&len+out.length*sepLength+nextStr.length>=MAX_OUTPUT_LEN){break}out.push(nextStr);len+=nextStr.length;elem=elem.parentNode}return out.reverse().join(separator)}function htmlElementAsString(elem){var out=[],className,classes,key,attr,i;if(!elem||!elem.tagName){return""}out.push(elem.tagName.toLowerCase());if(elem.id){out.push("#"+elem.id)}className=elem.className;if(className&&isString(className)){classes=className.split(/\s+/);for(i=0;i<classes.length;i++){out.push("."+classes[i])}}var attrWhitelist=["type","name","title","alt"];for(i=0;i<attrWhitelist.length;i++){key=attrWhitelist[i];attr=elem.getAttribute(key);if(attr){out.push("["+key+'="'+attr+'"]')}}return out.join("")}function isOnlyOneTruthy(a,b){return!!(!!a^!!b)}function isSameException(ex1,ex2){if(isOnlyOneTruthy(ex1,ex2))return false;ex1=ex1.values[0];ex2=ex2.values[0];if(ex1.type!==ex2.type||ex1.value!==ex2.value)return false;return isSameStacktrace(ex1.stacktrace,ex2.stacktrace)}function isSameStacktrace(stack1,stack2){if(isOnlyOneTruthy(stack1,stack2))return false;var frames1=stack1.frames;var frames2=stack2.frames;if(frames1.length!==frames2.length)return false;var a,b;for(var i=0;i<frames1.length;i++){a=frames1[i];b=frames2[i];if(a.filename!==b.filename||a.lineno!==b.lineno||a.colno!==b.colno||a["function"]!==b["function"])return false}return true}function fill(obj,name,replacement,track){var orig=obj[name];obj[name]=replacement(orig);if(track){track.push([obj,name,orig])}}if(typeof __DEV__!=="undefined"&&__DEV__){Raven.utils={isUndefined:isUndefined,isFunction:isFunction,isString:isString,isObject:isObject,isEmptyObject:isEmptyObject,isError:isError,each:each,objectMerge:objectMerge,truncate:truncate,hasKey:hasKey,joinRegExp:joinRegExp,urlencode:urlencode,uuid4:uuid4,htmlTreeAsString:htmlTreeAsString,htmlElementAsString:htmlElementAsString,parseUrl:parseUrl,fill:fill}}Raven.prototype.setUser=Raven.prototype.setUserContext;Raven.prototype.setReleaseContext=Raven.prototype.setRelease;module.exports=Raven}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){(function(global){"use strict";var utils=__webpack_require__(20);var TraceKit={collectWindowErrors:true,debug:false};var _window=typeof window!=="undefined"?window:typeof global!=="undefined"?global:typeof self!=="undefined"?self:{};var _slice=[].slice;var UNKNOWN_FUNCTION="?";var ERROR_TYPES_RE=/^(?:[Uu]ncaught (?:exception: )?)?(?:((?:Eval|Internal|Range|Reference|Syntax|Type|URI|)Error): )?(.*)$/;function getLocationHref(){if(typeof document==="undefined"||typeof document.location==="undefined")return"";return document.location.href}TraceKit.report=function reportModuleWrapper(){var handlers=[],lastArgs=null,lastException=null,lastExceptionStack=null;function subscribe(handler){installGlobalHandler();handlers.push(handler)}function unsubscribe(handler){for(var i=handlers.length-1;i>=0;--i){if(handlers[i]===handler){handlers.splice(i,1)}}}function unsubscribeAll(){uninstallGlobalHandler();handlers=[]}function notifyHandlers(stack,isWindowError){var exception=null;if(isWindowError&&!TraceKit.collectWindowErrors){return}for(var i in handlers){if(handlers.hasOwnProperty(i)){try{handlers[i].apply(null,[stack].concat(_slice.call(arguments,2)))}catch(inner){exception=inner}}}if(exception){throw exception}}var _oldOnerrorHandler,_onErrorHandlerInstalled;function traceKitWindowOnError(message,url,lineNo,colNo,ex){var stack=null;if(lastExceptionStack){TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack,url,lineNo,message);processLastException()}else if(ex&&utils.isError(ex)){stack=TraceKit.computeStackTrace(ex);notifyHandlers(stack,true)}else{var location={url:url,line:lineNo,column:colNo};var name=undefined;var msg=message;var groups;if({}.toString.call(message)==="[object String]"){var groups=message.match(ERROR_TYPES_RE);if(groups){name=groups[1];msg=groups[2]}}location.func=UNKNOWN_FUNCTION;stack={name:name,message:msg,url:getLocationHref(),stack:[location]};notifyHandlers(stack,true)}if(_oldOnerrorHandler){return _oldOnerrorHandler.apply(this,arguments)}return false}function installGlobalHandler(){if(_onErrorHandlerInstalled){return}_oldOnerrorHandler=_window.onerror;_window.onerror=traceKitWindowOnError;_onErrorHandlerInstalled=true}function uninstallGlobalHandler(){if(!_onErrorHandlerInstalled){return}_window.onerror=_oldOnerrorHandler;_onErrorHandlerInstalled=false;_oldOnerrorHandler=undefined}function processLastException(){var _lastExceptionStack=lastExceptionStack,_lastArgs=lastArgs;lastArgs=null;lastExceptionStack=null;lastException=null;notifyHandlers.apply(null,[_lastExceptionStack,false].concat(_lastArgs))}function report(ex,rethrow){var args=_slice.call(arguments,1);if(lastExceptionStack){if(lastException===ex){return}else{processLastException()}}var stack=TraceKit.computeStackTrace(ex);lastExceptionStack=stack;lastException=ex;lastArgs=args;setTimeout(function(){if(lastException===ex){processLastException()}},stack.incomplete?2e3:0);if(rethrow!==false){throw ex}}report.subscribe=subscribe;report.unsubscribe=unsubscribe;report.uninstall=unsubscribeAll;return report}();TraceKit.computeStackTrace=function computeStackTraceWrapper(){function computeStackTraceFromStackProp(ex){if(typeof ex.stack==="undefined"||!ex.stack)return;var chrome=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval|webpack|<anonymous>|\/).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,gecko=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|webpack|resource|\[native).*?)(?::(\d+))?(?::(\d+))?\s*$/i,winjs=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:file|ms-appx|https?|webpack|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,geckoEval=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,chromeEval=/\((\S*)(?::(\d+))(?::(\d+))\)/,lines=ex.stack.split("\n"),stack=[],submatch,parts,element,reference=/^(.*) is undefined$/.exec(ex.message);for(var i=0,j=lines.length;i<j;++i){if(parts=chrome.exec(lines[i])){var isNative=parts[2]&&parts[2].indexOf("native")===0;var isEval=parts[2]&&parts[2].indexOf("eval")===0;if(isEval&&(submatch=chromeEval.exec(parts[2]))){parts[2]=submatch[1];parts[3]=submatch[2];parts[4]=submatch[3]}element={url:!isNative?parts[2]:null,func:parts[1]||UNKNOWN_FUNCTION,args:isNative?[parts[2]]:[],line:parts[3]?+parts[3]:null,column:parts[4]?+parts[4]:null}}else if(parts=winjs.exec(lines[i])){element={url:parts[2],func:parts[1]||UNKNOWN_FUNCTION,args:[],line:+parts[3],column:parts[4]?+parts[4]:null}}else if(parts=gecko.exec(lines[i])){var isEval=parts[3]&&parts[3].indexOf(" > eval")>-1;if(isEval&&(submatch=geckoEval.exec(parts[3]))){parts[3]=submatch[1];parts[4]=submatch[2];parts[5]=null}else if(i===0&&!parts[5]&&typeof ex.columnNumber!=="undefined"){stack[0].column=ex.columnNumber+1}element={url:parts[3],func:parts[1]||UNKNOWN_FUNCTION,args:parts[2]?parts[2].split(","):[],line:parts[4]?+parts[4]:null,column:parts[5]?+parts[5]:null}}else{continue}if(!element.func&&element.line){element.func=UNKNOWN_FUNCTION}stack.push(element)}if(!stack.length){return null}return{name:ex.name,message:ex.message,url:getLocationHref(),stack:stack}}function augmentStackTraceWithInitialElement(stackInfo,url,lineNo,message){var initial={url:url,line:lineNo};if(initial.url&&initial.line){stackInfo.incomplete=false;if(!initial.func){initial.func=UNKNOWN_FUNCTION}if(stackInfo.stack.length>0){if(stackInfo.stack[0].url===initial.url){if(stackInfo.stack[0].line===initial.line){return false}else if(!stackInfo.stack[0].line&&stackInfo.stack[0].func===initial.func){stackInfo.stack[0].line=initial.line;return false}}}stackInfo.stack.unshift(initial);stackInfo.partial=true;return true}else{stackInfo.incomplete=true}return false}function computeStackTraceByWalkingCallerChain(ex,depth){var functionName=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,stack=[],funcs={},recursion=false,parts,item,source;for(var curr=computeStackTraceByWalkingCallerChain.caller;curr&&!recursion;curr=curr.caller){if(curr===computeStackTrace||curr===TraceKit.report){continue}item={url:null,func:UNKNOWN_FUNCTION,line:null,column:null};if(curr.name){item.func=curr.name}else if(parts=functionName.exec(curr.toString())){item.func=parts[1]}if(typeof item.func==="undefined"){try{item.func=parts.input.substring(0,parts.input.indexOf("{"))}catch(e){}}if(funcs[""+curr]){recursion=true}else{funcs[""+curr]=true}stack.push(item)}if(depth){stack.splice(0,depth)}var result={name:ex.name,message:ex.message,url:getLocationHref(),stack:stack};augmentStackTraceWithInitialElement(result,ex.sourceURL||ex.fileName,ex.line||ex.lineNumber,ex.message||ex.description);return result}function computeStackTrace(ex,depth){var stack=null;depth=depth==null?0:+depth;try{stack=computeStackTraceFromStackProp(ex);if(stack){return stack}}catch(e){if(TraceKit.debug){throw e}}try{stack=computeStackTraceByWalkingCallerChain(ex,depth+1);if(stack){return stack}}catch(e){if(TraceKit.debug){throw e}}return{name:ex.name,message:ex.message,url:getLocationHref()}}computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement;computeStackTrace.computeStackTraceFromStackProp=computeStackTraceFromStackProp;return computeStackTrace}();module.exports=TraceKit}).call(exports,function(){return this}())},function(module,exports){"use strict";function isObject(what){return typeof what==="object"&&what!==null}function isError(value){switch({}.toString.call(value)){case"[object Error]":return true;case"[object Exception]":return true;case"[object DOMException]":return true;default:return value instanceof Error}}function wrappedCallback(callback){function dataCallback(data,original){var normalizedData=callback(data)||data;if(original){return original(normalizedData)||normalizedData}return normalizedData}return dataCallback}module.exports={isObject:isObject,isError:isError,wrappedCallback:wrappedCallback}},function(module,exports){"use strict";exports=module.exports=stringify;exports.getSerialize=serializer;function indexOf(haystack,needle){for(var i=0;i<haystack.length;++i){if(haystack[i]===needle)return i}return-1}function stringify(obj,replacer,spaces,cycleReplacer){return JSON.stringify(obj,serializer(replacer,cycleReplacer),spaces)}function serializer(replacer,cycleReplacer){var stack=[],keys=[];if(cycleReplacer==null)cycleReplacer=function(key,value){if(stack[0]===value)return"[Circular ~]";return"[Circular ~."+keys.slice(0,indexOf(stack,value)).join(".")+"]"};return function(key,value){if(stack.length>0){var thisPos=indexOf(stack,this);~thisPos?stack.splice(thisPos+1):stack.push(this);~thisPos?keys.splice(thisPos,Infinity,key):keys.push(key);if(~indexOf(stack,value))value=cycleReplacer.call(this,key,value)}else stack.push(value);return replacer==null?value:replacer.call(this,key,value)}}},function(module,exports){"use strict";function RavenConfigError(message){this.name="RavenConfigError";this.message=message}RavenConfigError.prototype=new Error;RavenConfigError.prototype.constructor=RavenConfigError;module.exports=RavenConfigError},function(module,exports){"use strict";var wrapMethod=function(console,level,callback){var originalConsoleLevel=console[level];var originalConsole=console;if(!(level in console)){return}var sentryLevel=level==="warn"?"warning":level;console[level]=function(){var args=[].slice.call(arguments);var msg=""+args.join(" ");var data={level:sentryLevel,logger:"console",extra:{arguments:args}};callback&&callback(msg,data);if(originalConsoleLevel){Function.prototype.apply.call(originalConsoleLevel,originalConsole,args)}}};module.exports={wrapMethod:wrapMethod}},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _states=__webpack_require__(3);var _states2=_interopRequireDefault(_states);var _errors=__webpack_require__(16);var _services=__webpack_require__(7);var _services2=_interopRequireDefault(_services);var _BaseUploader2=__webpack_require__(25);var _BaseUploader3=_interopRequireDefault(_BaseUploader2);var _ravenJs=__webpack_require__(17);var _ravenJs2=_interopRequireDefault(_ravenJs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var MAX_CLIENT_RANGE_REQUESTS=2;var MAX_RANGE_REQUESTS=4;var MAX_BACKOFF_ATTEMPTS=6;var GCSUploader=function(_BaseUploader){_inherits(GCSUploader,_BaseUploader);function GCSUploader(config,endpoint,file,mime_type){var logger=arguments.length>4&&arguments[4]!==undefined?arguments[4]:window.console;var jwtToken=arguments[5];_classCallCheck(this,GCSUploader);var _this=_possibleConstructorReturn(this,(GCSUploader.__proto__||Object.getPrototypeOf(GCSUploader)).call(this,config,endpoint,file,logger));_this.mime_type=mime_type;_this.resumed_bytes=0;var bucket_match=endpoint.match(/v1\/b\/([a-z,-]*)\//);if(bucket_match&&bucket_match.length>0){_this.bucket=bucket_match.pop()}if(typeof _this.bucket==="undefined"){bucket_match=endpoint.match("com/([a-z,-]*)/")
;if(bucket_match&&bucket_match.length>0){_this.bucket=bucket_match.pop()}}var upload_id_match=endpoint.match(/upload_id=([^&]*)/);if(upload_id_match&&upload_id_match.length>0){_this.upload_id=upload_id_match.pop()}if(jwtToken===undefined){_this.jwtToken=config.leatherback.token}else{_this.jwtToken=jwtToken}return _this}_createClass(GCSUploader,[{key:"_bindMethods",value:function _bindMethods(){this._abortRequests=this._abortRequests.bind(this);this._getRange=this._getRange.bind(this);this._getRangeServerSide=this._getRangeServerSide.bind(this);this._makeUploadRequest=this._makeUploadRequest.bind(this);this._onRequestReject=this._onRequestReject.bind(this);this._onRequestResolve=this._onRequestResolve.bind(this);this._parseHeadersForRange=this._parseHeadersForRange.bind(this);this._parseRangeHeader=this._parseRangeHeader.bind(this);_get(GCSUploader.prototype.__proto__||Object.getPrototypeOf(GCSUploader.prototype),"_bindMethods",this).call(this)}},{key:"_abortRequests",value:function _abortRequests(){var logger=this.logger,_xhr=this._xhr,backoff_timeout=this.backoff_timeout;if(!_xhr){logger.info("[GCSUploader] no xhr to cancel: "+_xhr);return}_xhr.abort();clearTimeout(backoff_timeout);this.backoff_count=0}},{key:"_parseRangeHeader",value:function _parseRangeHeader(header){var logger=this.logger;if(typeof header!=="string"){logger.warn("[GCSUploader] _parseRangeHeader empty header: "+header);return false}var _header$split=header.split("-"),_header$split2=_slicedToArray(_header$split,2),start=_header$split2[0],finish=_header$split2[1];logger.info("[GCSUploader] _parseRangeHeader: "+start+" -> "+finish);var bytes_uploaded=parseInt(finish,10);if(isNaN(bytes_uploaded)){logger.warn("[GCSUploader] _parseRangeHeader: finish isn't a number: "+bytes_uploaded);return false}return bytes_uploaded}},{key:"_parseHeadersForRange",value:function _parseHeadersForRange(){var logger=this.logger,_xhr=this._xhr,_parseRangeHeader=this._parseRangeHeader;logger.info("[GCSUploader] "+_xhr.status+": "+_xhr.statusText);try{var headers=_xhr.getAllResponseHeaders();if(/^Range:/im.test(headers)){var range_header=_xhr.getResponseHeader("Range");return _parseRangeHeader(range_header)}logger.info("[GCSUploader] _parseHeadersForRange: No range header");logger.info(_xhr.getAllResponseHeaders())}catch(error){logger.info("[GCSUploader] _parseHeadersForRange getAllResponseHeaders: "+error)}try{var _range_header=_xhr.getResponseHeader("Range");return _parseRangeHeader(_range_header)}catch(error){logger.info("[GCSUploader] _parseHeadersForRange getResponseHeader: "+error)}try{var _headers=_xhr.getAllResponseHeaders();logger.info("[GCSUploader] _parseHeadersForRange No range header: "+_headers)}catch(error){logger.info("[GCSUploader] _parseHeadersForRange final fail: "+error)}return false}},{key:"_onRequestReject",value:function _onRequestReject(error){var logger=this.logger,_xhr=this._xhr;if(error&&(typeof error==="undefined"?"undefined":_typeof(error))==="object"&&"target"in error&&error.target instanceof XMLHttpRequest){logger.warn("[GCSUploader] _onUploaderFail: XHR Failed");logger.warn("[GCSUploader] _onUploaderFail: Status: "+error.target.status+" "+error.target.statusText+" - Response text: "+error.target.responseText);_ravenJs2.default.captureMessage("[GCSUploader] _onUploaderFail: Status: "+error.target.status+" "+error.target.statusText+" - Response text: "+error.target.responseText,{level:"warning"})}else{logger.error("[GCSUploader] _onUploaderFail: ~XHR error - "+error);_ravenJs2.default.captureMessage("[GCSUploader] _onUploaderFail: ~XHR error - "+error,{level:"error"})}if(error instanceof Error){return this.fail(error)}if(_errors.FATAL_ERRORS.indexOf(error)!==-1||!_xhr){return this.fail(error)}if("status"in _xhr&&_xhr.status===404){return this.fail(_errors.ERRORS.INVALID_UPLOAD_ENDPOINT)}return this._retryWithBackoff()}},{key:"_onUploadProgress",value:function _onUploadProgress(event){var resumed_bytes=this.resumed_bytes;var loaded=resumed_bytes+event.loaded;return _get(GCSUploader.prototype.__proto__||Object.getPrototypeOf(GCSUploader.prototype),"_onUploadProgress",this).call(this,{loaded:loaded})}},{key:"_makeRequest",value:function _makeRequest(range,type,file_chunk){var _this2=this;var endpoint=this.endpoint,_onUploadProgress=this._onUploadProgress,_xhr=this._xhr;if(_xhr instanceof XMLHttpRequest&&(_xhr.readyState===2||_xhr.readyState===3)){_xhr.abort()}return new Promise(function(resolve,reject){if(_this2.error){reject(_this2.error)}_this2._xhr=new XMLHttpRequest;_this2._xhr.open("PUT",endpoint,true);_this2._xhr.setRequestHeader("Content-Type",type);_this2._xhr.setRequestHeader("Content-Range",range);_this2._xhr.setRequestHeader("X-GUploader-No-308","yes");_this2._xhr.addEventListener("load",resolve);_this2._xhr.addEventListener("error",reject);_this2._xhr.addEventListener("timeout",reject);if(file_chunk!==undefined){_this2._xhr.upload.addEventListener("progress",_onUploadProgress)}_this2._xhr.send(file_chunk)})}},{key:"_getRange",value:function _getRange(){var file=this.file,logger=this.logger;logger.info("[GCSUploader] _getRange");var range="bytes */"+file.size;return this._makeRequest(range,"application/octet-stream")}},{key:"_makeUploadRequest",value:function _makeUploadRequest(){var start_byte=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var logger=this.logger,file=this.file,slice_method=this.slice_method,mime_type=this.mime_type;var max_request_chunk_size=this.config.max_request_chunk_size;this.state=_states2.default.UPLOADING;var end_byte=file.size;var file_chunk=file;if(slice_method===false){start_byte=0;this.bytes_uploaded=0}else{end_byte=Math.min(start_byte+max_request_chunk_size,file.size);file_chunk=file[slice_method](start_byte,end_byte)}if(end_byte===0){logger.info("User has probably deleted the file");return Promise.reject(_errors.ERRORS.VIDEO_FILE_REMOVED)}end_byte-=1;logger.info("[GCSUploader] _makeUploadRequest: "+start_byte+" -> "+end_byte);var range="bytes "+start_byte+"-"+end_byte+"/"+file.size;return this._makeRequest(range,mime_type,file_chunk)}},{key:"_getRangeServerSide",value:function _getRangeServerSide(){var _this3=this;var upload_id=this.upload_id,attempt_id=this.attempt_id,logger=this.logger,config=this.config,bucket=this.bucket;var url="/upload/_range?attempt_id="+attempt_id;if(config.service===_services2.default.UPLOAD_SERVICE_LEATHERBACK){url=config.leatherback.url+"/attempt/range?bucket="+bucket+"&upload_id="+upload_id}logger.info("[GCSUploader] _getRangeServerSide");return new Promise(function(resolve,reject){_this3._xhr=new XMLHttpRequest;_this3._xhr.open("GET",url);if(config.service===_services2.default.UPLOAD_SERVICE_SITE){_this3._xhr.setRequestHeader("X-Requested-With","XMLHttpRequest")}if(config.service===_services2.default.UPLOAD_SERVICE_LEATHERBACK){_this3._xhr.setRequestHeader("Authorization","Bearer "+_this3.jwtToken)}_this3._xhr.addEventListener("load",resolve);_this3._xhr.addEventListener("error",reject);_this3._xhr.addEventListener("timeout",reject);_this3._xhr.send()})}},{key:"_onRequestResolve",value:function _onRequestResolve(event){var logger=this.logger,_xhr=this._xhr,_complete=this._complete,_makeUploadRequest=this._makeUploadRequest,_parseHeadersForRange=this._parseHeadersForRange,_onRequestResolve=this._onRequestResolve,_onRequestReject=this._onRequestReject;var incompleteUpload=_xhr.getResponseHeader("X-HTTP-Status-Code-Override")==="308"||_xhr.status===308;logger.info("[GCSUploader] _onRequestResolve: "+_xhr.status);logger.info("[GCSUploader] _onRequestResolve: Incomplete Upload? "+incompleteUpload);if(_xhr.status===200&&!incompleteUpload){logger.info("[GCSUploader] Upload complete: "+_xhr.status);return _complete()}if(!incompleteUpload){logger.warn("[GCSUploader] Bad GCS response: "+_xhr.status);if(this.state===_states2.default.RESUMING){return Promise.reject(_errors.ERRORS.RANGE_RESUME_FAILED)}return Promise.reject(_errors.ERRORS.RANGE_FAILED)}var range=_parseHeadersForRange();if(range===false){if(this.state===_states2.default.RESUMING){return Promise.reject(_errors.ERRORS.RANGE_RESUME_FAILED)}return Promise.reject(_errors.ERRORS.RANGE_FAILED)}this.backoff_count=0;this.bytes_uploaded=range;this.resumed_bytes=range;return _makeUploadRequest(range+1).then(_onRequestResolve).catch(_onRequestReject)}},{key:"_retryWithBackoff",value:function _retryWithBackoff(){var logger=this.logger,_getRange=this._getRange,_getRangeServerSide=this._getRangeServerSide,_makeUploadRequest=this._makeUploadRequest,_onRequestResolve=this._onRequestResolve,_onRequestReject=this._onRequestReject;this.backoff_count++;if(this.backoff_count>MAX_BACKOFF_ATTEMPTS){logger.info("[GCSUploader] Exceeded retries, failing upload attempt");return this.fail(_errors.ERRORS.RETRY_FAILED)}var next_request=_getRange;if(this.backoff_count>MAX_CLIENT_RANGE_REQUESTS&&this.backoff_count<=MAX_RANGE_REQUESTS){logger.info("[GCSUploader] Exceeded client range retries, trying server side");next_request=_getRangeServerSide}if(this.backoff_count>MAX_RANGE_REQUESTS){logger.info("[GCSUploader] Exceeded range retries, restarting upload");this.state=_states2.default.REROUTING;next_request=_makeUploadRequest}var delay=Math.pow(2,this.backoff_count)*1e3+Math.round(Math.random()*1e3);logger.info("[GCSUploader] retry #"+this.backoff_count+" after "+delay+"ms");this.backoff_timeout=setTimeout(function(){next_request().then(_onRequestResolve).catch(_onRequestReject)},delay);return this.backoff_timeout}},{key:"upload",value:function upload(){var _onRequestResolve=this._onRequestResolve,_onRequestReject=this._onRequestReject;_get(GCSUploader.prototype.__proto__||Object.getPrototypeOf(GCSUploader.prototype),"upload",this).call(this);this._makeUploadRequest().then(_onRequestResolve).catch(_onRequestReject)}},{key:"pause",value:function pause(){this._abortRequests();_get(GCSUploader.prototype.__proto__||Object.getPrototypeOf(GCSUploader.prototype),"pause",this).call(this)}},{key:"resume",value:function resume(){var _onRequestResolve=this._onRequestResolve,_onRequestReject=this._onRequestReject;_get(GCSUploader.prototype.__proto__||Object.getPrototypeOf(GCSUploader.prototype),"resume",this).call(this);this._getRange().then(_onRequestResolve).catch(_onRequestReject)}},{key:"fail",value:function fail(error){_get(GCSUploader.prototype.__proto__||Object.getPrototypeOf(GCSUploader.prototype),"fail",this).call(this,error);this._abortRequests()}},{key:"cancel",value:function cancel(){this._abortRequests();_get(GCSUploader.prototype.__proto__||Object.getPrototypeOf(GCSUploader.prototype),"cancel",this).call(this)}}]);return GCSUploader}(_BaseUploader3.default);exports.default=GCSUploader},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _events=__webpack_require__(13);var _events2=_interopRequireDefault(_events);var _states=__webpack_require__(3);var _states2=_interopRequireDefault(_states);var _events3=__webpack_require__(5);var _events4=_interopRequireDefault(_events3);var _Utilities=__webpack_require__(15);var _ravenJs=__webpack_require__(17);var _ravenJs2=_interopRequireDefault(_ravenJs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var PROGRESS_INTERVAL=200;var BaseUploader=function(_EventEmitter){_inherits(BaseUploader,_EventEmitter);function BaseUploader(config,endpoint,file){var logger=arguments.length>3&&arguments[3]!==undefined?arguments[3]:window.console;_classCallCheck(this,BaseUploader);var _this=_possibleConstructorReturn(this,(BaseUploader.__proto__||Object.getPrototypeOf(BaseUploader)).call(this));if(!config){throw new Error("BaseUploader needs a config")}if(!endpoint){throw new Error("BaseUploader needs an endpoint")}if(!file){throw new Error("BaseUploader needs a file")}_this.config=config;_this.endpoint=endpoint;_this.file=file;_this.logger=logger;_this.APP_ID=3;_this.backoff_count=0;_this.backoff_timeout=null;_this.bytes_uploaded=0;_this.started_on=new Date;_this.last_progress_dispatch=null;_this.slice_method=(0,_Utilities.getSliceMethod)();_this._bindMethods();return _this}_createClass(BaseUploader,[{key:"_onUploadProgress",value:function _onUploadProgress(event){var last_progress_dispatch=this.last_progress_dispatch;var now=window.performance.now();this.bytes_uploaded=event.loaded;last_progress_dispatch=last_progress_dispatch||0;if(now-last_progress_dispatch<PROGRESS_INTERVAL){return}this.last_progress_dispatch=now;this.emit(_events4.default.PROGRESS,{loaded:event.loaded})}},{key:"_bindMethods",value:function _bindMethods(){this._complete=this._complete.bind(this);this._onUploadProgress=this._onUploadProgress.bind(this)}},{key:"_complete",value:function _complete(event){this.bytes_uploaded=this.file.size;this.state=_states2.default.COMPLETED;this.removeAllListeners()}},{key:"upload",value:function upload(){}},{key:"pause",value:function pause(){}},{key:"resume",value:function resume(){this.state=_states2.default.RESUMING}},{key:"cancel",value:function cancel(){this.removeAllListeners()}},{key:"fail",value:function fail(error){var logger=this.logger;logger.error("[BaseUploader] fail: "+error.toString());_ravenJs2.default.captureMessage("[BaseUploader] fail: "+error.toString());this.error=error;this.state=_states2.default.FAILED;this.removeAllListeners()}},{key:"state",get:function get(){return this._state},set:function set(state){if(state===undefined||this._state===state){return}if(Object.keys(_states2.default).indexOf(state)===-1){throw new Error("Invalid state set for Upload: "+state)}this._state=state;this.emit(_events4.default.STATE_CHANGE,{state:state,uploader:this})}}]);return BaseUploader}(_events2.default);exports.default=BaseUploader},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _errors=__webpack_require__(16);var _Utilities=__webpack_require__(15);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var VideoValidator=function(){function VideoValidator(endpoint){var logger=arguments.length>1&&arguments[1]!==undefined?arguments[1]:window.console;_classCallCheck(this,VideoValidator);if(typeof endpoint!=="string"){throw new Error("Invalid endpoint passed to VideoValidator")}this.endpoint=endpoint;this.chunk_size=512;this.logger=logger;this._onResolve=this._onResolve.bind(this)}_createClass(VideoValidator,[{key:"_onResolve",value:function _onResolve(event){var logger=this.logger;var xhr=event.target;if(xhr.status!==200){logger.info("[VideoValidator] _onResolve status: "+xhr.status);logger.info("[VideoValidator] _onResolve response: "+xhr.responseText);return Promise.reject(_errors.ERRORS.VALIDATOR_CALL_ERROR)}var response=void 0;try{response=JSON.parse(xhr.responseText)}catch(e){logger.info("[VideoValidator] _onResolve: Failed to parse xhr.responseText - "+xhr.responseText);return Promise.reject(e)}logger.addLabel("file_type",response.ContentType);if(/^video\/+(.)|application\/(octet-stream|ogg|x-shockwave-flash)/.test(response.ContentType)){return Promise.resolve(response.ContentType)}return Promise.reject(_errors.ERRORS.VIDEO_FILE_INVALID)}},{key:"validateFile",value:function validateFile(file){var endpoint=this.endpoint,slice_method=this.slice_method,chunk_size=this.chunk_size,_onResolve=this._onResolve;if(slice_method===false){return Promise.resolve(file.type)}var options={method:"PUT",body:file[slice_method](0,chunk_size)};var requestWithRetry=(0,_Utilities.retryFunctionOnReject)(_Utilities.request,2);return requestWithRetry(endpoint,options).then(_onResolve)}},{key:"validateUrl",value:function validateUrl(url){var endpoint=this.endpoint,_onResolve=this._onResolve;var requestWithRetry=(0,_Utilities.retryFunctionOnReject)(_Utilities.request,2);return requestWithRetry(endpoint+"?url="+url).then(_onResolve)}},{key:"slice_method",get:function get(){if(!("Blob"in window)){return false}if(this._slice_method){return this._slice_method}var blob=void 0;try{blob=new Blob}catch(error){window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if(!window.BlobBuilder){this._slice_method=false;return this._slice_method}if(error.name==="TypeError"&&window.BlobBuilder){var bb=new window.BlobBuilder;blob=bb.getBlob()}}if("slice"in blob){this._slice_method="slice"}else if("mozSlice"in blob){this._slice_method="mozSlice"}else if("webkitSlice"in blob){this._slice_method="webkitSlice"}return this._slice_method},set:function set(method){this._slice_method=method}}]);return VideoValidator}();exports.default=VideoValidator},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _Utilities=__webpack_require__(15);var _Utilities2=__webpack_require__(15);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var VimeoApp=function(){function VimeoApp(config){var logger=arguments.length>1&&arguments[1]!==undefined?arguments[1]:window.console;_classCallCheck(this,VimeoApp);if(!config){throw new Error("[VimeoApp] constructor requires a config")}this.config=config;this.logger=logger;this._parseResponse=this._parseResponse.bind(this);this._parseToken=this._parseToken.bind(this)}_createClass(VimeoApp,[{key:"_parseResponse",value:function _parseResponse(event){var logger=this.logger;var _event$target=event.target,status=_event$target.status,responseText=_event$target.responseText;if(status!==200){logger.info("[VimeoApp] _parseResponse "+status+": "+responseText);return Promise.reject(event)}try{var response=JSON.parse(responseText);return Promise.resolve(response)}catch(e){return Promise.reject(e)}}},{key:"_parseToken",value:function _parseToken(event){var logger=this.logger;var _event$target2=event.target,status=_event$target2.status,responseText=_event$target2.responseText;if(status!==200){logger.info("[VimeoApp] _parseResponse "+status+": "+responseText);return Promise.reject(event)}try{var token=event.target.getResponseHeader("Authorization");return Promise.resolve(token)}catch(e){logger.info("[VimeoApp] _parseResponse "+status+": "+responseText);return Promise.reject(e)}}},{key:"_post",value:function _post(url,payload){var token=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var config=this.config;var options={method:"POST",headers:{Accept:"application/json","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8","X-Requested-With":"XMLHttpRequest"},body:(0,_Utilities.serialize)(_extends({},payload,{token:config.xsrft})),withCredentials:true};if(token!==null){options.headers["Authorization"]="Bearer "+token}return(0,_Utilities2.requestWithRetry)(url,options)}},{key:"attach",value:function attach(file_name,file_size,type,region,api_app,content_type,clip_id){return this._post("/upload/_attach",{file_name:file_name,file_size:file_size,type:type,region:region,api_app:api_app,content_type:content_type,clip_id:clip_id}).then(this._parseResponse)}},{key:"pause",value:function pause(attempt_id,upload_type,signature){return this._post("/upload/_pause",{attempt_id:attempt_id,upload_type:upload_type,signature:signature}).then(this._parseResponse)}},{key:"resume",value:function resume(attempt_id,upload_type,signature){return this._post("/upload/_resume",{attempt_id:attempt_id,upload_type:upload_type,signature:signature}).then(this._parseResponse)}},{key:"cancel",value:function cancel(attempt_id,upload_type,signature){return this._post("/upload/_cancel",{attempt_id:attempt_id,upload_type:upload_type,signature:signature}).then(this._parseResponse)}},{key:"complete",value:function complete(attempt_id,video_file_id,upload_type,make_private,file_extension,signature){return this._post("/upload/_complete",{attempt_id:attempt_id,video_file_id:video_file_id,upload_type:upload_type,signature:signature,make_private:make_private===true?true:false,file_extension:file_extension&&file_extension.length<=4?file_extension:""}).then(this._parseResponse)}},{key:"fail",value:function fail(attempt_id,type,signature){return this._post("/upload/_fail",{attempt_id:attempt_id,type:type,signature:signature}).then(this._parseResponse)}},{key:"saveError",value:function saveError(attempt_id,error_code){return this._post("/upload/_save_error",{attempt_id:attempt_id,error_code:error_code}).then(this._parseResponse)}},{key:"getToken",value:function getToken(token){return this._post("/upload/_verify",{},token).then(this._parseToken)}}]);return VimeoApp}();exports.default=VimeoApp},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _states=__webpack_require__(3);var _states2=_interopRequireDefault(_states);var _events=__webpack_require__(5);var _events2=_interopRequireDefault(_events);var _errors=__webpack_require__(16);var _BaseClient2=__webpack_require__(9);var _BaseClient3=_interopRequireDefault(_BaseClient2);var _PullUploader=__webpack_require__(29);var _PullUploader2=_interopRequireDefault(_PullUploader);var _VimeoApp=__webpack_require__(27);var _VimeoApp2=_interopRequireDefault(_VimeoApp);var _ravenJs=__webpack_require__(17);var _ravenJs2=_interopRequireDefault(_ravenJs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var ApiClient=function(_BaseClient){_inherits(ApiClient,_BaseClient);function ApiClient(config,upload_type,api_app,file,clip_id){_classCallCheck(this,ApiClient);var _this=_possibleConstructorReturn(this,(ApiClient.__proto__||Object.getPrototypeOf(ApiClient)).call(this,config,upload_type,api_app,file,clip_id));if(!file.link){throw new Error("ApiClient file object needs a link property")}if(!file.size){throw new Error("ApiClient file object needs a size property")}var _config$api=config.api,url=_config$api.url,tokens=_config$api.tokens;if(!url){throw new Error("[ApiClient] Incorrect config format for vime api")}if(!tokens[api_app]){throw new Error("Token for ApiApp #"+api_app+" must be in config.api.tokens")}_this.api_token=tokens[api_app];_this.endpoint="//"+url+"/me/videos";_this.vimeo_app=new _VimeoApp2.default(config,_this.logger);return _this}_createClass(ApiClient,[{key:"_onUploaderComplete",value:function _onUploaderComplete(){var _uploader=this.uploader,clip_id=_uploader.clip_id,clip_url=_uploader.clip_url;this.clip_id=clip_id;this.clip_url=clip_url;_get(ApiClient.prototype.__proto__||Object.getPrototypeOf(ApiClient.prototype),"_onUploaderComplete",this).call(this)}},{key:"_onUploaderFail",value:function _onUploaderFail(error){var logger=this.logger,attempt_id=this.attempt_id,vimeo_app=this.vimeo_app;logger.warn("[ApiClient] _onUploaderFail "+error.toString());_ravenJs2.default.captureMessage("[ApiClient] _onUploaderFail "+error.toString(),{level:"warning"});_get(ApiClient.prototype.__proto__||Object.getPrototypeOf(ApiClient.prototype),"_onUploaderFail",this).call(this,error);if(!attempt_id){return}if(_errors.IGNORABLE_ERRORS.indexOf(error)>-1){return}if(error in _errors.ERROR_CODES){vimeo_app.saveError(attempt_id,_errors.ERROR_CODES[error])}}},{key:"_bindMethods",value:function _bindMethods(){this._validate=this._validate.bind(this);this._beginUploading=this._beginUploading.bind(this);this._validateResponse=this._validateResponse.bind(this);_get(ApiClient.prototype.__proto__||Object.getPrototypeOf(ApiClient.prototype),"_bindMethods",this).call(this)}},{key:"_validate",value:function _validate(){var _this2=this;var logger=this.logger,file=this.file;this.state=_states2.default.VALIDATING;logger.addLabel("file_link",file.link);return new Promise(function(resolve,reject){_this2._xhr=new XMLHttpRequest;_this2._xhr.open("GET",file.link);if(_typeof(file.headers)==="object"){Object.keys(file.headers).forEach(function(header){_this2._xhr.setRequestHeader(header,file.headers[header])})}_this2._xhr.onreadystatechange=function(){if(_this2._xhr.readyState===XMLHttpRequest.HEADERS_RECEIVED||_this2._xhr.readyState===XMLHttpRequest.READYSTATE_LOADED){var headers={status:_this2._xhr.status,content_type:_this2._xhr.getResponseHeader("Content-Type")};setTimeout(function(){_this2._xhr.abort()},0);resolve(headers)}};_this2._xhr.addEventListener("error",function(){reject(_errors.ERRORS.INVALID_UPLOAD_ENDPOINT)});_this2._xhr.addEventListener("timeout",function(){reject(_errors.ERRORS.INVALID_UPLOAD_ENDPOINT)});_this2._xhr.send()})}},{key:"_beginUploading",value:function _beginUploading(){var file=this.file,logger=this.logger,endpoint=this.endpoint,api_token=this.api_token,config=this.config,_onUploaderProgress=this._onUploaderProgress,_onUploaderStateChange=this._onUploaderStateChange;this.uploader=new _PullUploader2.default(config,endpoint,file,api_token,logger);this.uploader.on(_events2.default.PROGRESS,_onUploaderProgress);this.uploader.on(_events2.default.STATE_CHANGE,_onUploaderStateChange);this.uploader.upload()}},{key:"_validateResponse",value:function _validateResponse(headers){var logger=this.logger;logger.addLabel("file_type",headers.content_type);if(headers.status===429){return Promise.reject(_errors.ERRORS.INVALID_DROPBOX_URL)}if(headers.status!==200){return Promise.reject(_errors.ERRORS.VIDEO_FILE_INVALID)}return Promise.resolve()}},{key:"start",value:function start(){_get(ApiClient.prototype.__proto__||Object.getPrototypeOf(ApiClient.prototype),"start",this).call(this);var _validate=this._validate,_validateResponse=this._validateResponse,_beginUploading=this._beginUploading,_onUploaderFail=this._onUploaderFail;_validate().then(_validateResponse).then(_beginUploading).catch(_onUploaderFail)}},{key:"pause",value:function pause(){this._xhr.abort();_get(ApiClient.prototype.__proto__||Object.getPrototypeOf(ApiClient.prototype),"pause",this).call(this)}},{key:"resume",value:function resume(){_get(ApiClient.prototype.__proto__||Object.getPrototypeOf(ApiClient.prototype),"resume",this).call(this);this.start()}},{key:"fail",value:function fail(error){this.uploader.fail(error)}},{key:"cancel",value:function cancel(){this._xhr.abort();_get(ApiClient.prototype.__proto__||Object.getPrototypeOf(ApiClient.prototype),"cancel",this).call(this)}}]);return ApiClient}(_BaseClient3.default);exports.default=ApiClient},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _states=__webpack_require__(3);var _states2=_interopRequireDefault(_states);var _errors=__webpack_require__(16);var _BaseUploader2=__webpack_require__(25)
;var _BaseUploader3=_interopRequireDefault(_BaseUploader2);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var TWEEN_DURATION=20*1e3;var easeOutSine=function easeOutSine(current_time,start_value,delta_value,duration){return delta_value*Math.sin(current_time/(duration*100)*(Math.PI/2))+start_value};var PullUploader=function(_BaseUploader){_inherits(PullUploader,_BaseUploader);function PullUploader(config,endpoint,file,api_token){var logger=arguments.length>4&&arguments[4]!==undefined?arguments[4]:window.console;_classCallCheck(this,PullUploader);var _this=_possibleConstructorReturn(this,(PullUploader.__proto__||Object.getPrototypeOf(PullUploader)).call(this,config,endpoint,file,logger));if(!api_token){throw new Error("PullUploader needs an api_token")}_this.token=api_token;_this._xhr=null;return _this}_createClass(PullUploader,[{key:"_onRequestReject",value:function _onRequestReject(event){var logger=this.logger;var response=event.target;logger.warn("[PullUpload] _onRequestReject: "+response.status+": "+response.statusText);if(response.status>=500){return this.fail(_errors.ERRORS.DNS_ERROR)}var body=JSON.parse(response.responseText);if("error_code"in body&&body.error_code===_errors.API_ERROR_CODES.INVALID_FILE){return this.fail(_errors.ERRORS.VIDEO_FILE_INVALID)}if("error"in body){return this.fail(body.error)}return this.fail(_errors.ERRORS.PULL_FAILED)}},{key:"_onRequestResolve",value:function _onRequestResolve(event){var logger=this.logger;var response=event.target;var body=JSON.parse(response.responseText);if(response.status!==200||!body.uri){logger.info("[PullUpload] PULL_API_FAILED: "+response.status+": "+response.statusText+" - "+(body.error||response.responseText));return Promise.reject(event)}var uri=body.uri;this.clip_id=parseInt(uri.split("/").pop(),10);this.clip_url="/"+this.clip_id;logger.addLabel("clip_id",this.clip_id);return this._complete()}},{key:"_bindMethods",value:function _bindMethods(){this._abortRequests=this._abortRequests.bind(this);this._dispatchProgressEvent=this._dispatchProgressEvent.bind(this);this._endFakeProgress=this._endFakeProgress.bind(this);this._makeUploadRequest=this._makeUploadRequest.bind(this);this._onRequestReject=this._onRequestReject.bind(this);this._onRequestResolve=this._onRequestResolve.bind(this);this._startFakeProgress=this._startFakeProgress.bind(this);_get(PullUploader.prototype.__proto__||Object.getPrototypeOf(PullUploader.prototype),"_bindMethods",this).call(this)}},{key:"_dispatchProgressEvent",value:function _dispatchProgressEvent(){var bytes_uploaded=this.bytes_uploaded,file=this.file,_onUploadProgress=this._onUploadProgress;var current_time=(new Date).getTime()-this.start;var delta_value=file.size-bytes_uploaded;this.bytes_uploaded=easeOutSine(current_time,bytes_uploaded,delta_value,TWEEN_DURATION);_onUploadProgress({loaded:bytes_uploaded})}},{key:"_startFakeProgress",value:function _startFakeProgress(){this.start=(new Date).getTime();this._progressInterval=setInterval(this._dispatchProgressEvent.bind(this),250)}},{key:"_endFakeProgress",value:function _endFakeProgress(){clearTimeout(this._progressInterval)}},{key:"_makeUploadRequest",value:function _makeUploadRequest(){var _this2=this;var token=this.token,file=this.file,endpoint=this.endpoint;this.state=_states2.default.UPLOADING;this._startFakeProgress();var params={type:"pull",link:file.link,size:file.size};if(file.headers){params.headers=file.headers}if(file.thumbnailLink){params.picture_link=file.thumbnailLink}var headers={Accept:"application/vnd.vimeo.video;version=3.2",Authorization:"Bearer "+token};return new Promise(function(resolve,reject){_this2._xhr=new XMLHttpRequest;_this2._xhr.open("POST",endpoint);_this2._xhr.setRequestHeader("Content-Type","application/json");_this2._xhr.setRequestHeader("Accept",headers.Accept);_this2._xhr.setRequestHeader("Authorization",headers.Authorization);_this2._xhr.addEventListener("load",resolve);_this2._xhr.addEventListener("error",reject);_this2._xhr.addEventListener("timeout",reject);_this2._xhr.send(JSON.stringify(params))})}},{key:"_abortRequests",value:function _abortRequests(){var logger=this.logger;if(!this._xhr){logger.warn("[PullUploader] no xhr to cancel: "+this._xhr);return}this._endFakeProgress();this._xhr.abort()}},{key:"upload",value:function upload(){_get(PullUploader.prototype.__proto__||Object.getPrototypeOf(PullUploader.prototype),"upload",this).call(this);this._makeUploadRequest().then(this._onRequestResolve.bind(this)).catch(this._onRequestReject.bind(this))}},{key:"fail",value:function fail(error){_get(PullUploader.prototype.__proto__||Object.getPrototypeOf(PullUploader.prototype),"fail",this).call(this,error);this._abortRequests()}},{key:"cancel",value:function cancel(){this.removeAllListeners()}}]);return PullUploader}(_BaseUploader3.default);exports.default=PullUploader},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}();var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _get=function get(object,property,receiver){if(object===null)object=Function.prototype;var desc=Object.getOwnPropertyDescriptor(object,property);if(desc===undefined){var parent=Object.getPrototypeOf(object);if(parent===null){return undefined}else{return get(parent,property,receiver)}}else if("value"in desc){return desc.value}else{var getter=desc.get;if(getter===undefined){return undefined}return getter.call(receiver)}};var _events=__webpack_require__(5);var _events2=_interopRequireDefault(_events);var _states=__webpack_require__(3);var _states2=_interopRequireDefault(_states);var _types=__webpack_require__(6);var _types2=_interopRequireDefault(_types);var _BaseClient2=__webpack_require__(9);var _BaseClient3=_interopRequireDefault(_BaseClient2);var _GCSUploader=__webpack_require__(24);var _GCSUploader2=_interopRequireDefault(_GCSUploader);var _VideoValidator=__webpack_require__(26);var _VideoValidator2=_interopRequireDefault(_VideoValidator);var _VimeoApp=__webpack_require__(27);var _VimeoApp2=_interopRequireDefault(_VimeoApp);var _Utilities=__webpack_require__(15);var _ravenJs=__webpack_require__(17);var _ravenJs2=_interopRequireDefault(_ravenJs);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&(typeof call==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass)}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var LeatherbackClient=function(_BaseClient){_inherits(LeatherbackClient,_BaseClient);function LeatherbackClient(config,upload_type,api_app,file,clip_id){_classCallCheck(this,LeatherbackClient);var _this=_possibleConstructorReturn(this,(LeatherbackClient.__proto__||Object.getPrototypeOf(LeatherbackClient)).call(this,config,upload_type,api_app,file,clip_id));if(!config.leatherback){throw new Error("[LeatherbackClient] leatherback data not in the config")}if(upload_type===_types2.default.CLIP_REPLACE&&!clip_id){throw new Error("[LeatherbackClient] Clip replacement upload must provide a clip_id")}_this.uploaders=[];_this.chunk_size=config.default_parallel_chunk_size;_this.clip_id=clip_id?clip_id:null;_this._setFileSizeChangeListener();_this.vimeo_app=new _VimeoApp2.default(config,_this.logger);return _this}_createClass(LeatherbackClient,[{key:"_bindMethods",value:function _bindMethods(){this._create=this._create.bind(this);this._createAndStartUploader=this._createAndStartUploader.bind(this);this._start=this._start.bind(this);this._update=this._update.bind(this);this._validate=this._validate.bind(this);this._setFileSizeChangeListener=this._setFileSizeChangeListener.bind(this);this._startUploader=this._startUploader.bind(this);this._getEndpoints=this._getEndpoints.bind(this);this._getNewToken=this._getNewToken.bind(this);this._createAndStartUploaderWithEndpoints=this._createAndStartUploaderWithEndpoints.bind(this);_get(LeatherbackClient.prototype.__proto__||Object.getPrototypeOf(LeatherbackClient.prototype),"_bindMethods",this).call(this)}},{key:"_validate",value:function _validate(data){var id=this.id,file=this.file,config=this.config,logger=this.logger,_onValidateReject=this._onValidateReject;this.fastest_region=data[0];this.ip=data[1];this.state=_states2.default.VALIDATING;var validator=new _VideoValidator2.default(config.tomdawg.url+"/probe/"+id,logger);return validator.validateFile(file).catch(_onValidateReject)}},{key:"_create",value:function _create(mime_type){var config=this.config,upload_type=this.upload_type,file=this.file,fastest_region=this.fastest_region,logger=this.logger,ip=this.ip;var max_parallel_upload_requests=config.max_parallel_upload_requests;this.state=_states2.default.ATTACHING;if(file.size/this.chunk_size>max_parallel_upload_requests){this.chunk_size=Math.ceil(file.size/max_parallel_upload_requests)}var team_config=window.vimeo.config;var payload={chunk_size:this.chunk_size,region:fastest_region.Region,user_region:config.user_region,clip_id:this.clip_id,browser_info:config.browser_info,vuid:config.vuid,file:{size:file.size,mime_type:file.type,name:file.name},user_ip:ip,upload_type:upload_type,can_upload_as_team_member:team_config.can_upload_as_team_member,team_uploader_accounts:team_config.team_uploader_accounts,current_user:team_config.upload_config.user.id};var url=config.leatherback.url+"/attempt/create";var options={method:"POST",headers:{Authorization:"Bearer "+this.jwtToken,"Content-Type":"application/json"},body:JSON.stringify(payload)};logger.info("[LeatherbackClient] _create: Creating file upload");return(0,_Utilities.requestWithRetry)(url,options)}},{key:"_update",value:function _update(action){var config=this.config,upload_type=this.upload_type,uid=this.uid;if(!uid){return}var payload={clip_id:this.clip_id,upload_type:upload_type};var url=config.leatherback.url+"/attempt/"+action+"/"+uid;var options={method:"PUT",headers:{Authorization:"Bearer "+this.jwtToken,"Content-Type":"application/json"},body:JSON.stringify(payload)};return(0,_Utilities.requestWithRetry)(url,options)}},{key:"_start",value:function _start(event){var _event$target=event.target,status=_event$target.status,responseText=_event$target.responseText;var logger=this.logger,file=this.file;if(status!==200){return Promise.reject(status+": "+responseText)}var response=null;if(responseText.substring(0,4)==="INTL"){var _uid=null;var signed_urls=null;try{response=JSON.parse(responseText.substring(4));logger.info("[LeatherbackClient] Recieved response back from Leatherback.");logger.save();_uid=response.uid;signed_urls=response.signed_urls}catch(e){return Promise.reject(e)}logger.addLabel("uid",_uid);this.uid=_uid;this.signed_urls=signed_urls;logger.info("[LeatherbackClient] _start: Recieved uid "+this.uid+".");var endpoint_count=Object.keys(signed_urls).length;var lb_chunk_size=Math.ceil(file.size/endpoint_count);if(this.chunk_size!==lb_chunk_size){this.chunk_size=lb_chunk_size}logger.info("[LeatherbackClient] _start: Uploading "+this.file.size+" byte file to "+endpoint_count+" signed_url(s)");logger.save();_ravenJs2.default.setExtraContext({"Upload ID":_uid,Response:response});return Object.keys(signed_urls).forEach(this._createAndStartUploader)}try{response=JSON.parse(responseText)}catch(e){return Promise.reject(e)}var _response=response,endpoints=_response.endpoints,uid=_response.uid;logger.addLabel("uid",uid);this.uid=uid;this.endpoints=endpoints;logger.info("[LeatherbackClient] _start: Uploading "+this.file.size+" byte file to "+this.endpoints.length+" endpoints");return Object.keys(endpoints).forEach(this._createAndStartUploaderWithEndpoints)}},{key:"_onUploaderFail",value:function _onUploaderFail(error){var logger=this.logger,uploaders=this.uploaders;if(this.state===_states2.default.FAILED){return}logger.info("[LeatherbackClient] _onUploaderFail: Failing remaining uploads");_get(LeatherbackClient.prototype.__proto__||Object.getPrototypeOf(LeatherbackClient.prototype),"_onUploaderFail",this).call(this,error);this._update("fail");uploaders.forEach(function(upload){upload.fail(error)})}},{key:"_createAndStartUploaderWithEndpoints",value:function _createAndStartUploaderWithEndpoints(storage_path){var endpoints=this.endpoints,file=this.file,logger=this.logger,slice_method=this.slice_method,chunk_size=this.chunk_size,config=this.config,_onUploaderProgress=this._onUploaderProgress,_onUploaderStateChange=this._onUploaderStateChange;var endpoint=endpoints[storage_path];var chunk_name=storage_path.split("/").pop();var _chunk_name$split$map=chunk_name.split("_").map(_Utilities.returnIntegerOrSelf),_chunk_name$split$map2=_slicedToArray(_chunk_name$split$map,3),uid=_chunk_name$split$map2[0],index=_chunk_name$split$map2[1],total_parts=_chunk_name$split$map2[2];this.total_parts=total_parts;var _getChunkRange=(0,_Utilities.getChunkRange)(file.size,chunk_size,index,total_parts),_getChunkRange2=_slicedToArray(_getChunkRange,2),start_byte=_getChunkRange2[0],end_byte=_getChunkRange2[1];logger.info("[LeatherbackClient] _createAndStartUploader for bytes "+start_byte+" to "+end_byte+" (uploader "+index+"/"+total_parts+")");var file_chunk=file[slice_method](start_byte,end_byte);file_chunk.name=chunk_name;file_chunk.uid=uid;var uploader=new _GCSUploader2.default(config,endpoint,file_chunk,file.type,logger,this.jwtToken);uploader.storage_path=storage_path;this.uploaders.push(uploader);uploader.on(_events2.default.PROGRESS,_onUploaderProgress);uploader.on(_events2.default.STATE_CHANGE,_onUploaderStateChange);uploader.upload()}},{key:"_createAndStartUploader",value:function _createAndStartUploader(storage_path){var _this2=this;var signed_urls=this.signed_urls,file=this.file,logger=this.logger,slice_method=this.slice_method,chunk_size=this.chunk_size;var signed_url=signed_urls[storage_path];var chunk_name=storage_path.split("/").pop();var _chunk_name$split$map3=chunk_name.split("_").map(_Utilities.returnIntegerOrSelf),_chunk_name$split$map4=_slicedToArray(_chunk_name$split$map3,3),uid=_chunk_name$split$map4[0],index=_chunk_name$split$map4[1],total_parts=_chunk_name$split$map4[2];this.total_parts=total_parts;var _getChunkRange3=(0,_Utilities.getChunkRange)(file.size,chunk_size,index,total_parts),_getChunkRange4=_slicedToArray(_getChunkRange3,2),start_byte=_getChunkRange4[0],end_byte=_getChunkRange4[1];logger.info("[LeatherbackClient] _createAndStartUploader for bytes "+start_byte+" to "+end_byte+" (uploader "+index+"/"+total_parts+")");var file_chunk=file[slice_method](start_byte,end_byte);file_chunk.name=chunk_name;file_chunk.uid=uid;this._getEndpoints(signed_url).then(function(endpoint){return _this2._startUploader(endpoint,file_chunk,storage_path)}).catch(function(error){_this2._onUploaderFail(error)})}},{key:"_getEndpoints",value:function _getEndpoints(signed_url){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open("POST",signed_url,true);xhr.setRequestHeader("Content-Type","application/json; charset=UTF-8");xhr.setRequestHeader("x-goog-resumable","start");xhr.onload=function(){if(this.status>=200&&this.status<300){resolve(xhr.getResponseHeader("location"))}else{reject({status:this.status,statusText:xhr.statusText})}};xhr.addEventListener("error",reject);xhr.send()})}},{key:"_getNewToken",value:function _getNewToken(){var _this3=this;var config=this.config,vimeo_app=this.vimeo_app;try{return Promise.resolve(vimeo_app.getToken(config.leatherback.token)).then(function(token){_this3.jwtToken=token})}catch(e){return Promise.reject(e)}}},{key:"_startUploader",value:function _startUploader(endpoint,file_chunk,storage_path){var file=this.file,logger=this.logger,config=this.config,uploaders=this.uploaders,_onUploaderProgress=this._onUploaderProgress,_onUploaderStateChange=this._onUploaderStateChange;var uploader=new _GCSUploader2.default(config,endpoint,file_chunk,file.type,logger);uploader.storage_path=storage_path;uploaders.push(uploader);uploader.on(_events2.default.PROGRESS,_onUploaderProgress);uploader.on(_events2.default.STATE_CHANGE,_onUploaderStateChange);uploader.upload()}},{key:"_onUploaderProgress",value:function _onUploaderProgress(event){var uploaders=this.uploaders;this.bytes_uploaded=uploaders.reduce(function(sum,upload){return sum+upload.bytes_uploaded},0);_get(LeatherbackClient.prototype.__proto__||Object.getPrototypeOf(LeatherbackClient.prototype),"_onUploaderProgress",this).call(this,{loaded:this.bytes_uploaded})}},{key:"_onUploaderStateChange",value:function _onUploaderStateChange(event){var logger=this.logger,fastest_region=this.fastest_region,signed_urls=this.signed_urls,_onUploaderComplete=this._onUploaderComplete,_onUploaderFail=this._onUploaderFail,uploaders=this.uploaders,endpoints=this.endpoints,config=this.config,upload_type=this.upload_type,file=this.file,ip=this.ip;switch(event.state){case _states2.default.COMPLETED:var remaining_uploads=null;if(typeof endpoints!=="undefined"){delete endpoints[event.uploader.storage_path];remaining_uploads=Object.keys(endpoints).length}else{delete signed_urls[event.uploader.storage_path];remaining_uploads=Object.keys(signed_urls).length}logger.info("[LeatherbackClient] _onUploaderStateChange: Completed "+event.uploader.file.name+", "+remaining_uploads+" remaining uploads");if(remaining_uploads>0){return}var url=this.config.leatherback.url+"/attempt/complete/"+this.uid;var payload={user_ip:ip,browser_info:config.browser_info,bucket:fastest_region.Region,clip_id:this.clip_id,title:file.name,upload_type:upload_type};var options={method:"PUT",headers:{Authorization:"Bearer "+this.jwtToken,"Content-Type":"application/json"},body:JSON.stringify(payload)};(0,_Utilities.requestWithRetry)(url,options);_onUploaderComplete();break;case _states2.default.UPLOADING:var all_uploading=uploaders.some(function(uploader){return uploader.state===_states2.default.UPLOADING});this.state=all_uploading?_states2.default.UPLOADING:event.state;break;case _states2.default.FAILED:_onUploaderFail(event.uploader.error);break;default:}}},{key:"_setFileSizeChangeListener",value:function _setFileSizeChangeListener(){var _this4=this;this.on(_events2.default.FILE_SIZE_CHANGED,function(err){_this4.fail(err)})}},{key:"start",value:function start(){_get(LeatherbackClient.prototype.__proto__||Object.getPrototypeOf(LeatherbackClient.prototype),"start",this).call(this);var lighthouse=this.config.lighthouse;var _validate=this._validate,_create=this._create,_start=this._start,_onUploaderFail=this._onUploaderFail,_getNewToken=this._getNewToken;Promise.all([lighthouse.getFastestRegion(),lighthouse.getIpAddress()]).then(_validate).then(_getNewToken).then(_create).then(_start).catch(_onUploaderFail)}},{key:"pause",value:function pause(){_get(LeatherbackClient.prototype.__proto__||Object.getPrototypeOf(LeatherbackClient.prototype),"pause",this).call(this);this.uploaders.forEach(function(upload){upload.pause()});this._update("pause")}},{key:"resume",value:function resume(){_get(LeatherbackClient.prototype.__proto__||Object.getPrototypeOf(LeatherbackClient.prototype),"resume",this).call(this);this.uploaders.forEach(function(upload){upload.resume()});this._update("resume")}},{key:"fail",value:function fail(error){this.uploaders.forEach(function(uploader){uploader.fail(error)})}},{key:"cancel",value:function cancel(){_get(LeatherbackClient.prototype.__proto__||Object.getPrototypeOf(LeatherbackClient.prototype),"cancel",this).call(this);this.uploaders.forEach(function(upload){upload.cancel()});this._update("cancel")}}]);return LeatherbackClient}(_BaseClient3.default);exports.default=LeatherbackClient},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _states=__webpack_require__(3);var _states2=_interopRequireDefault(_states);var _services=__webpack_require__(7);var _services2=_interopRequireDefault(_services);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var DEAD_STATES=[_states2.default.CANCELED,_states2.default.COMPLETED,_states2.default.FAILED];var AttemptAborter=function(){function AttemptAborter(config){_classCallCheck(this,AttemptAborter);this.config=config;this._onBeforeWindowUnload=this._onBeforeWindowUnload.bind(this);this._onWindowUnload=this._onWindowUnload.bind(this);this._toggleAbort=this._toggleAbort.bind(this);this.is_set=false}_createClass(AttemptAborter,[{key:"_setWarning",value:function _setWarning(){if(this.is_set){return}window.addEventListener("beforeunload",this._onBeforeWindowUnload);window.addEventListener("unload",this._onWindowUnload);this.is_set=true}},{key:"_removeWarning",value:function _removeWarning(){window.removeEventListener("beforeunload",this._onBeforeWindowUnload);window.removeEventListener("unload",this._onWindowUnload);this.is_set=false}},{key:"_toggleAbort",value:function _toggleAbort(revive,upload){var service=this.config.service;if(service===_services2.default.UPLOAD_SERVICE_LEATHERBACK){this._leatherbackToggleAbort(revive,upload)}else{this._siteToggleAbort(revive,upload)}}},{key:"_siteToggleAbort",value:function _siteToggleAbort(revive,upload){if(!upload.attempt_id){return}var xsrft=this.config.xsrft;var url="/upload/_abort?attempt_id="+upload.attempt_id+"&upload_type="+upload.upload_type;if(revive){url+="&revive=true"}var data=new FormData;data.append("token",xsrft);if(upload.signature){data.append("signature",upload.signature)}window.navigator.sendBeacon(url,data)}},{key:"_leatherbackToggleAbort",value:function _leatherbackToggleAbort(revive,upload){if(!upload.uid){return}var _config$leatherback=this.config.leatherback,url=_config$leatherback.url,token=_config$leatherback.token;var abort_revive_url=revive?url+"/attempt/revive/"+upload.uid:url+"/attempt/abort/"+upload.uid;var xhr=new XMLHttpRequest;var data=new FormData;xhr.open("POST",abort_revive_url);data.append("jwt",token);xhr.send(data)}},{key:"_onBeforeWindowUnload",value:function _onBeforeWindowUnload(e){var uploads=this.uploads,_toggleAbort=this._toggleAbort;this._timeout=window.setTimeout(function(){uploads.forEach(function(upload){_toggleAbort(true,upload)})},3e3);uploads.forEach(function(upload){_toggleAbort(false,upload)});var message="WARNING: You are currently uploading "+uploads.length+" video "+uploads.length!==1?"s":""+"! Your uploads will not be completed if you leave this page.";e=e||window.event;(e||window.event).returnValue=message;return message}},{key:"_onWindowUnload",value:function _onWindowUnload(e){var _timeout=this._timeout;clearTimeout(_timeout)}},{key:"uploads",get:function get(){return this._uploads},set:function set(uploads){var _this=this;if(this._uploads===uploads){return}this._uploads=[];uploads.forEach(function(upload){if(DEAD_STATES.indexOf(upload.state)===-1){_this._uploads.push(upload)}});if(this._uploads.length>0){this._setWarning()}else{this._removeWarning()}}}]);return AttemptAborter}();exports.default=AttemptAborter},function(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _errors=__webpack_require__(16);var _Utilities=__webpack_require__(15);function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Lighthouse=function(){function Lighthouse(url){var logger=arguments.length>1&&arguments[1]!==undefined?arguments[1]:window.console;_classCallCheck(this,Lighthouse);if(!url){throw new Error("[Lighthouse] url required in first argument")}this.url=url;this.logger=logger;this.regions=[];this.sorted_regions=[];this._getRegions=this._getRegions.bind(this);this._onRegionsGetSuccess=this._onRegionsGetSuccess.bind(this);this._raceEndpoints=this._raceEndpoints.bind(this);this._sortByRttAndDistance=this._sortByRttAndDistance.bind(this);this._pickWinningEndpoint=this._pickWinningEndpoint.bind(this);this._onRegionsGetFail=this._onRegionsGetFail.bind(this);this._onRaceFail=this._onRaceFail.bind(this);this._getIp=this._getIp.bind(this);this._onIpGetSuccess=this._onIpGetSuccess.bind(this);this._onIpGetFail=this._onIpGetFail.bind(this);this.ip=null;this.fastest_region=null;this.getFastestRegion()}_createClass(Lighthouse,[{key:"_getRegions",value:function _getRegions(){if(this.regions.length>0){return Promise.resolve(this.regions)}var url=this.url;return(0,_Utilities.requestWithRetry)(url)}},{key:"_getIp",value:function _getIp(){if(this.ip!==null){return Promise.resolve(this.ip)}var url=this.url;return(0,_Utilities.requestWithRetry)(url)}},{key:"_onRegionsGetSuccess",value:function _onRegionsGetSuccess(event){var _event$target=event.target,status=_event$target.status,responseText=_event$target.responseText;if(status!==200){return Promise.reject(status+": "+responseText)}var response=null;try{response=JSON.parse(responseText)}catch(e){return Promise.reject(e)}this.regions=response.Regions;this.ip=response.Ip;return Promise.resolve(response.Regions)}},{key:"_onIpGetSuccess",value:function _onIpGetSuccess(event){var _event$target2=event.target,status=_event$target2.status,responseText=_event$target2.responseText;if(status!==200){return Promise.reject(status+": "+responseText)}var response=null;try{response=JSON.parse(responseText)}catch(e){return Promise.reject(e)}this.ip=response.Ip;return Promise.resolve(response.Ip)}},{key:"_raceEndpoints",value:function _raceEndpoints(regions){var max_time=1e3;var requests=regions.map(function(region,distance_index){var start=window.performance.now();return(0,_Utilities.request)(region.PingUrl,{method:"HEAD"}).then(function(event){var rtt=event.target.status!==200?0:window.performance.now()-start;return Promise.resolve(_extends({},region,{distance_index:distance_index,rtt:rtt}))})});var timer=new Promise(function(resolve,reject){setTimeout(resolve,max_time)});var fallback=Promise.all([timer,Promise.race(requests)]);return Promise.race([Promise.all(requests),fallback])}},{key:"_sortByRttAndDistance",value:function _sortByRttAndDistance(regions){return new Promise(function(resolve,reject){regions.sort(function(region_1,region_2){var rtt_difference=Math.abs((region_1.rtt-region_2.rtt)/region_1.rtt)*100;if(rtt_difference<.2){return region_1.distance_index-region_2.distance_index}return region_1.rtt-region_2.rtt});resolve(regions)})}},{key:"_pickWinningEndpoint",value:function _pickWinningEndpoint(sorted_regions){if(sorted_regions.length<1){return Promise.reject("No endpoints to choose a winner from")}this.sorted_regions=sorted_regions;this.fastest_region=sorted_regions[0];return Promise.resolve(this.fastest_region)}},{key:"_onRegionsGetFail",value:function _onRegionsGetFail(e){var logger=this.logger;logger.warn("[Lighthouse] _onRegionsGetFail: "+e.toString());return Promise.reject(_errors.ERRORS.LIGHTHOUSE_LOAD_ERROR)}},{key:"_onIpGetFail",value:function _onIpGetFail(e){var logger=this.logger;logger.warn("[Lighthouse] _onIpGetFail: ${e.toString()}");return Promise.reject(_errors.ERRORS.LIGHTHOUSE_LOAD_ERROR)}},{key:"_onRaceFail",value:function _onRaceFail(e){var logger=this.logger,regions=this.regions;logger.warn("[Lighthouse] _onRaceFail:",e);if(regions&&regions.length>0){logger.warn("[Lighthouse] Resolving with unsorted first region");return Promise.resolve(regions[0])}return Promise.reject(_errors.ERRORS.LIGHTHOUSE_RACE_ERROR)}},{key:"getFastestRegion",value:function getFastestRegion(){var fastest_region=this.fastest_region;if(fastest_region){return Promise.resolve(fastest_region)}var _getRegions=this._getRegions,_onRegionsGetSuccess=this._onRegionsGetSuccess,_raceEndpoints=this._raceEndpoints,_pickWinningEndpoint=this._pickWinningEndpoint,_sortByRttAndDistance=this._sortByRttAndDistance,_onRegionsGetFail=this._onRegionsGetFail,_onRaceFail=this._onRaceFail;return _getRegions().catch(_onRegionsGetFail).then(_onRegionsGetSuccess).then(_raceEndpoints).then(_sortByRttAndDistance).then(_pickWinningEndpoint).catch(_onRaceFail)}},{key:"getIpAddress",value:function getIpAddress(){var ip=this.ip;if(ip){return Promise.resolve(ip)}var _getIp=this._getIp,_onIpGetFail=this._onIpGetFail,_onIpGetSuccess=this._onIpGetSuccess;return _getIp().catch(_onIpGetFail).then(_onIpGetSuccess)}}]);return Lighthouse}();exports.default=Lighthouse},function(module,exports){"use strict"
;Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}var Fresnel=function(){function Fresnel(index_name){_classCallCheck(this,Fresnel);if(!index_name){throw new Error("Undefined fresnel index name")}if(window.location.hostname!=="vimeo.com"){index_name+="-dev"}this.endpoint="https://fresnel.vimeocdn.com/add/"+index_name}_createClass(Fresnel,[{key:"log",value:function log(data){var endpoint=this.endpoint;data=JSON.stringify(data);if(navigator.sendBeacon){return navigator.sendBeacon(endpoint,data)}var xhr=new XMLHttpRequest;xhr.open("POST",endpoint,true);xhr.setRequestHeader("Content-Type","text/plain;charset=UTF-8");return xhr.send(data)}}]);return Fresnel}();exports.default=Fresnel},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var GCS_RESUMABLE_UPLOADER_APP=exports.GCS_RESUMABLE_UPLOADER_APP=3;var DROPBOX_APP=exports.DROPBOX_APP=20166;var BOX_APP=exports.BOX_APP=67545;var ONEDRIVE_APP=exports.ONEDRIVE_APP=67813;var GOOGLE_DRIVE_APP=exports.GOOGLE_DRIVE_APP=69025;var PARALLEL_UPLOADER_APP=exports.PARALLEL_UPLOADER_APP=87099;var API_APPS={GCS_RESUMABLE_UPLOADER_APP:GCS_RESUMABLE_UPLOADER_APP,DROPBOX_APP:DROPBOX_APP,BOX_APP:BOX_APP,ONEDRIVE_APP:ONEDRIVE_APP,GOOGLE_DRIVE_APP:GOOGLE_DRIVE_APP};exports.default=API_APPS},function(module,exports){module.exports={name:"vimeo-uploader",version:"2.12.0",description:"You know, for uploading",main:"dist/vimeo_uploader.js",scripts:{build:"./node_modules/.bin/gulp build",dev:"./node_modules/.bin/gulp dev",lint:"gulp lint",pretest:"npm run lint",release:"./node_modules/.bin/gulp release",prerelease:"./node_modules/.bin/gulp release-rc",test:"ava && npm run test_browser",test_unit:"ava",test_browser:"npm run build && ./node_modules/karma/bin/karma start --single-run",test_phantom:"npm run build && ./node_modules/karma/bin/karma start --browsers PhantomJS",test_nightmare:"npm run build && DEBUG=nightmare:actions* ./node_modules/.bin/mocha test/nightmare"},private:true,repository:{type:"git",url:"git@github.vimeows.com:video/uploader.git"},author:"Ben Stahl <bens@vimeo.com>",license:"ISC",files:["LICENSE","README.md","dist/"],dependencies:{keymirror:"^0.1.1","raven-js":"^3.9.1",uuid:"^3.2.1"},devDependencies:{"@vimeo/eslint-config-player":"^4.0.1",assert:"^1.3.0",ava:"^0.16.0","babel-cli":"^6.11.4","babel-core":"^6.13.2","babel-eslint":"^6.0.0","babel-loader":"^6.2.4","babel-plugin-transform-object-rest-spread":"^6.8.0","babel-preset-es2015":"^6.13.2","babel-register":"^6.14.0",eslint:"^3.6.1","eslint-formatter-pretty":"^1.0.0","eslint-plugin-ava":"^3.1.0","eslint-plugin-promise":"^1.1.0",gulp:"^3.9.0","gulp-bump":"^2.1.0","gulp-eslint":"^3.0.1","gulp-filter":"^4.0.0","gulp-git":"^1.7.1","gulp-json-editor":"^2.2.1","gulp-replace":"^0.5.4","gulp-tag-version":"^1.3.0","gulp-util":"^3.0.6","http-server":"^0.9.0",jsdom:"^9.5.0","json-loader":"^0.5.2",karma:"^0.13.22","karma-babel-preprocessor":"^6.0.1","karma-browserstack-launcher":"^0.1.11","karma-mocha":"^1.0.1","karma-phantomjs-launcher":"^1.0.0","karma-sinon":"^1.0.5",mocha:"^2.4.5","mocha-generators":"^1.2.0",nightmare:"^2.5.1","nightmare-upload":"^0.1.1","phantomjs-prebuilt":"^2.1.7","run-sequence":"^1.2.2",should:"^8.3.1",sinon:"^1.17.5",webpack:"^1.13.1","webpack-dev-server":"^1.14.1","webpack-sentry-plugin":"^1.5.0"},ava:{files:["test/unit/*.js"],source:["src/**/*.js"],require:["babel-register","./test/setup-dom.js"],babel:"inherit"}}}]);